import"./ScrollArea-DFVXjTz0.js";import"./RovingFocusItem-CVjkq2qt.js";import"./Presence-3Lrzvetv.js";import"./defu-DUbmuhNq.js";import"./TabsTrigger-DqwypIQj.js";import{Ai as e,Ca as t,Fi as n,Ga as ee,Gi as r,Hi as i,Ii as a,Ka as o,Li as s,Na as c,Oa as l,Ri as te,Ui as u,Va as d,_r as f,ca as ne,er as p,f as re,gr as m,l as ie,oa as h,p as ae,pr as g,v as _,zi as v}from"./index-D6Cod0pL.js";import"./en_US-LGbIKe0x.js";import"./common-HQCQB71w.js";import"./zh_CN-Cgumeokr.js";import"./useFullscreen-lrjpQVTw.js";import"./_plugin-vue_export-helper-Dey4FfNi.js";import{P as oe,s as y,w as b}from"./dist-D3XftLPo.js";import"./theme-shared-BpTdpb0d.js";import{t as x}from"./TTable-B13ZnM5N.js";import"./useTableColumns-qs-cYpaB.js";import{t as S}from"./TForm-Drq7Qn9R.js";import"./TIcon-C-hNhMC1.js";import{t as C}from"./TModal-OyBXzO5K.js";import{n as se,t as ce}from"./CardContent-CMuL0LxG.js";import{n as le,t as ue}from"./CardTitle-D06OZslX.js";import{n as de,r as w}from"./composables-CTAVZAup.js";import"./constants-OTiF8S51.js";import"./business-DYFIcNWr.js";import{t as T}from"./TDataCard-C7I9agpQ.js";import{t as E}from"./TStatusBadge-DZzFEG5C.js";import{t as D}from"./TPageHeader-CTxQMWSB.js";import{t as O}from"./TEmptyState-B9XitPgC.js";import{t as k}from"./TBatchActions-CX-6FAVm.js";var A={class:`space-y-6`},j={class:`flex flex-wrap gap-3`},M={class:`bg-muted/40 border border-border/50 rounded-xl px-3 py-3`},N={class:`flex items-center justify-between`},P={class:`flex items-center gap-3`},F={class:`text-xs text-muted-foreground bg-muted px-2 py-0.5 rounded-full`},I={class:`font-medium`},L={class:`text-sm text-muted-foreground`},R=r({__name:`index`,setup(r){let{data:R,loading:z,searchQuery:B,filters:V,currentPage:fe,pageSize:pe,total:H,statistics:U,fetchData:W,goToPage:me,setPageSize:he}=de({apiCall:async e=>await p.getUsers(e)||{list:[],total:0,page:1,pageSize:10},apiCallParams:e=>({page:e.page,pageSize:e.pageSize,search:e.searchQuery,role:e.filters.role,status:e.filters.status}),statisticsFn:e=>({total:e.length,active:e.filter(e=>e.status===f.ACTIVE).length,admins:e.filter(e=>e.role===m.ADMIN).length,today:e.filter(e=>{let t=new Date(e.createdAt),n=new Date;return t.toDateString()===n.toDateString()}).length})}),{mutate:ge}=w({mutationFn:e=>p.createUser({name:e.name,email:e.email,role:e.role,status:e.status}),successMessage:`用户创建成功`,onSuccess:()=>{q.value=!1,X.value={name:``,email:``,role:m.VIEWER,status:f.ACTIVE},W()}}),{mutate:_e}=w({mutationFn:({id:e,values:t})=>p.updateUser(e,{name:t.name,email:t.email,role:t.role,status:t.status}),successMessage:`用户更新成功`,onSuccess:()=>{J.value=!1,Y.value=null,W()}}),{mutate:ve}=w({mutationFn:e=>p.deleteUser(e),successMessage:`用户删除成功`,onSuccess:()=>W()}),{mutate:ye}=w({mutationFn:e=>p.batchDeleteUsers(e),successMessage:`批量删除成功`,onSuccess:()=>{K.value?.clearSelection(),W()}}),be=n(()=>{let e=U.value||{};return[{title:`总用户`,value:e.total||0,icon:ie,color:`text-blue-500`,bgColor:`bg-blue-50`},{title:`活跃用户`,value:e.active||0,icon:ae,color:`text-green-500`,bgColor:`bg-green-50`},{title:`管理员`,value:e.admins||0,icon:re,color:`text-purple-500`,bgColor:`bg-purple-50`},{title:`今日新增`,value:e.today||0,icon:_,color:`text-orange-500`,bgColor:`bg-orange-50`}]}),G=c({keyword:``,role:``,status:``}),xe={layout:`inline`,fields:[{name:`keyword`,type:`input`,label:``,placeholder:`搜索用户名或邮箱...`,className:`w-[200px]`},{name:`role`,type:`select`,label:``,placeholder:`全部角色`,options:[{label:`全部角色`,value:``},{label:`管理员`,value:m.ADMIN},{label:`编辑`,value:m.EDITOR},{label:`查看者`,value:m.VIEWER}],className:`w-[140px]`},{name:`status`,type:`select`,label:``,placeholder:`全部状态`,options:[{label:`全部状态`,value:``},{label:g.USER.ACTIVE.text,value:g.USER.ACTIVE.value},{label:g.USER.INACTIVE.text,value:g.USER.INACTIVE.value},{label:g.USER.SUSPENDED.text,value:g.USER.SUSPENDED.value}],className:`w-[140px]`}],searchConfig:{enabled:!0,collapsed:!1,collapseThreshold:3,showCollapseButton:!1,searchText:`搜索`,resetText:`重置`,showReset:!0,onSearch:e=>{B.value=e.keyword||``,V.value={role:e.role,status:e.status}},onReset:()=>{B.value=``,V.value={}}}},K=c(),Se=n(()=>({columns:[{title:`用户`,dataIndex:`name`,width:200,slot:`user`},{title:`角色`,dataIndex:`role`,width:120,slot:`role`,filters:[{text:`管理员`,value:m.ADMIN},{text:`编辑`,value:m.EDITOR},{text:`查看者`,value:m.VIEWER}]},{title:`状态`,dataIndex:`status`,width:100,slot:`status`,filters:[{text:g.USER.ACTIVE.text,value:g.USER.ACTIVE.value},{text:g.USER.INACTIVE.text,value:g.USER.INACTIVE.value},{text:g.USER.SUSPENDED.text,value:g.USER.SUSPENDED.value}]},{title:`创建时间`,dataIndex:`createdAt`,width:120,sorter:!0},{title:`最后登录`,dataIndex:`lastLogin`,width:120,customRender:({text:e})=>e||`-`}],pagination:{pageSize:10,show:!0,showSizeChanger:!0,showQuickJumper:!0,total:H.value},rowSelection:{type:`checkbox`,show:!0},actions:[{text:`编辑`,type:`primary`,onClick:e=>Te(e)},{text:`删除`,type:`danger`,confirm:!0,confirmText:`确定要删除该用户吗？此操作不可恢复。`,onClick:e=>Oe(e.id)}],actionWidth:150,actionFixed:`right`})),q=c(!1),J=c(!1),Y=c(null),X=c({name:``,email:``,role:m.VIEWER,status:f.ACTIVE}),Z=c({id:``,name:``,email:``,role:m.VIEWER,status:f.ACTIVE}),Ce={layout:`horizontal`,labelCol:{span:6},wrapperCol:{span:18},fields:[{name:`name`,type:`input`,label:`姓名`,placeholder:`请输入姓名`,rules:[{required:!0,message:`姓名不能为空`},{min:2,message:`姓名至少2个字符`}]},{name:`email`,type:`input`,label:`邮箱`,placeholder:`请输入邮箱`,rules:[{required:!0,message:`邮箱不能为空`},{type:`email`,message:`邮箱格式不正确`}]},{name:`role`,type:`select`,label:`角色`,placeholder:`请选择角色`,options:[{label:`管理员`,value:m.ADMIN},{label:`编辑`,value:m.EDITOR},{label:`查看者`,value:m.VIEWER}],rules:[{required:!0,message:`请选择角色`}]},{name:`status`,type:`select`,label:`状态`,placeholder:`请选择状态`,options:[{label:g.USER.ACTIVE.text,value:g.USER.ACTIVE.value},{label:g.USER.INACTIVE.text,value:g.USER.INACTIVE.value},{label:g.USER.SUSPENDED.text,value:g.USER.SUSPENDED.value}],rules:[{required:!0,message:`请选择状态`}]}],actions:{showSubmit:!0,showReset:!0,submitText:`添加用户`,resetText:`取消`,align:`right`,onReset:()=>{q.value=!1}}},we={layout:`horizontal`,labelCol:{span:6},wrapperCol:{span:18},fields:[{name:`name`,type:`input`,label:`姓名`,placeholder:`请输入姓名`,rules:[{required:!0,message:`姓名不能为空`},{min:2,message:`姓名至少2个字符`}]},{name:`email`,type:`input`,label:`邮箱`,placeholder:`请输入邮箱`,rules:[{required:!0,message:`邮箱不能为空`},{type:`email`,message:`邮箱格式不正确`}]},{name:`role`,type:`select`,label:`角色`,placeholder:`请选择角色`,options:[{label:`管理员`,value:m.ADMIN},{label:`编辑`,value:m.EDITOR},{label:`查看者`,value:m.VIEWER}],rules:[{required:!0,message:`请选择角色`}]},{name:`status`,type:`select`,label:`状态`,placeholder:`请选择状态`,options:[{label:g.USER.ACTIVE.text,value:g.USER.ACTIVE.value},{label:g.USER.INACTIVE.text,value:g.USER.INACTIVE.value},{label:g.USER.SUSPENDED.text,value:g.USER.SUSPENDED.value}],rules:[{required:!0,message:`请选择状态`}]}],actions:{showSubmit:!0,showReset:!0,submitText:`保存修改`,resetText:`取消`,align:`right`,onReset:()=>{J.value=!1}}};function Te(e){Y.value=e,Z.value={id:e.id,name:e.name,email:e.email,role:e.role,status:e.status},J.value=!0}function Ee(e){ge(e)}function De(e){Y.value&&_e({id:Y.value.id,values:e})}function Oe(e){ve(e)}let Q=c([]),$=c([]);function ke(e,t){Q.value=e,$.value=t}function Ae(){Q.value=[],$.value=[],K.value?.clearSelection()}function je(){if(Q.value.length===0){alert(`请先选择要删除的用户`);return}confirm(`确定要删除选中的 ${Q.value.length} 个用户吗？`)&&ye(Q.value)}function Me(e){e.current!==void 0&&me(e.current),e.pageSize!==void 0&&he(e.pageSize)}return(n,r)=>(h(),v(`div`,A,[u(d(D),{title:`用户管理`,subtitle:`管理系统用户账号和权限分配`,actions:[{text:`添加用户`,type:`primary`,iconName:`Plus`,onClick:()=>q.value=!0}]},null,8,[`actions`]),u(d(C),{open:d(q),"onUpdate:open":r[1]||=e=>l(q)?q.value=e:null,title:`添加新用户`,width:`480`,footer:null},{default:t(()=>[u(d(S),{modelValue:d(X),"onUpdate:modelValue":r[0]||=e=>l(X)?X.value=e:null,schema:Ce,onSubmit:Ee},null,8,[`modelValue`])]),_:1},8,[`open`]),a(`div`,j,[(h(!0),v(e,null,ne(d(be),e=>(h(),s(d(T),{key:e.title,title:e.title,value:e.value,icon:e.icon,color:e.color,size:`sm`},null,8,[`title`,`value`,`icon`,`color`]))),128))]),a(`div`,M,[u(d(S),{modelValue:d(G),"onUpdate:modelValue":r[2]||=e=>l(G)?G.value=e:null,schema:xe},null,8,[`modelValue`])]),u(d(se),{class:`bg-muted/40 border border-border/50 rounded-xl`},{default:t(()=>[u(d(le),null,{default:t(()=>[a(`div`,N,[a(`div`,P,[u(d(ue),{class:`text-base font-semibold`},{default:t(()=>[...r[6]||=[i(`用户列表`,-1)]]),_:1}),a(`span`,F,` 共 `+o(d(H))+` 人 `,1)]),u(d(k),{count:d(Q).length,total:d(H),"item-name":`用户`,"class-name":`border-0 bg-transparent shadow-none px-0 py-0`,actions:[{text:`批量删除`,type:`danger`,confirm:!0,confirmText:`确定要删除选中的用户吗？此操作不可恢复。`,onClick:je}],onClear:Ae},null,8,[`count`,`total`,`actions`])])]),_:1}),u(d(ce),{class:`pt-0`},{default:t(()=>[u(d(x),{ref_key:`tableRef`,ref:K,data:d(R),"onUpdate:data":r[3]||=e=>l(R)?R.value=e:null,schema:d(Se),loading:d(z),onSelectChange:ke,onChange:Me},{user:t(e=>[u(d(b),null,{default:t(()=>[u(d(oe),{style:ee({backgroundColor:e.record.status===d(f).ACTIVE?`#87d068`:`#ccc`})},{default:t(()=>[i(o(e.record.name.charAt(0)),1)]),_:2},1032,[`style`]),a(`div`,null,[a(`div`,I,o(e.record.name),1),a(`div`,L,o(e.record.email),1)])]),_:2},1024)]),role:t(e=>[u(d(y),{color:e.text===d(m).ADMIN?`red`:e.text===d(m).EDITOR?`blue`:`default`},{default:t(()=>[i(o(e.text===d(m).ADMIN?`管理员`:e.text===d(m).EDITOR?`编辑`:`查看者`),1)]),_:2},1032,[`color`])]),status:t(e=>[u(d(E),{status:e.text,"status-map":{[d(f).ACTIVE]:{text:`启用`,color:`success`},[d(f).INACTIVE]:{text:`禁用`,color:`default`},[d(f).SUSPENDED]:{text:`已暂停`,color:`error`}}},null,8,[`status`,`status-map`])]),emptyText:t(()=>[u(d(O),{type:`data`,title:`暂无用户数据`,description:`开始添加您的第一个用户吧`,action:{text:`添加用户`,type:`primary`,iconName:`Plus`,onClick:()=>q.value=!0}},null,8,[`action`])]),_:1},8,[`data`,`schema`,`loading`])]),_:1})]),_:1}),u(d(C),{open:d(J),"onUpdate:open":r[5]||=e=>l(J)?J.value=e:null,title:`编辑用户`,width:`480`,footer:null},{default:t(()=>[d(Y)?(h(),s(d(S),{key:0,modelValue:d(Z),"onUpdate:modelValue":r[4]||=e=>l(Z)?Z.value=e:null,schema:we,onSubmit:De},null,8,[`modelValue`])):te(``,!0)]),_:1},8,[`open`])]))}});export{R as default};