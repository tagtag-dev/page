import"./ScrollArea-u7vgQcwr.js";import"./RovingFocusItem-tfPyown7.js";import"./Presence-CTcpkTiJ.js";import"./TabsTrigger-BVA-KY5p.js";import{Bi as e,Gt as t,Ha as n,Ii as r,Ki as i,Li as a,N as o,Pa as s,Qn as c,Ri as l,Ui as u,Wa as ee,Wi as d,dt as te,ji as ne,ka as f,l as re,la as ie,n as p,qa as m,sa as h,ta as ae,wa as g,zi as _}from"./index-Bdnse1ke.js";import"./en_US-B-0xvqcl.js";import"./common-B6eu2cAW.js";import"./zh_CN-o6dt8jMH.js";import"./useFullscreen-Cz-fRWjR.js";import"./_plugin-vue_export-helper-CuErARa7.js";import{N as oe,V as v,s as y,u as se}from"./dist-CIVP1JAM.js";import"./theme-shared-CKGE9ZaP.js";import{t as ce}from"./TTable-BqF1vWP0.js";import"./useTableColumns-ClPoF4Nv.js";import"./useResponsive-Drj8-vqi.js";import{n as le,t as b}from"./TForm-D3MGp7pF.js";import"./TIcon-BqmThimp.js";import{t as x}from"./TModal-C-7FBAha.js";import{n as ue,t as de}from"./CardContent-CE0o8nDP.js";import{n as fe,t as pe}from"./CardTitle-BRqhnrl0.js";import{n as me,r as S}from"./composables-cmucIgPx.js";import{t as he}from"./business-Ca3ePTT7.js";import{t as ge}from"./TDataCard-CaW7oY6O.js";import{t as _e}from"./TStatusBadge-ByNmjsZv.js";import{t as ve}from"./TPageHeader-B7msJezu.js";import{t as ye}from"./TEmptyState-CimpC4Hh.js";import{t as be}from"./TBatchActions-CBzH8d8g.js";var xe={class:`space-y-6`},Se={class:`flex flex-wrap gap-3`},Ce={class:`bg-muted/40 border border-border/50 rounded-xl px-3 py-3`},we={class:`flex items-center justify-between`},C={class:`flex items-center gap-3`},w={class:`text-xs text-muted-foreground bg-muted px-2 py-0.5 rounded-full`},T={class:`flex items-center gap-2`},E={class:`font-medium`},D={class:`truncate block max-w-[200px]`},O={key:1,class:`text-muted-foreground`},k={key:0,class:`space-y-4`},Te={class:`flex items-center gap-3 p-4 bg-gradient-to-r from-primary/5 to-primary/10 rounded-lg border border-primary/10`},Ee={class:`w-10 h-10 rounded-full bg-primary/10 flex items-center justify-center`},De={class:`flex-1 min-w-0`},Oe={class:`font-medium text-base`},ke={class:`text-sm text-muted-foreground truncate`},Ae={class:`flex items-center justify-between px-1 flex-wrap gap-y-2`},je={class:`flex items-center gap-2`},Me={class:`flex items-center justify-between px-3 py-2 bg-muted/30 rounded-lg`},Ne={class:`flex items-center gap-2`},Pe={class:`border rounded-lg p-4 bg-muted/20`},Fe={class:`flex justify-end gap-2`},A=i({__name:`index`,setup(i){let{data:A,loading:Ie,searchQuery:j,currentPage:Le,pageSize:Re,total:M,fetchData:N,goToPage:ze,setPageSize:Be}=me({apiCall:async e=>await c.getRoles(e)||{list:[],total:0,page:1,pageSize:10},apiCallParams:e=>({page:e.page,pageSize:e.pageSize,search:e.searchQuery})}),{mutate:Ve}=S({mutationFn:e=>c.createRole({name:e.name,code:e.code,description:e.description,permissions:e.permissions||[],status:e.status}),successMessage:`角色创建成功`,onSuccess:()=>{I.value=!1,it(),N()}}),{mutate:He}=S({mutationFn:({id:e,values:t})=>c.updateRole(e,{name:t.name,code:t.code,description:t.description,permissions:t.permissions,status:t.status}),successMessage:`角色更新成功`,onSuccess:()=>{L.value=!1,z.value=null,N()}}),{mutate:Ue}=S({mutationFn:e=>c.deleteRole(e),successMessage:`角色删除成功`,onSuccess:()=>N()}),{mutate:We}=S({mutationFn:e=>c.batchDeleteRoles(e),successMessage:`批量删除成功`,onSuccess:()=>{F.value?.clearSelection(),N()}}),{mutate:Ge}=S({mutationFn:({id:e,permissions:t})=>c.updateRolePermissions(e,t),successMessage:`权限分配成功`,onSuccess:()=>{R.value=!1,B.value=null,N()}}),Ke=s([{id:`dashboard`,name:`仪表盘`,code:`dashboard`,children:[{id:`dashboard:view`,name:`查看仪表盘`,code:`dashboard:view`},{id:`dashboard:export`,name:`导出数据`,code:`dashboard:export`}]},{id:`system`,name:`系统管理`,code:`system`,children:[{id:`system:user`,name:`用户管理`,code:`system:user`,children:[{id:`system:user:view`,name:`查看用户`,code:`system:user:view`},{id:`system:user:create`,name:`创建用户`,code:`system:user:create`},{id:`system:user:update`,name:`编辑用户`,code:`system:user:update`},{id:`system:user:delete`,name:`删除用户`,code:`system:user:delete`}]},{id:`system:organization`,name:`组织架构`,code:`system:organization`,children:[{id:`system:organization:view`,name:`查看部门`,code:`system:organization:view`},{id:`system:organization:create`,name:`创建部门`,code:`system:organization:create`},{id:`system:organization:update`,name:`编辑部门`,code:`system:organization:update`},{id:`system:organization:delete`,name:`删除部门`,code:`system:organization:delete`}]},{id:`system:role`,name:`角色管理`,code:`system:role`,children:[{id:`system:role:view`,name:`查看角色`,code:`system:role:view`},{id:`system:role:create`,name:`创建角色`,code:`system:role:create`},{id:`system:role:update`,name:`编辑角色`,code:`system:role:update`},{id:`system:role:delete`,name:`删除角色`,code:`system:role:delete`},{id:`system:role:permission`,name:`分配权限`,code:`system:role:permission`}]},{id:`system:menu`,name:`菜单管理`,code:`system:menu`,children:[{id:`system:menu:view`,name:`查看菜单`,code:`system:menu:view`},{id:`system:menu:create`,name:`创建菜单`,code:`system:menu:create`},{id:`system:menu:update`,name:`编辑菜单`,code:`system:menu:update`},{id:`system:menu:delete`,name:`删除菜单`,code:`system:menu:delete`}]}]},{id:`products`,name:`商品管理`,code:`products`,children:[{id:`products:view`,name:`查看商品`,code:`products:view`},{id:`products:create`,name:`创建商品`,code:`products:create`},{id:`products:update`,name:`编辑商品`,code:`products:update`},{id:`products:delete`,name:`删除商品`,code:`products:delete`}]},{id:`orders`,name:`订单管理`,code:`orders`,children:[{id:`orders:view`,name:`查看订单`,code:`orders:view`},{id:`orders:create`,name:`创建订单`,code:`orders:create`},{id:`orders:update`,name:`编辑订单`,code:`orders:update`},{id:`orders:delete`,name:`删除订单`,code:`orders:delete`}]}]),P=s({keyword:``}),qe={layout:`inline`,fields:[{name:`keyword`,type:`input`,label:``,placeholder:`搜索角色名称或编码...`,className:`w-[280px]`}],searchConfig:{enabled:!0,collapsed:!1,showCollapseButton:!1,searchText:`搜索`,resetText:`重置`,showReset:!0,onSearch:e=>{j.value=e.keyword||``},onReset:()=>{j.value=``}}},F=s(),Je=r(()=>({columns:[{title:`角色名称`,dataIndex:`name`,width:180,slot:`name`},{title:`角色编码`,dataIndex:`code`,width:150},{title:`用户数`,dataIndex:`userCount`,width:100,align:`center`,slot:`userCount`},{title:`权限数`,dataIndex:`permissions`,width:100,align:`center`,slot:`permissionCount`},{title:`状态`,dataIndex:`status`,width:100,slot:`status`},{title:`描述`,dataIndex:`description`,ellipsis:!0,slot:`description`},{title:`创建时间`,dataIndex:`createdAt`,width:150}],pagination:{pageSize:10,show:!0,showSizeChanger:!0,showQuickJumper:!0,total:M.value},rowSelection:{type:`checkbox`,show:!0},actions:[{text:`权限`,type:`default`,onClick:e=>at(e)},{text:`编辑`,type:`primary`,onClick:e=>Ze(e)},{text:`删除`,type:`danger`,confirm:!0,confirmText:`确定要删除该角色吗？此操作不可恢复。`,onClick:e=>J(e.id)}],actionWidth:260,actionFixed:`right`})),I=s(!1),L=s(!1),R=s(!1),z=s(null),B=s(null),V=s(),H=s(),U=s([]),W=s([`system`]),G=r(()=>{let e=t=>t.map(t=>({key:t.id,title:t.name,children:t.children?e(t.children):void 0}));return e(Ke.value)}),K=s({name:``,code:``,description:``,permissions:[],status:`active`}),q=s({id:``,name:``,code:``,description:``,permissions:[],status:`active`}),Ye={layout:`horizontal`,labelCol:{span:6},wrapperCol:{span:18},fields:[{name:`name`,type:`input`,label:`角色名称`,placeholder:`请输入角色名称`,rules:[{required:!0,message:`角色名称不能为空`},{min:2,message:`角色名称至少2个字符`}]},{name:`code`,type:`input`,label:`角色编码`,placeholder:`请输入角色编码`,rules:[{required:!0,message:`角色编码不能为空`},{pattern:/^[A-Za-z0-9_]+$/,message:`编码只能包含字母、数字和下划线`}]},{name:`status`,type:`select`,label:`状态`,placeholder:`请选择状态`,options:[{label:`启用`,value:`active`},{label:`禁用`,value:`inactive`}],rules:[{required:!0,message:`请选择状态`}]},{name:`description`,type:`textarea`,label:`描述`,placeholder:`请输入角色描述`,rows:3}],actions:{showSubmit:!0,showReset:!0,submitText:`添加角色`,resetText:`取消`,align:`right`,onReset:()=>{I.value=!1}}},Xe={layout:`horizontal`,labelCol:{span:6},wrapperCol:{span:18},fields:[{name:`name`,type:`input`,label:`角色名称`,placeholder:`请输入角色名称`,rules:[{required:!0,message:`角色名称不能为空`},{min:2,message:`角色名称至少2个字符`}]},{name:`code`,type:`input`,label:`角色编码`,placeholder:`请输入角色编码`,disabled:!0,rules:[{required:!0,message:`角色编码不能为空`}]},{name:`status`,type:`select`,label:`状态`,placeholder:`请选择状态`,options:[{label:`启用`,value:`active`},{label:`禁用`,value:`inactive`}],rules:[{required:!0,message:`请选择状态`}]},{name:`description`,type:`textarea`,label:`描述`,placeholder:`请输入角色描述`,rows:3}],actions:{showSubmit:!0,showReset:!0,submitText:`保存修改`,resetText:`取消`,align:`right`,onReset:()=>{L.value=!1}}};function Ze(e){z.value=e,q.value={id:e.id,name:e.name,code:e.code,description:e.description,permissions:e.permissions||[],status:e.status},L.value=!0}function Qe(e){Ve(e)}function $e(e){z.value&&He({id:z.value.id,values:e})}function J(e){Ue(e)}let Y=s([]),X=s([]);function et(e,t){Y.value=e,X.value=t}function tt(){Y.value=[],X.value=[],F.value?.clearSelection()}function nt(){if(Y.value.length===0){alert(`请先选择要删除的角色`);return}confirm(`确定要删除选中的 ${Y.value.length} 个角色吗？`)&&We(Y.value)}function rt(e){e.current!==void 0&&ze(e.current),e.pageSize!==void 0&&Be(e.pageSize)}function it(){K.value={name:``,code:``,description:``,permissions:[],status:`active`}}let Z=s(!1),Q=s([]),$=s(null);function at(e){B.value=e,Z.value=!1,Q.value=[],U.value=[...e.permissions||[]],W.value=[`system`],R.value=!0}function ot(e){Z.value||(Q.value=e.halfCheckedKeys)}function st(e){Z.value=e,e?Q.value=[]:ae(()=>{let e=$.value?.getHalfCheckedKeys();e&&(Q.value=e)})}function ct(){if(B.value){let e=Array.isArray(U.value)?U.value:[],t=Array.isArray(Q.value)?Q.value:[],n=Z.value?e:[...e,...t];Ge({id:B.value.id,permissions:[...new Set(n)]})}}let lt=r(()=>{let e=A.value||[],n=e.length,r=e.filter(e=>e.status===`active`).length,i=e.reduce((e,t)=>e+(t.userCount||0),0),a=e.reduce((e,t)=>e+(t.permissions?.length||0),0);return[{title:`角色总数`,value:n,icon:o,color:`text-blue-500`},{title:`启用角色`,value:r,icon:t,color:`text-green-500`},{title:`关联用户`,value:i,icon:re,color:`text-purple-500`},{title:`权限总数`,value:a,icon:te,color:`text-orange-500`}]});return(t,r)=>(h(),e(`div`,xe,[d(n(ve),{title:`角色管理`,subtitle:`管理系统角色和权限分配`,actions:[{text:`添加角色`,type:`primary`,iconName:`Plus`,onClick:()=>I.value=!0}]},null,8,[`actions`]),a(`div`,Se,[(h(!0),e(ne,null,ie(n(lt),e=>(h(),l(n(ge),{key:e.title,title:e.title,value:e.value,icon:e.icon,color:e.color,size:`sm`},null,8,[`title`,`value`,`icon`,`color`]))),128))]),a(`div`,Ce,[d(n(b),{modelValue:n(P),"onUpdate:modelValue":r[0]||=e=>f(P)?P.value=e:null,schema:qe},null,8,[`modelValue`])]),d(n(ue),{class:`bg-muted/40 border border-border/50 rounded-xl`},{default:g(()=>[d(n(fe),null,{default:g(()=>[a(`div`,we,[a(`div`,C,[d(n(pe),{class:`text-base font-semibold`},{default:g(()=>[...r[12]||=[u(`角色列表`,-1)]]),_:1}),a(`span`,w,` 共 `+m(n(A)?.length||0)+` 个角色 `,1)]),d(n(be),{count:n(Y).length,total:n(M),"item-name":`角色`,"class-name":`border-0 bg-transparent shadow-none px-0 py-0`,actions:[{text:`批量删除`,type:`danger`,confirm:!0,confirmText:`确定要删除选中的角色吗？此操作不可恢复。`,onClick:nt}],onClear:tt},null,8,[`count`,`total`,`actions`])])]),_:1}),d(n(de),{class:`pt-0`},{default:g(()=>[d(n(ce),{ref_key:`tableRef`,ref:F,data:n(A),"onUpdate:data":r[1]||=e=>f(A)?A.value=e:null,schema:n(Je),loading:n(Ie),onSelectChange:et,onChange:rt},{name:g(e=>[a(`div`,T,[d(n(o),{class:`h-4 w-4 text-muted-foreground`}),a(`span`,E,m(e.text),1)])]),userCount:g(e=>[d(n(y),{color:`blue`},{default:g(()=>[u(m(e.text)+`人`,1)]),_:2},1024)]),permissionCount:g(e=>[d(n(y),{color:`purple`},{default:g(()=>[u(m(e.text?.length||0),1)]),_:2},1024)]),status:g(e=>[d(n(_e),{status:e.text,"status-map":{active:{text:`启用`,color:`success`},inactive:{text:`禁用`,color:`default`},disabled:{text:`停用`,color:`error`}}},null,8,[`status`])]),description:g(t=>[t.text?(h(),l(n(v),{key:0,title:t.text},{default:g(()=>[a(`span`,D,m(t.text),1)]),_:2},1032,[`title`])):(h(),e(`span`,O,`-`))]),emptyText:g(()=>[d(n(ye),{type:`data`,title:`暂无角色数据`,description:`开始添加您的第一个角色吧`,action:{text:`添加角色`,type:`primary`,iconName:`Plus`,onClick:()=>I.value=!0}},null,8,[`action`])]),_:1},8,[`data`,`schema`,`loading`])]),_:1})]),_:1}),d(n(x),{open:n(I),"onUpdate:open":r[3]||=e=>f(I)?I.value=e:null,title:`添加角色`,width:`560`,"form-ref":n(V),onSubmit:Qe},{default:g(()=>[d(n(b),{ref_key:`addFormRef`,ref:V,modelValue:n(K),"onUpdate:modelValue":r[2]||=e=>f(K)?K.value=e:null,schema:Ye,embedded:``},null,8,[`modelValue`])]),_:1},8,[`open`,`form-ref`]),d(n(x),{open:n(L),"onUpdate:open":r[5]||=e=>f(L)?L.value=e:null,title:`编辑角色`,width:`560`,"form-ref":n(H),onSubmit:$e},{default:g(()=>[n(z)?(h(),l(n(b),{key:0,ref_key:`editFormRef`,ref:H,modelValue:n(q),"onUpdate:modelValue":r[4]||=e=>f(q)?q.value=e:null,schema:Xe,embedded:``},null,8,[`modelValue`])):_(``,!0)]),_:1},8,[`open`,`form-ref`]),d(n(he),{open:n(R),"onUpdate:open":r[11]||=e=>f(R)?R.value=e:null,title:`权限分配`,width:`520`},{footer:g(()=>[a(`div`,Fe,[d(n(p),{variant:`outline`,onClick:r[10]||=e=>R.value=!1},{default:g(()=>[...r[16]||=[u(` 取消 `,-1)]]),_:1}),d(n(p),{onClick:ct},{default:g(()=>[...r[17]||=[u(` 保存 `,-1)]]),_:1})])]),default:g(()=>[n(B)?(h(),e(`div`,k,[a(`div`,Te,[a(`div`,Ee,[d(n(o),{class:`h-5 w-5 text-primary`})]),a(`div`,De,[a(`div`,Oe,m(n(B).name),1),a(`div`,ke,m(n(B).code),1)]),d(n(oe),{class:ee({"bg-green-500/10 text-green-500 border-green-500/20":n(B).status===`active`,"bg-gray-500/10 text-gray-500 border-gray-500/20":n(B).status===`inactive`}),variant:`outline`},{default:g(()=>[u(m(n(B).status===`active`?`启用`:`禁用`),1)]),_:1},8,[`class`])]),a(`div`,Ae,[a(`div`,je,[r[13]||=a(`span`,{class:`text-sm font-medium`},`权限列表`,-1),d(n(y),{color:`blue`},{default:g(()=>[u(m(n(G).length)+` 个模块`,1)]),_:1})])]),a(`div`,Me,[a(`div`,Ne,[r[15]||=a(`span`,{class:`text-sm font-medium`},`父子节点联动`,-1),d(n(v),{title:`开启后，选中父节点会自动选中所有子节点`},{default:g(()=>[...r[14]||=[a(`span`,{class:`text-muted-foreground cursor-help`},`(?)`,-1)]]),_:1})]),d(n(se),{checked:n(Z),"onUpdate:checked":r[6]||=e=>f(Z)?Z.value=e:null,"checked-children":`独立`,"un-checked-children":`联动`,onChange:st},null,8,[`checked`])]),a(`div`,Pe,[d(n(le),{ref_key:`permissionTreeRef`,ref:$,modelValue:n(U),"onUpdate:modelValue":r[7]||=e=>f(U)?U.value=e:null,"half-checked-keys":n(Q),"onUpdate:halfCheckedKeys":r[8]||=e=>f(Q)?Q.value=e:null,"expanded-keys":n(W),"onUpdate:expandedKeys":r[9]||=e=>f(W)?W.value=e:null,"tree-data":n(G),"check-strictly":n(Z),checkable:``,toolbar:``,statistics:{enabled:!0,label:`已选择`,unit:`个权限`,showHalfChecked:!n(Z)},onCheck:ot},null,8,[`modelValue`,`half-checked-keys`,`expanded-keys`,`tree-data`,`check-strictly`,`statistics`])])])):_(``,!0)]),_:1},8,[`open`])]))}});export{A as default};