import"./ScrollArea-CW0-18Hy.js";import"./RovingFocusItem-DihGLheP.js";import{t as e}from"./button-Bo4o88Eb.js";import"./Presence-CX2vXdhf.js";import"./defu-BJL4Fjh2.js";import"./usePrimitiveElement-bvCn2QxH.js";import"./TabsTrigger-EHjOJe4X.js";import{C as t,Di as n,Ea as r,Gi as i,M as a,Pn as o,Ti as s,Ui as c,Yi as ee,_i as l,a as te,bi as u,da as d,et as f,fi as ne,ga as p,jt as re,ka as m,oa as h,vi as g,wa as _,wi as v,xi as y,yi as b}from"./index-D9LA8apy.js";import"./en_US-N9Q-_HQi.js";import"./common-rttX-sZZ.js";import"./zh_CN-RQJLYl9H.js";import"./useTabBar-WvhELTvw.js";import{t as x}from"./badge-DoBLqkFL.js";import{n as ie,t as ae}from"./CardContent-bGWyUVF7.js";import{n as oe,t as se}from"./CardTitle-9YsRePqj.js";import{l as ce,s as S,z as le}from"./dist-guKItzxh.js";import{t as ue}from"./TTable-BJXg8Gts.js";import{t as C}from"./TForm-De-AxzjP.js";import"./Input-DxyLxkUT.js";import"./TIcon-DpsAxes7.js";import{t as w}from"./TModal-l0DmcJma.js";import{n as de,r as T}from"./composables-B_2v-ght.js";import{t as fe}from"./TDrawer-6uNmgHrC.js";var pe={class:`space-y-6`},me={class:`flex flex-col sm:flex-row sm:items-center justify-between gap-4`},he={class:`flex flex-wrap gap-3`},ge={class:`flex items-baseline gap-2`},_e={class:`text-lg font-semibold`},E={class:`text-xs text-muted-foreground`},D={class:`bg-muted/30 rounded-lg p-4`},O={class:`flex flex-col lg:flex-row lg:items-center gap-4`},k={class:`flex-1`},A={key:0,class:`flex items-center gap-2 lg:border-l lg:pl-4`},j={class:`text-sm text-muted-foreground`},M={class:`flex items-center justify-between`},N={class:`flex items-center gap-3`},P={class:`text-xs text-muted-foreground bg-muted px-2 py-0.5 rounded-full`},F={class:`flex items-center gap-2`},I={class:`font-medium`},ve={class:`truncate block max-w-[200px]`},ye={key:1,class:`text-muted-foreground`},be={class:`flex flex-col items-center justify-center py-12 text-muted-foreground`},xe={class:`w-16 h-16 rounded-full bg-primary/10 flex items-center justify-center mb-4`},Se={key:0,class:`space-y-4`},Ce={class:`flex items-center gap-3 p-4 bg-gradient-to-r from-primary/5 to-primary/10 rounded-lg border border-primary/10`},we={class:`w-10 h-10 rounded-full bg-primary/10 flex items-center justify-center`},Te={class:`flex-1 min-w-0`},Ee={class:`font-medium text-base`},De={class:`text-sm text-muted-foreground truncate`},Oe={class:`flex items-center justify-between px-1`},ke={class:`flex items-center gap-2`},Ae={class:`flex items-center gap-2`},je={class:`border rounded-lg p-4 bg-muted/20`},Me={class:`flex items-center justify-between px-3 py-2 bg-muted/30 rounded-lg`},Ne={class:`flex items-center gap-2`},Pe={class:`flex items-center gap-2`},Fe={class:`text-lg font-semibold text-primary`},Ie={class:`flex justify-end gap-2`},L=n({__name:`index`,setup(n){let{data:L,loading:Le,searchQuery:R,currentPage:Re,pageSize:ze,total:Be,fetchData:z,goToPage:Ve,setPageSize:He}=de({apiCall:async e=>await o.getRoles(e)||{list:[],total:0,page:1,pageSize:10},apiCallParams:e=>({page:e.page,pageSize:e.pageSize,search:e.searchQuery})}),{mutate:Ue}=T({mutationFn:e=>o.createRole({name:e.name,code:e.code,description:e.description,permissions:e.permissions||[],status:e.status}),successMessage:`角色创建成功`,onSuccess:()=>{H.value=!1,st(),z()}}),{mutate:We}=T({mutationFn:({id:e,values:t})=>o.updateRole(e,{name:t.name,code:t.code,description:t.description,permissions:t.permissions,status:t.status}),successMessage:`角色更新成功`,onSuccess:()=>{U.value=!1,G.value=null,z()}}),{mutate:Ge}=T({mutationFn:e=>o.deleteRole(e),successMessage:`角色删除成功`,onSuccess:()=>z()}),{mutate:Ke}=T({mutationFn:e=>o.batchDeleteRoles(e),successMessage:`批量删除成功`,onSuccess:()=>{V.value?.clearSelection(),z()}}),{mutate:qe}=T({mutationFn:({id:e,permissions:t})=>o.updateRolePermissions(e,t),successMessage:`权限分配成功`,onSuccess:()=>{W.value=!1,K.value=null,z()}}),Je=p([{id:`dashboard`,name:`仪表盘`,code:`dashboard`,children:[{id:`dashboard:view`,name:`查看仪表盘`,code:`dashboard:view`},{id:`dashboard:export`,name:`导出数据`,code:`dashboard:export`}]},{id:`system`,name:`系统管理`,code:`system`,children:[{id:`system:user`,name:`用户管理`,code:`system:user`,children:[{id:`system:user:view`,name:`查看用户`,code:`system:user:view`},{id:`system:user:create`,name:`创建用户`,code:`system:user:create`},{id:`system:user:update`,name:`编辑用户`,code:`system:user:update`},{id:`system:user:delete`,name:`删除用户`,code:`system:user:delete`}]},{id:`system:organization`,name:`组织架构`,code:`system:organization`,children:[{id:`system:organization:view`,name:`查看部门`,code:`system:organization:view`},{id:`system:organization:create`,name:`创建部门`,code:`system:organization:create`},{id:`system:organization:update`,name:`编辑部门`,code:`system:organization:update`},{id:`system:organization:delete`,name:`删除部门`,code:`system:organization:delete`}]},{id:`system:role`,name:`角色管理`,code:`system:role`,children:[{id:`system:role:view`,name:`查看角色`,code:`system:role:view`},{id:`system:role:create`,name:`创建角色`,code:`system:role:create`},{id:`system:role:update`,name:`编辑角色`,code:`system:role:update`},{id:`system:role:delete`,name:`删除角色`,code:`system:role:delete`},{id:`system:role:permission`,name:`分配权限`,code:`system:role:permission`}]},{id:`system:menu`,name:`菜单管理`,code:`system:menu`,children:[{id:`system:menu:view`,name:`查看菜单`,code:`system:menu:view`},{id:`system:menu:create`,name:`创建菜单`,code:`system:menu:create`},{id:`system:menu:update`,name:`编辑菜单`,code:`system:menu:update`},{id:`system:menu:delete`,name:`删除菜单`,code:`system:menu:delete`}]}]},{id:`products`,name:`商品管理`,code:`products`,children:[{id:`products:view`,name:`查看商品`,code:`products:view`},{id:`products:create`,name:`创建商品`,code:`products:create`},{id:`products:update`,name:`编辑商品`,code:`products:update`},{id:`products:delete`,name:`删除商品`,code:`products:delete`}]},{id:`orders`,name:`订单管理`,code:`orders`,children:[{id:`orders:view`,name:`查看订单`,code:`orders:view`},{id:`orders:create`,name:`创建订单`,code:`orders:create`},{id:`orders:update`,name:`编辑订单`,code:`orders:update`},{id:`orders:delete`,name:`删除订单`,code:`orders:delete`}]}]),B=p({keyword:``}),Ye={layout:`inline`,fields:[{name:`keyword`,type:`input`,label:``,placeholder:`搜索角色名称或编码...`,className:`w-[280px]`}],searchConfig:{enabled:!0,collapsed:!1,showCollapseButton:!1,searchText:`搜索`,resetText:`重置`,showReset:!0,onSearch:e=>{R.value=e.keyword||``},onReset:()=>{R.value=``}}},V=p(),Xe=l(()=>({columns:[{title:`角色名称`,dataIndex:`name`,width:180,slot:`name`},{title:`角色编码`,dataIndex:`code`,width:150},{title:`用户数`,dataIndex:`userCount`,width:100,align:`center`,slot:`userCount`},{title:`权限数`,dataIndex:`permissions`,width:100,align:`center`,slot:`permissionCount`},{title:`状态`,dataIndex:`status`,width:100,slot:`status`},{title:`描述`,dataIndex:`description`,ellipsis:!0,slot:`description`},{title:`创建时间`,dataIndex:`createdAt`,width:150}],pagination:{pageSize:10,show:!0,showSizeChanger:!0,showQuickJumper:!0,total:Be.value},rowSelection:{type:`checkbox`,show:!0},actions:[{text:`权限`,type:`default`,onClick:e=>ct(e)},{text:`编辑`,type:`primary`,onClick:e=>et(e)},{text:`删除`,type:`danger`,confirm:!0,confirmText:`确定要删除该角色吗？此操作不可恢复。`,onClick:e=>rt(e.id)}],actionWidth:260,actionFixed:`right`})),H=p(!1),U=p(!1),W=p(!1),G=p(null),K=p(null),q=p([]),Ze=p([`system`]),J=p({name:``,code:``,description:``,permissions:[],status:`active`}),Y=p({id:``,name:``,code:``,description:``,permissions:[],status:`active`}),Qe={layout:`horizontal`,labelCol:{span:6},wrapperCol:{span:18},fields:[{name:`name`,type:`input`,label:`角色名称`,placeholder:`请输入角色名称`,rules:[{required:!0,message:`角色名称不能为空`},{min:2,message:`角色名称至少2个字符`}]},{name:`code`,type:`input`,label:`角色编码`,placeholder:`请输入角色编码`,rules:[{required:!0,message:`角色编码不能为空`},{pattern:/^[A-Za-z0-9_]+$/,message:`编码只能包含字母、数字和下划线`}]},{name:`status`,type:`select`,label:`状态`,placeholder:`请选择状态`,options:[{label:`启用`,value:`active`},{label:`禁用`,value:`inactive`}],rules:[{required:!0,message:`请选择状态`}]},{name:`description`,type:`textarea`,label:`描述`,placeholder:`请输入角色描述`,rows:3}],actions:{showSubmit:!0,showReset:!0,submitText:`添加角色`,resetText:`取消`,align:`right`,onReset:()=>{H.value=!1}}},$e={layout:`horizontal`,labelCol:{span:6},wrapperCol:{span:18},fields:[{name:`name`,type:`input`,label:`角色名称`,placeholder:`请输入角色名称`,rules:[{required:!0,message:`角色名称不能为空`},{min:2,message:`角色名称至少2个字符`}]},{name:`code`,type:`input`,label:`角色编码`,placeholder:`请输入角色编码`,disabled:!0,rules:[{required:!0,message:`角色编码不能为空`}]},{name:`status`,type:`select`,label:`状态`,placeholder:`请选择状态`,options:[{label:`启用`,value:`active`},{label:`禁用`,value:`inactive`}],rules:[{required:!0,message:`请选择状态`}]},{name:`description`,type:`textarea`,label:`描述`,placeholder:`请输入角色描述`,rows:3}],actions:{showSubmit:!0,showReset:!0,submitText:`保存修改`,resetText:`取消`,align:`right`,onReset:()=>{U.value=!1}}};function et(e){G.value=e,Y.value={id:e.id,name:e.name,code:e.code,description:e.description,permissions:e.permissions||[],status:e.status},U.value=!0}function tt(e){Ue(e)}function nt(e){G.value&&We({id:G.value.id,values:e})}function rt(e){Ge(e)}let X=p([]),Z=p([]);function it(e,t){X.value=e,Z.value=t}function at(){if(X.value.length===0){alert(`请先选择要删除的角色`);return}confirm(`确定要删除选中的 ${X.value.length} 个角色吗？`)&&Ke(X.value)}function ot(e){e.current!==void 0&&Ve(e.current),e.pageSize!==void 0&&He(e.pageSize)}function st(){J.value={name:``,code:``,description:``,permissions:[],status:`active`}}function ct(e){K.value=e,q.value=[...e.permissions||[]],W.value=!0}function lt(e){q.value=e}function ut(){K.value&&qe({id:K.value.id,permissions:q.value})}let dt=l(()=>{let e=L.value||[],n=e.length,r=e.filter(e=>e.status===`active`).length,i=e.reduce((e,t)=>e+(t.userCount||0),0),a=e.reduce((e,t)=>e+(t.permissions?.length||0),0);return[{title:`角色总数`,value:n,icon:t,color:`text-blue-500`},{title:`启用角色`,value:r,icon:re,color:`text-green-500`},{title:`关联用户`,value:i,icon:te,color:`text-purple-500`},{title:`权限总数`,value:a,icon:f,color:`text-orange-500`}]}),Q=l(()=>{let e=t=>t.map(t=>({key:t.id,title:t.name,children:t.children?e(t.children):void 0}));return e(Je.value)});function $(e){let t=[e.key];return e.children&&e.children.length>0&&e.children.forEach(e=>{t.push(...$(e))}),t}return(n,o)=>(c(),y(`div`,pe,[g(`div`,me,[o[14]||=g(`div`,null,[g(`h1`,{class:`text-3xl font-bold tracking-tight`},`角色管理`),g(`p`,{class:`text-muted-foreground mt-1.5 text-sm`},`管理系统角色和权限分配`)],-1),s(_(e),{class:`gap-2`,onClick:o[0]||=e=>H.value=!0},{default:h(()=>[s(_(a),{class:`h-4 w-4`}),o[13]||=v(` 添加角色 `,-1)]),_:1})]),g(`div`,he,[(c(!0),y(ne,null,i(_(dt),e=>(c(),y(`div`,{key:e.title,class:`flex items-center gap-3 px-4 py-2.5 bg-muted/50 rounded-lg hover:bg-muted/70 transition-colors`},[(c(),b(ee(e.icon),{class:r([`h-4 w-4`,e.color])},null,8,[`class`])),g(`div`,ge,[g(`span`,_e,m(e.value),1),g(`span`,E,m(e.title),1)])]))),128))]),g(`div`,D,[g(`div`,O,[g(`div`,k,[s(_(C),{modelValue:_(B),"onUpdate:modelValue":o[1]||=e=>d(B)?B.value=e:null,schema:Ye},null,8,[`modelValue`])]),_(X).length>0?(c(),y(`div`,A,[g(`span`,j,`已选 `+m(_(X).length)+` 项`,1),s(_(e),{variant:`outline`,size:`sm`,class:`h-8 text-xs text-destructive hover:text-destructive`,onClick:at},{default:h(()=>[...o[15]||=[v(` 批量删除 `,-1)]]),_:1})])):u(``,!0)])]),s(_(ie),{class:`border-0 shadow-sm`},{default:h(()=>[s(_(oe),{class:`pb-4`},{default:h(()=>[g(`div`,M,[g(`div`,N,[s(_(se),{class:`text-base font-semibold`},{default:h(()=>[...o[16]||=[v(`角色列表`,-1)]]),_:1}),g(`span`,P,` 共 `+m(_(L)?.length||0)+` 个角色 `,1)])])]),_:1}),s(_(ae),{class:`pt-0`},{default:h(()=>[s(_(ue),{ref_key:`tableRef`,ref:V,data:_(L),"onUpdate:data":o[3]||=e=>d(L)?L.value=e:null,schema:_(Xe),loading:_(Le),onSelectChange:it,onChange:ot},{name:h(e=>[g(`div`,F,[s(_(t),{class:`h-4 w-4 text-muted-foreground`}),g(`span`,I,m(e.text),1)])]),userCount:h(e=>[s(_(S),{color:`blue`},{default:h(()=>[v(m(e.text)+`人`,1)]),_:2},1024)]),permissionCount:h(e=>[s(_(S),{color:`purple`},{default:h(()=>[v(m(e.text?.length||0),1)]),_:2},1024)]),status:h(e=>[s(_(x),{class:r({"bg-green-500/10 text-green-500 border-green-500/20":e.text===`active`,"bg-gray-500/10 text-gray-500 border-gray-500/20":e.text===`inactive`}),variant:`outline`},{default:h(()=>[v(m(e.text===`active`?`启用`:`禁用`),1)]),_:2},1032,[`class`])]),description:h(e=>[e.text?(c(),b(_(le),{key:0,title:e.text},{default:h(()=>[g(`span`,ve,m(e.text),1)]),_:2},1032,[`title`])):(c(),y(`span`,ye,`-`))]),emptyText:h(()=>[g(`div`,be,[g(`div`,xe,[s(_(t),{class:`w-8 h-8 text-primary/50`})]),o[18]||=g(`p`,{class:`text-base font-medium mb-1`},`暂无角色数据`,-1),o[19]||=g(`p`,{class:`text-sm text-muted-foreground mb-4`},`开始添加您的第一个角色吧`,-1),s(_(e),{size:`sm`,onClick:o[2]||=e=>H.value=!0},{default:h(()=>[s(_(a),{class:`h-4 w-4 mr-1`}),o[17]||=v(` 添加角色 `,-1)]),_:1})])]),_:1},8,[`data`,`schema`,`loading`])]),_:1})]),_:1}),s(_(w),{open:_(H),"onUpdate:open":o[5]||=e=>d(H)?H.value=e:null,title:`添加角色`,width:`560`},{default:h(()=>[s(_(C),{modelValue:_(J),"onUpdate:modelValue":o[4]||=e=>d(J)?J.value=e:null,schema:Qe,onSubmit:tt},null,8,[`modelValue`])]),_:1},8,[`open`]),s(_(w),{open:_(U),"onUpdate:open":o[7]||=e=>d(U)?U.value=e:null,title:`编辑角色`,width:`560`},{default:h(()=>[_(G)?(c(),b(_(C),{key:0,modelValue:_(Y),"onUpdate:modelValue":o[6]||=e=>d(Y)?Y.value=e:null,schema:$e,onSubmit:nt},null,8,[`modelValue`])):u(``,!0)]),_:1},8,[`open`]),s(_(fe),{open:_(W),"onUpdate:open":o[12]||=e=>d(W)?W.value=e:null,title:`权限分配`,width:`520`},{footer:h(()=>[g(`div`,Ie,[s(_(e),{variant:`outline`,onClick:o[11]||=e=>W.value=!1},{default:h(()=>[...o[25]||=[v(` 取消 `,-1)]]),_:1}),s(_(e),{onClick:ut},{default:h(()=>[...o[26]||=[v(` 保存 `,-1)]]),_:1})])]),default:h(()=>[_(K)?(c(),y(`div`,Se,[g(`div`,Ce,[g(`div`,we,[s(_(t),{class:`h-5 w-5 text-primary`})]),g(`div`,Te,[g(`div`,Ee,m(_(K).name),1),g(`div`,De,m(_(K).code),1)]),s(_(x),{class:r({"bg-green-500/10 text-green-500 border-green-500/20":_(K).status===`active`,"bg-gray-500/10 text-gray-500 border-gray-500/20":_(K).status===`inactive`}),variant:`outline`},{default:h(()=>[v(m(_(K).status===`active`?`启用`:`禁用`),1)]),_:1},8,[`class`])]),g(`div`,Oe,[g(`div`,ke,[o[20]||=g(`span`,{class:`text-sm font-medium`},`权限列表`,-1),s(_(S),{color:`blue`},{default:h(()=>[v(m(_(Q).length)+` 个模块`,1)]),_:1})]),g(`div`,Ae,[s(_(e),{variant:`ghost`,size:`sm`,class:`h-7 text-xs`,onClick:o[8]||=e=>q.value=_(Q).flatMap($)},{default:h(()=>[...o[21]||=[v(` 全选 `,-1)]]),_:1}),s(_(e),{variant:`ghost`,size:`sm`,class:`h-7 text-xs`,onClick:o[9]||=e=>q.value=[]},{default:h(()=>[...o[22]||=[v(` 清空 `,-1)]]),_:1})])]),g(`div`,je,[s(_(ce),{"checked-keys":_(q),"onUpdate:checkedKeys":o[10]||=e=>d(q)?q.value=e:null,"tree-data":_(Q),"expanded-keys":_(Ze),checkable:``,onCheck:lt},null,8,[`checked-keys`,`tree-data`,`expanded-keys`])]),g(`div`,Me,[g(`div`,Ne,[s(_(f),{class:`h-4 w-4 text-muted-foreground`}),o[23]||=g(`span`,{class:`text-sm text-muted-foreground`},`已选择`,-1)]),g(`div`,Pe,[g(`span`,Fe,m(_(q).length),1),o[24]||=g(`span`,{class:`text-sm text-muted-foreground`},`个权限`,-1)])])])):u(``,!0)]),_:1},8,[`open`])]))}});export{L as default};