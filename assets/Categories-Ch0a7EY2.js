import"./ScrollArea-u7vgQcwr.js";import"./RovingFocusItem-tfPyown7.js";import"./Presence-CTcpkTiJ.js";import"./TabsTrigger-BVA-KY5p.js";import{Bi as e,Ha as t,Ii as n,J as ee,Ki as r,Li as i,Lt as te,Pa as a,Ri as o,Ui as s,V as c,Wa as l,Wi as u,Yn as d,dr as f,ji as ne,ka as p,la as re,n as m,pa as ie,qa as h,sa as g,ut as ae,wa as _,x as v,yt as y,zi as b}from"./index-Bdnse1ke.js";import"./en_US-B-0xvqcl.js";import"./common-B6eu2cAW.js";import"./zh_CN-o6dt8jMH.js";import"./useFullscreen-Cz-fRWjR.js";import"./_plugin-vue_export-helper-CuErARa7.js";import{t as x}from"./badge-CifgcTtr.js";import"./dist-CIVP1JAM.js";import"./theme-shared-CKGE9ZaP.js";import{t as oe}from"./TTable-BqF1vWP0.js";import"./useTableColumns-ClPoF4Nv.js";import"./useResponsive-Drj8-vqi.js";import{t as S}from"./TForm-D3MGp7pF.js";import"./TIcon-BqmThimp.js";import{t as C}from"./TModal-C-7FBAha.js";import{n as se,t as ce}from"./CardContent-CE0o8nDP.js";import{n as le,t as ue}from"./CardTitle-BRqhnrl0.js";import{n as de}from"./composables-cmucIgPx.js";import"./constants-OTiF8S51.js";var fe={class:`space-y-6`},pe={class:`flex flex-col sm:flex-row sm:items-center justify-between gap-4`},me={class:`flex flex-wrap gap-3`},he={class:`flex items-baseline gap-2`},ge={class:`text-lg font-semibold`},w={class:`text-xs text-muted-foreground`},T={class:`bg-muted/40 border border-border/50 rounded-xl px-3 py-3`},E={class:`flex flex-col lg:flex-row lg:items-center gap-4`},D={class:`flex-1`},O={key:0,class:`flex items-center gap-2 lg:border-l lg:pl-4`},k={class:`text-sm text-muted-foreground`},A={class:`flex items-center justify-between`},j={class:`flex items-center gap-3`},M={class:`text-xs text-muted-foreground bg-muted px-2 py-0.5 rounded-full`},N={class:`flex items-center gap-2 text-sm text-muted-foreground`},P={class:`flex items-center gap-2`},F={class:`font-medium`},I={class:`flex flex-col items-center justify-center py-12 text-muted-foreground`},L={class:`w-16 h-16 rounded-full bg-muted flex items-center justify-center mb-4`},R=r({__name:`Categories`,setup(r){let{data:R,loading:_e,searchQuery:z,filters:B,currentPage:ve,pageSize:ye,total:be,statistics:V,fetchData:H,goToPage:xe,setPageSize:Se,addData:Ce,updateData:we,removeData:Te,batchRemoveData:Ee}=de({apiCall:async e=>await d.getCategories(e)||{list:[],total:0,page:1,pageSize:10},apiCallParams:e=>({page:e.page,pageSize:e.pageSize,search:e.searchQuery,level:e.filters.level,status:e.filters.status}),statisticsFn:e=>({total:e.length,level1:e.filter(e=>e.level===1).length,level2:e.filter(e=>e.level===2).length,active:e.filter(e=>e.status===f.ACTIVE).length,totalProducts:e.reduce((e,t)=>e+(t.productCount||0),0)})}),De=n(()=>{let e=V.value||{};return[{title:`总分类`,value:e.total||0,icon:y,color:`text-blue-500`},{title:`一级分类`,value:e.level1||0,icon:ae,color:`text-purple-500`},{title:`二级分类`,value:e.level2||0,icon:v,color:`text-orange-500`},{title:`已启用`,value:e.active||0,icon:te,color:`text-green-500`}]}),U=a({keyword:``,level:``,status:``}),Oe={layout:`inline`,fields:[{name:`keyword`,type:`input`,label:``,placeholder:`搜索分类名称...`,className:`w-[200px]`},{name:`level`,type:`select`,label:``,placeholder:`全部级别`,options:[{label:`全部级别`,value:``},{label:`一级分类`,value:`1`},{label:`二级分类`,value:`2`}],className:`w-[140px]`},{name:`status`,type:`select`,label:``,placeholder:`全部状态`,options:[{label:`全部状态`,value:``},{label:`启用`,value:f.ACTIVE},{label:`禁用`,value:f.INACTIVE}],className:`w-[140px]`}],searchConfig:{enabled:!0,collapsed:!1,showCollapseButton:!1,searchText:`搜索`,resetText:`重置`,showReset:!0,onSearch:e=>{z.value=e.keyword||``,B.value={level:e.level?Number(e.level):void 0,status:e.status}},onReset:()=>{z.value=``,B.value={}}}},W=a(),ke=n(()=>({columns:[{title:`分类名称`,dataIndex:`name`,width:180,slot:`name`},{title:`分类编码`,dataIndex:`code`,width:150},{title:`级别`,dataIndex:`level`,width:100,slot:`level`},{title:`上级分类`,dataIndex:`parentName`,width:150,customRender:({text:e})=>e||`-`},{title:`商品数量`,dataIndex:`productCount`,width:100,sorter:!0},{title:`排序`,dataIndex:`sort`,width:80,sorter:!0},{title:`状态`,dataIndex:`status`,width:100,slot:`status`}],pagination:{pageSize:10,show:!0,showSizeChanger:!0},rowSelection:{type:`checkbox`,show:!0},actions:[{text:`编辑`,type:`primary`,onClick:e=>Ne(e)},{text:`删除`,type:`danger`,confirm:!0,confirmText:`确定要删除该分类吗？`,onClick:e=>Pe(e.id)}],actionWidth:150,actionFixed:`right`})),G=n(()=>R.value.filter(e=>e.level===1)),K=n(()=>R.value.map(e=>({...e,key:e.id}))),q=a(!1),J=a(!1),Y=a(null),X=a({name:``,code:``,level:1,parentId:``,sort:0,status:`active`,description:``}),Z=a({id:``,name:``,code:``,level:1,parentId:``,sort:0,status:`active`,description:``}),Ae={layout:`horizontal`,labelCol:{span:6},wrapperCol:{span:18},fields:[{name:`name`,type:`input`,label:`分类名称`,placeholder:`请输入分类名称`,rules:[{required:!0,message:`分类名称不能为空`}]},{name:`code`,type:`input`,label:`分类编码`,placeholder:`请输入分类编码`,rules:[{required:!0,message:`分类编码不能为空`}]},{name:`level`,type:`select`,label:`分类级别`,placeholder:`请选择级别`,options:[{label:`一级分类`,value:1},{label:`二级分类`,value:2}],rules:[{required:!0,message:`请选择分类级别`}]},{name:`parentId`,type:`select`,label:`上级分类`,placeholder:`请选择上级分类`,options:()=>G.value.map(e=>({label:e.name,value:e.id})),show:()=>X.value.level===2},{name:`sort`,type:`number`,label:`排序`,placeholder:`请输入排序号`},{name:`status`,type:`select`,label:`状态`,placeholder:`请选择状态`,options:[{label:`启用`,value:`active`},{label:`禁用`,value:`inactive`}]},{name:`description`,type:`textarea`,label:`描述`,placeholder:`请输入描述（可选）`}],actions:{showSubmit:!0,showReset:!0,submitText:`添加分类`,resetText:`取消`,align:`right`,onReset:()=>{q.value=!1}}},je={layout:`horizontal`,labelCol:{span:6},wrapperCol:{span:18},fields:[{name:`name`,type:`input`,label:`分类名称`,placeholder:`请输入分类名称`,rules:[{required:!0,message:`分类名称不能为空`}]},{name:`code`,type:`input`,label:`分类编码`,placeholder:`请输入分类编码`,rules:[{required:!0,message:`分类编码不能为空`}]},{name:`sort`,type:`number`,label:`排序`,placeholder:`请输入排序号`},{name:`status`,type:`select`,label:`状态`,placeholder:`请选择状态`,options:[{label:`启用`,value:`active`},{label:`禁用`,value:`inactive`}]},{name:`description`,type:`textarea`,label:`描述`,placeholder:`请输入描述（可选）`}],actions:{showSubmit:!0,showReset:!0,submitText:`保存修改`,resetText:`取消`,align:`right`,onReset:()=>{J.value=!1}}};async function Me(e){let t=G.value.find(t=>t.id===e.parentId);await d.createCategory({name:e.name,code:e.code,level:e.level,parentId:e.level===2?e.parentId:void 0,parentName:t?.name,sort:Number(e.sort)||0,status:e.status,productCount:0,description:e.description}),q.value=!1,X.value={name:``,code:``,level:1,parentId:``,sort:0,status:`active`,description:``},await H()}function Ne(e){Y.value=e,Z.value={id:e.id,name:e.name,code:e.code,level:e.level,parentId:e.parentId||``,sort:e.sort,status:e.status,description:e.description||``},J.value=!0}async function Q(e){Y.value&&(d.updateCategory(Y.value.id,{name:e.name,code:e.code,sort:Number(e.sort),status:e.status,description:e.description}),J.value=!1,Y.value=null,H())}async function Pe(e){await d.deleteCategory(e),await H()}let $=a([]);function Fe(e){$.value=e}async function Ie(){if($.value.length===0){alert(`请先选择要删除的分类`);return}confirm(`确定要删除选中的 ${$.value.length} 个分类吗？`)&&(await d.batchDeleteCategories($.value.map(String)),W.value?.clearSelection(),await H())}function Le(e){e.current!==void 0&&xe(e.current),e.pageSize!==void 0&&Se(e.pageSize)}return(n,r)=>(g(),e(`div`,fe,[i(`div`,pe,[r[9]||=i(`div`,null,[i(`h1`,{class:`text-3xl font-bold tracking-tight`},`分类管理`),i(`p`,{class:`text-muted-foreground mt-1.5 text-sm`},`管理商品分类和层级`)],-1),u(t(m),{class:`gap-2`,onClick:r[0]||=e=>q.value=!0},{default:_(()=>[u(t(c),{class:`h-4 w-4`}),r[8]||=s(` 添加分类 `,-1)]),_:1})]),u(t(C),{open:t(q),"onUpdate:open":r[2]||=e=>p(q)?q.value=e:null,title:`添加分类`,width:`560`,footer:null},{default:_(()=>[u(t(S),{modelValue:t(X),"onUpdate:modelValue":r[1]||=e=>p(X)?X.value=e:null,schema:Ae,onSubmit:Me},null,8,[`modelValue`])]),_:1},8,[`open`]),u(t(C),{open:t(J),"onUpdate:open":r[4]||=e=>p(J)?J.value=e:null,title:`编辑分类`,width:`560`,footer:null},{default:_(()=>[t(Y)?(g(),o(t(S),{key:0,modelValue:t(Z),"onUpdate:modelValue":r[3]||=e=>p(Z)?Z.value=e:null,schema:je,onSubmit:Q},null,8,[`modelValue`])):b(``,!0)]),_:1},8,[`open`]),i(`div`,me,[(g(!0),e(ne,null,re(t(De),t=>(g(),e(`div`,{key:t.title,class:`flex items-center gap-3 px-4 py-2.5 bg-muted/50 rounded-lg hover:bg-muted/70 transition-colors`},[(g(),o(ie(t.icon),{class:l([`h-4 w-4`,t.color])},null,8,[`class`])),i(`div`,he,[i(`span`,ge,h(t.value),1),i(`span`,w,h(t.title),1)])]))),128))]),i(`div`,T,[i(`div`,E,[i(`div`,D,[u(t(S),{modelValue:t(U),"onUpdate:modelValue":r[5]||=e=>p(U)?U.value=e:null,schema:Oe},null,8,[`modelValue`])]),t($).length>0?(g(),e(`div`,O,[i(`span`,k,`已选 `+h(t($).length)+` 项`,1),u(t(m),{variant:`outline`,size:`sm`,class:`h-8 text-xs text-destructive hover:text-destructive`,onClick:Ie},{default:_(()=>[...r[10]||=[s(` 批量删除 `,-1)]]),_:1})])):b(``,!0)])]),u(t(se),{class:`bg-muted/40 border border-border/50 rounded-xl`},{default:_(()=>[u(t(le),{class:`pb-4`},{default:_(()=>[i(`div`,A,[i(`div`,j,[u(t(ue),{class:`text-base font-semibold`},{default:_(()=>[...r[11]||=[s(`分类列表`,-1)]]),_:1}),i(`span`,M,` 共 `+h(t(K).length)+` 个 `,1)]),i(`div`,N,[u(t(ee),{class:`h-4 w-4`}),i(`span`,null,`关联商品: `+h(t(V).totalProducts||0),1)])])]),_:1}),u(t(ce),{class:`pt-0`},{default:_(()=>[u(t(oe),{ref_key:`tableRef`,ref:W,data:t(K),"onUpdate:data":r[7]||=e=>p(K)?K.value=e:null,schema:t(ke),onSelectChange:Fe,onChange:Le},{name:_(e=>[i(`div`,P,[e.record.level===1?(g(),o(t(y),{key:0,class:`h-4 w-4 text-blue-500`})):(g(),o(t(v),{key:1,class:`h-4 w-4 text-orange-500`})),i(`span`,F,h(e.text),1)])]),level:_(e=>[u(t(x),{variant:e.text===1?`default`:`secondary`},{default:_(()=>[s(h(e.text===1?`一级`:`二级`),1)]),_:2},1032,[`variant`])]),status:_(e=>[u(t(x),{class:l({"bg-green-500/10 text-green-500 border-green-500/20":e.text===t(f).ACTIVE,"bg-gray-500/10 text-gray-500 border-gray-500/20":e.text===t(f).INACTIVE}),variant:`outline`},{default:_(()=>[s(h(e.text===t(f).ACTIVE?`启用`:`禁用`),1)]),_:2},1032,[`class`])]),emptyText:_(()=>[i(`div`,I,[i(`div`,L,[u(t(y),{class:`w-8 h-8 text-muted-foreground/50`})]),r[13]||=i(`p`,{class:`text-base font-medium mb-1`},`暂无分类数据`,-1),r[14]||=i(`p`,{class:`text-sm text-muted-foreground mb-4`},`开始添加您的第一个分类吧`,-1),u(t(m),{size:`sm`,onClick:r[6]||=e=>q.value=!0},{default:_(()=>[u(t(c),{class:`h-4 w-4 mr-1`}),r[12]||=s(` 添加分类 `,-1)]),_:1})])]),_:1},8,[`data`,`schema`])]),_:1})]),_:1})]))}});export{R as default};