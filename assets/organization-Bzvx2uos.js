import"./ScrollArea-CW0-18Hy.js";import"./RovingFocusItem-DihGLheP.js";import{t as e}from"./button-Bo4o88Eb.js";import"./Presence-CX2vXdhf.js";import"./defu-BJL4Fjh2.js";import"./usePrimitiveElement-bvCn2QxH.js";import"./TabsTrigger-EHjOJe4X.js";import{B as t,Di as n,E as r,Ea as i,Fn as a,Gi as o,It as s,M as c,Ti as l,Ui as u,Yi as ee,_i as d,a as f,bi as p,da as m,fi as h,ga as g,ka as _,oa as v,vi as y,wa as b,wi as x,xi as S,yi as C}from"./index-D9LA8apy.js";import"./en_US-N9Q-_HQi.js";import"./common-rttX-sZZ.js";import"./zh_CN-RQJLYl9H.js";import"./useTabBar-WvhELTvw.js";import{t as w}from"./badge-DoBLqkFL.js";import{n as te,t as ne}from"./CardContent-bGWyUVF7.js";import{n as re,t as ie}from"./CardTitle-9YsRePqj.js";import"./dist-guKItzxh.js";import{t as ae}from"./TTable-BJXg8Gts.js";import{t as T}from"./TForm-De-AxzjP.js";import"./Input-DxyLxkUT.js";import"./TIcon-DpsAxes7.js";import{t as E}from"./TModal-l0DmcJma.js";import{n as D,r as O}from"./composables-B_2v-ght.js";var k={class:`space-y-6`},A={class:`flex flex-col sm:flex-row sm:items-center justify-between gap-4`},oe={class:`flex flex-wrap gap-3`},se={class:`flex items-baseline gap-2`},j={class:`text-lg font-semibold`},M={class:`text-xs text-muted-foreground`},N={class:`bg-muted/30 rounded-lg p-4`},P={class:`flex items-center gap-2`},F={class:`font-medium`},I={class:`flex flex-col items-center justify-center py-12 text-muted-foreground`},L={class:`w-16 h-16 rounded-full bg-muted flex items-center justify-center mb-4`},R=n({__name:`index`,setup(n){let{data:R,loading:z,searchQuery:B,fetchData:V}=D({apiCall:async e=>await a.getOrganizations(e)||{list:[],total:0,page:1,pageSize:10},apiCallParams:e=>({search:e.searchQuery})});function H(e){let t=new Map,n=[];return e.forEach(e=>{t.set(e.id,{...e})}),e.forEach(e=>{let r=t.get(e.id);if(e.parentId&&t.has(e.parentId)){let n=t.get(e.parentId);n.children||=[],n.children.push(r),n.children.sort((e,t)=>e.sort-t.sort)}else n.push(r)}),n.sort((e,t)=>e.sort-t.sort)}let U=d(()=>H(R.value)),{mutate:W}=O({mutationFn:e=>a.createOrganization({name:e.name,code:e.code,parentId:e.parentId||null,leader:e.leader,description:e.description,sort:e.sort||0,status:e.status}),successMessage:`部门创建成功`,onSuccess:()=>{q.value=!1,xe(),V()}}),{mutate:G}=O({mutationFn:({id:e,values:t})=>a.updateOrganization(e,{name:t.name,code:t.code,parentId:t.parentId||null,leader:t.leader,description:t.description,sort:t.sort,status:t.status}),successMessage:`部门更新成功`,onSuccess:()=>{J.value=!1,Y.value=null,V()}}),{mutate:ce}=O({mutationFn:e=>a.deleteOrganization(e),successMessage:`部门删除成功`,onSuccess:()=>V()}),{mutate:le}=O({mutationFn:({id:e,status:t})=>a.updateOrganizationStatus(e,t),successMessage:`状态更新成功`,onSuccess:()=>V()}),K=g({keyword:``}),ue={layout:`inline`,fields:[{name:`keyword`,type:`input`,label:``,placeholder:`搜索部门名称或编码...`,className:`w-[280px]`}],searchConfig:{enabled:!0,collapsed:!1,showCollapseButton:!1,searchText:`搜索`,resetText:`重置`,showReset:!0,onSearch:e=>{B.value=e.keyword||``},onReset:()=>{B.value=``}}},de=g(),fe=d(()=>({columns:[{title:`部门名称`,dataIndex:`name`,width:220,slot:`name`},{title:`部门编码`,dataIndex:`code`,width:140,ellipsis:!0},{title:`负责人`,dataIndex:`leader`,width:120},{title:`成员数`,dataIndex:`memberCount`,width:80,align:`center`},{title:`排序`,dataIndex:`sort`,width:60,align:`center`},{title:`状态`,dataIndex:`status`,width:80,slot:`status`},{title:`创建时间`,dataIndex:`createdAt`,width:160}],childrenColumnName:`children`,indentSize:20,expandable:{defaultExpandAllRows:!0},pagination:!1,actions:[{text:`编辑`,type:`primary`,onClick:e=>ge(e)},{text:`删除`,type:`danger`,confirm:!0,confirmText:`确定要删除该部门吗？子部门也会被删除，此操作不可恢复。`,onClick:e=>ye(e.id)}],actionWidth:150,actionFixed:`right`})),q=g(!1),J=g(!1),Y=g(null);function X(){return{name:``,code:``,parentId:null,leader:``,description:``,sort:0,status:`active`}}let Z=g(X()),Q=g({id:``,...X()});d(()=>[{label:`顶级部门`,value:null},...(R.value||[]).map(e=>({label:e.name,value:e.id}))]);let pe=d(()=>{let e=t=>t.map(t=>({title:t.name,value:t.id,key:t.id,children:t.children?e(t.children):void 0}));return[{title:`顶级部门`,value:``,key:`root`,children:e(U.value)}]});function $(e){return[{name:`name`,type:`input`,label:`部门名称`,placeholder:`请输入部门名称`,rules:[{required:!0,message:`部门名称不能为空`},{min:2,message:`部门名称至少2个字符`}]},{name:`code`,type:`input`,label:`部门编码`,placeholder:`请输入部门编码`,disabled:e,rules:[{required:!0,message:`部门编码不能为空`},{pattern:/^[A-Za-z0-9_-]+$/,message:`编码只能包含字母、数字、下划线和横线`}]},{name:`parentId`,type:`tree-select`,label:`上级部门`,placeholder:`请选择上级部门`,options:pe.value,disabled:e,props:{treeDefaultExpandAll:!0,allowClear:!0,showSearch:!0,treeNodeFilterProp:`title`}},{name:`leader`,type:`input`,label:`负责人`,placeholder:`请输入负责人姓名`},{name:`sort`,type:`number`,label:`排序`,placeholder:`请输入排序号`,min:0},{name:`status`,type:`select`,label:`状态`,placeholder:`请选择状态`,options:[{label:`启用`,value:`active`},{label:`禁用`,value:`inactive`}],rules:[{required:!0,message:`请选择状态`}]},{name:`description`,type:`textarea`,label:`描述`,placeholder:`请输入部门描述`,rows:3}]}let me=d(()=>({layout:`horizontal`,columns:2,labelCol:{span:8},wrapperCol:{span:16},fields:$(!1),actions:{showSubmit:!0,showReset:!0,submitText:`添加部门`,resetText:`取消`,align:`right`,onReset:()=>{q.value=!1}}})),he=d(()=>({layout:`horizontal`,columns:2,labelCol:{span:8},wrapperCol:{span:16},fields:$(!0),actions:{showSubmit:!0,showReset:!0,submitText:`保存修改`,resetText:`取消`,align:`right`,onReset:()=>{J.value=!1}}}));function ge(e){Y.value=e,Q.value={id:e.id,name:e.name,code:e.code,parentId:e.parentId,leader:e.leader,description:e.description,sort:e.sort,status:e.status},J.value=!0}function _e(e){W(e)}function ve(e){Y.value&&G({id:Y.value.id,values:e})}function ye(e){ce(e)}function be(e){let t=e.status===`active`?`inactive`:`active`;le({id:e.id,status:t})}function xe(){Z.value=X()}let Se=d(()=>{let e=R.value||[],n=e.length,r=e.filter(e=>e.status===`active`).length,i=e.filter(e=>e.parentId===null).length,a=e.reduce((e,t)=>e+(t.memberCount||0),0);return[{title:`部门总数`,value:n,icon:s,color:`text-blue-500`},{title:`启用部门`,value:r,icon:t,color:`text-green-500`},{title:`顶级部门`,value:i,icon:s,color:`text-purple-500`},{title:`总成员数`,value:a,icon:f,color:`text-orange-500`}]});return(t,n)=>(u(),S(`div`,k,[y(`div`,A,[n[9]||=y(`div`,null,[y(`h1`,{class:`text-3xl font-bold tracking-tight`},`组织架构`),y(`p`,{class:`text-muted-foreground mt-1.5 text-sm`},`管理部门组织架构和层级关系`)],-1),l(b(e),{class:`gap-2`,onClick:n[0]||=e=>q.value=!0},{default:v(()=>[l(b(c),{class:`h-4 w-4`}),n[8]||=x(` 添加部门 `,-1)]),_:1})]),y(`div`,oe,[(u(!0),S(h,null,o(b(Se),e=>(u(),S(`div`,{key:e.title,class:`flex items-center gap-3 px-4 py-2.5 bg-muted/50 rounded-lg hover:bg-muted/70 transition-colors`},[(u(),C(ee(e.icon),{class:i([`h-4 w-4`,e.color])},null,8,[`class`])),y(`div`,se,[y(`span`,j,_(e.value),1),y(`span`,M,_(e.title),1)])]))),128))]),y(`div`,N,[l(b(T),{modelValue:b(K),"onUpdate:modelValue":n[1]||=e=>m(K)?K.value=e:null,schema:ue},null,8,[`modelValue`])]),l(b(te),{class:`border-0 shadow-sm`},{default:v(()=>[l(b(re),{class:`pb-4`},{default:v(()=>[l(b(ie),{class:`text-base font-semibold`},{default:v(()=>[...n[10]||=[x(`部门结构`,-1)]]),_:1})]),_:1}),l(b(ne),{class:`pt-0`},{default:v(()=>[l(b(ae),{ref_key:`tableRef`,ref:de,data:b(U),"onUpdate:data":n[3]||=e=>m(U)?U.value=e:null,schema:b(fe),loading:b(z)},{name:v(({text:e,record:t})=>[y(`div`,P,[l(b(s),{class:`h-4 w-4 text-muted-foreground`}),y(`span`,F,_(e),1),t?.memberCount?(u(),C(b(w),{key:0,variant:`outline`,class:`text-xs bg-muted/50`},{default:v(()=>[x(_(t.memberCount)+`人 `,1)]),_:2},1024)):p(``,!0)])]),status:v(({text:e,record:t})=>[t?(u(),C(b(w),{key:0,class:i({"bg-green-500/10 text-green-500 border-green-500/20 cursor-pointer hover:bg-green-500/20":e===`active`,"bg-gray-500/10 text-gray-500 border-gray-500/20 cursor-pointer hover:bg-gray-500/20":e===`inactive`}),variant:`outline`,onClick:e=>be(t)},{default:v(()=>[x(_(e===`active`?`启用`:`禁用`),1)]),_:2},1032,[`class`,`onClick`])):p(``,!0)]),emptyText:v(()=>[y(`div`,I,[y(`div`,L,[l(b(r),{class:`w-8 h-8 text-muted-foreground/50`})]),n[12]||=y(`p`,{class:`text-base font-medium mb-1`},`暂无部门数据`,-1),n[13]||=y(`p`,{class:`text-sm text-muted-foreground mb-4`},`开始添加您的第一个部门吧`,-1),l(b(e),{size:`sm`,onClick:n[2]||=e=>q.value=!0},{default:v(()=>[l(b(c),{class:`h-4 w-4 mr-1`}),n[11]||=x(` 添加部门 `,-1)]),_:1})])]),_:1},8,[`data`,`schema`,`loading`])]),_:1})]),_:1}),l(b(E),{open:b(q),"onUpdate:open":n[5]||=e=>m(q)?q.value=e:null,title:`添加部门`,width:`700`,footer:null},{default:v(()=>[l(b(T),{modelValue:b(Z),"onUpdate:modelValue":n[4]||=e=>m(Z)?Z.value=e:null,schema:b(me),onSubmit:_e},null,8,[`modelValue`,`schema`])]),_:1},8,[`open`]),l(b(E),{open:b(J),"onUpdate:open":n[7]||=e=>m(J)?J.value=e:null,title:`编辑部门`,width:`700`,footer:null},{default:v(()=>[b(Y)?(u(),C(b(T),{key:0,modelValue:b(Q),"onUpdate:modelValue":n[6]||=e=>m(Q)?Q.value=e:null,schema:b(he),onSubmit:ve},null,8,[`modelValue`,`schema`])):p(``,!0)]),_:1},8,[`open`])]))}});export{R as default};