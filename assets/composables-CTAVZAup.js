import{$r as e,Ar as t,Br as n,Cr as r,Dr as i,Er as a,Fi as o,Fr as s,Gn as c,Gr as l,Hr as u,In as d,Ir as f,Jr as p,Kr as m,Lr as h,Mr as g,Na as _,Nr as v,Or as y,Pr as b,Qr as x,Rr as S,Sr as C,Tr as w,Ur as T,Vr as E,Wr as D,Xr as O,Yr as k,Zr as A,_i as j,ai as M,ci as ee,di as N,ei as P,fi as F,gi as I,hi as L,ii as R,jr as te,kr as z,li as B,mi as ne,ni as re,nr as V,oi as ie,pi as ae,qr as H,ri as oe,si as se,sr as ce,ti as U,ui as le,vi as ue,wr as de,xr as fe,ya as pe,zr as W}from"./index-D6Cod0pL.js";var me=(e,t)=>{let n=null;return function(...r){let i=e.bind(this,...r),a=k(t)?t:t(...r);n&&g(n),a>0?n=F(i,a):i()}},he=(e,t)=>{let n={};for(let r in e)n[r]=t(e[r],r,e);return n},G;(function(e){e[e.USE_REQUEST=1]=`USE_REQUEST`,e[e.USE_WATCHER=2]=`USE_WATCHER`,e[e.USE_FETCHER=3]=`USE_FETCHER`})(G||={});function ge(t,n={trackedKeys:{},bindError:!1,initialRequest:!1,...l()}){let r=e=>t.ref?t.ref(e):{current:e};n=r(n).current;let a=e=>(t.export||w)(e,n),o=e=>{if(!p(t.memorize))return e;let n=t.memorize(e);return n.memorized=!0,n},{dehydrate:s}=t,c=(e,r,i)=>e!==s(r,i,n)&&n.trackedKeys[i]&&t.update(e,r,i,n),u=t=>e(t,e=>m(e,i)?e.e:e),d=[],h={};return{create:(e,r)=>(N(d,r),P(y,t.create(e,r,n),r,e=>s(e,r,n),a,(e,t)=>c(t,e,r))),computed:(e,r,o)=>(W(r,e=>{e.k&&(h[e.k]=!0)}),P(i,t.computed(e,u(r),o,n),o,e=>s(e,o,n),a)),effectRequest:e=>t.effectRequest(e,n),ref:r,watch:(e,r)=>t.watch(u(e),r,n),onMounted:e=>t.onMounted(e,n),onUnmounted:e=>t.onUnmounted(e,n),memorize:o,__referingObj:n,exposeProvider:e=>{let t={},r={},a=[];for(let s in e){let c=e[s];if(p(c)&&!n.trackedKeys[s])t[s]=s.startsWith(`on`)?(...e)=>(c(...e),g):c.memorized?c:o(c);else{!D([`uploading`,`downloading`],s)&&!s.startsWith(`__`)&&N(a,s);let e=m(c,i);e&&(r[s]=c.s),z.defineProperty(t,s,{get:()=>(n.trackedKeys[s]=!0,e?c.e:c),set:U,enumerable:!0,configurable:!0})}}let{update:s,__proxyState:l}=t;n.trackedKeys={...h},n.bindError=!1;let{then:u}=t,g=oe(t,{__referingObj:n,update:o(e=>{R(e).forEach(n=>{D(d,n)?c(e[n],r[n],n):n in t&&p(s)&&s({[n]:e[n]})})}),__proxyState:o(t=>D(d,t)&&m(e[t],i)?(n.trackedKeys[t]=!0,e[t]):l(t)),then(e,t){W(a,e=>{n.trackedKeys[e]=!0});let r=()=>{f(g,`then`),e(g)};p(u)?u(r,t):r()}});return g},objectify:(e,t)=>e.reduce((e,n)=>(e[n.k]=t?n[t]:n,e),{}),transformState2Proxy:(e,t)=>P(y,e,t,e=>s(e,t,n),a,(e,n)=>c(n,e,t))}}v(``);var _e=v(`useRequest`),ve=v(`useWatcher`),ye=v(`useFetcher`),be=e=>({[G.USE_REQUEST]:_e,[G.USE_WATCHER]:ve,[G.USE_FETCHER]:ye})[e],xe=(e,t)=>e(m(t,fe),`expected a method instance.`),K=`success`,q=`error`,J=`complete`,Se=(e,t,n,r)=>({m:void 0,rf:{},fs:{},em:n,ht:e,c:t,ro:r,ms:{}}),Y=class e{constructor(e,t){this.method=e,this.args=t}clone(){return{...this}}static spawn(t,n){return P(e,t,n)}},Ce=class extends Y{constructor(e,t,n){super(e.method,e.args),this.data=t,this.fromCache=n}},we=class extends Y{constructor(e,t){super(e.method,e.args),this.error=t}},Te=class extends Y{constructor(e,t,n,r,i){super(e.method,e.args),this.status=t,this.data=n,this.fromCache=t===`error`?!1:r,this.error=i}},Ee=(e,t)=>t(),De={},Oe=(e,t)=>{let n=De[e]||{};return n[t]?Array.from(n[t]):[]},ke=(e,t,n)=>{let r=De[e]=De[e]||{};r[t]||(r[t]=P(Set)),r[t].add(n)},Ae=(e,t,n)=>{let r=De[e],i=r[t];r&&i&&(n?i.delete(n):i.clear(),i.size===0&&f(r,t))};function je(e,t,r=[]){let i=be(e.ht),a=E(t,i,r),{fs:o,ht:s,c}=e,{loading:l,data:d,error:f}=o,p=s===G.USE_FETCHER,{force:m=!1,middleware:h=Ee}=c,{id:g}=n(a),_=u(a),{abortLast:v=!0}=c,y=!e.m;return e.m=a,(async()=>{let n=U,u=!1,b=B(void 0),x=U,S=U,C=await de(a),w=()=>!!C,T=!1;p||(ke(g,_,e),n=()=>Ae(g,_,e));let E=t=>{u=!0;let{force:i=m,method:s=a}=t||{},c=ae(i,[P(Y,a,r)]),d=e=>({loaded:t,total:n})=>{o[e].v={loaded:t,total:n}};a=s,e.rf[_]=n,T||(l.v=!!c||!C);let{downloading:f,uploading:p}=e.ro.trackedKeys;return x=f?a.onDownload(d(`downloading`)):x,S=p?a.onUpload(d(`uploading`)):S,b=a.send(c),w=()=>a.fromCache||!1,b},D={method:a,cachedResponse:C,config:c,abort:()=>a.abort()},O=()=>s!==G.USE_WATCHER||!v||e.m===a,k=(e=!0)=>{e&&y&&(l.v=!1),T=e},A=h(p?{...D,args:r,fetch:(t,...n)=>(xe(i,t),je(e,t,n)),proxyStates:ie(o,`data`),controlLoading:k}:{...D,args:r,send:(...n)=>je(e,t,n),proxyStates:o,controlLoading:k},E),j,M=Y.spawn(a,r);try{let t=await A,n=t=>(p?e.c.updateState!==!1&&W(Oe(g,_),e=>{e.fs.data.v=t}):O()&&(d.v=t),O()&&(f.v=void 0,!T&&(l.v=!1),e.em.emit(K,P(Ce,M,t,w())),e.em.emit(J,P(Te,M,K,t,w(),void 0))),t);j=t===void 0?u?await le(b,n,()=>n(void 0)):void 0:n(t),!u&&!T&&(l.v=!1)}catch(t){throw O()&&(f.v=t,!T&&(l.v=!1),e.em.emit(q,P(we,M,t)),e.em.emit(J,P(Te,M,q,void 0,w(),t))),t}return x(),S(),j})()}var X=e=>e.current;function Me(e,i,a,o,c=!1,l,d=0){a={...a};let f=!!c,h;if(c)try{let r=E(i,be(e)),o=n(r),s=o.l1Cache.get(te(o.id,u(r)));if(s&&!m(s,t)){let[e,t]=s;(!t||t>T())&&(h=e)}f=!!ae(a.force??!1)||!h}catch{}let{create:g,effectRequest:_,ref:v,objectify:y,exposeProvider:x,transformState2Proxy:S,__referingObj:w}=ge(r(),a.__referingObj),D={total:0,loaded:0},{managedStates:O={}}=a,A=he(O,(e,t)=>S(e,t)),ee=g(h??(p(o)?o():o),`data`),N=g(f,`loading`),P=g(void 0,`error`),I=g({...D},`downloading`),L=g({...D},`uploading`),R=y([ee,N,P,I,L]),z=b(),B=X(v(Se(e,a,z,w)));B.fs=R,B.em=z,B.c=a,B.ms={...R,...A};let ne=l!==void 0,re=(e=i,t)=>je(B,e,t),V=v(void 0),ie=v(!1),oe=X(v(s())),se=(e=w,t)=>{oe(()=>{(!C.ssr||X(V))&&(w.initialRequest=ie.current=!0,le(re(t),()=>{var e;(e=X(V))==null||e.resolve()},t=>{var n;if(!e.bindError&&!e.trackedKeys.error&&!X(V))throw t;(n=X(V))==null||n.reject(t)}))})},ce=v(me((e,t,n)=>se(t,n),e=>k(e)?H(d)?d[e]:d:0));_({handler:ne?e=>ce.current(e,w,i):()=>se(w),removeStates:()=>{W(M(B.rf),e=>e())},frontStates:{...R,...A},watchingStates:l,immediate:c??!0});let U=x({...y([ee,N,P,I,L]),abort:()=>B.m&&B.m.abort(),send:(e,t)=>re(t,e),onSuccess(e){z.on(K,e)},onError(e){w.bindError=!0,z.on(q,e)},onComplete(e){z.on(J,e)},then(e,t){let{promise:n,resolve:r,reject:i}=j();V.current={resolve:r,reject:i},F(()=>{!ie.current&&r()},10),le(n,()=>{e(U)},t)}});return U}function Ne(e={}){let t=Me(G.USE_FETCHER,U,e),{send:n}=t;return f(t,`send`),oe(t,{fetch:(e,...t)=>(xe(ye,e),n(t,e))})}function Pe(e,t={}){let{immediate:n=!0,initialData:r}=t,i=Me(G.USE_REQUEST,e,t,r,!!n),{send:a}=i;return oe(i,{send:(...e)=>a(e)})}v(`usePagination`);var Fe=`valueOf`,Ie;b(),v(`useSQRequest`);var Le=Symbol(`vdid`),Re=e=>{let t=e?.[Le];t&&Ie&&(Ie[t]=void 0)},ze=(e,t=!0)=>{Re(e);let n=e?.[Le];return(n?`[vd:${n}]`:void 0)||(t?e:void 0)};function Be(){return ze(this)}var Ve=function(){};Ve.prototype=z.create(null,{[Fe]:ue(Be)});var He=function(){};He.prototype=z.create(null,{[Fe]:ue(Be)});var Z=class{constructor(e,t={}){this.cancelBubble=!1,this.currentTarget=null,this.defaultPrevented=!1,this.eventPhase=0,this.isTrusted=!1,this.returnValue=!0,this.srcElement=null,this.target=null,this.NONE=0,this.CAPTURING_PHASE=1,this.AT_TARGET=2,this.BUBBLING_PHASE=3,this.type=e,this.bubbles=t.bubbles??!1,this.cancelable=t.cancelable??!1,this.composed=t.composed??!1,this.timeStamp=Date.now()}preventDefault(){this.cancelable&&(this.defaultPrevented=!0)}stopImmediatePropagation(){}stopPropagation(){this.cancelBubble=!0}composedPath(){return[]}initEvent(e,t,n){}};Z.NONE=0,Z.CAPTURING_PHASE=1,Z.AT_TARGET=2,Z.BUBBLING_PHASE=3;var Ue=typeof Event<`u`?Event:Z,We=class extends Ue{constructor(e,t){super(e,{bubbles:!0,cancelable:!0,composed:!0}),this.data=t.data,this.lastEventId=t.lastEventId,this.origin=t.origin||``,this.error=t.error}},Ge=v(`EventSourceFetch`),Ke=class e{constructor(t,n,r={}){this.CONNECTING=0,this.OPEN=1,this.CLOSED=2,this.onopen=null,this.onmessage=null,this.onerror=null,this._listeners={},this._reconnectTime=null,this._controller=null,this._lastEventId=``,this._origin=``,this.url=t,this.readyState=e.CONNECTING,this._options={...r},this._reconnectTime=n,this._origin=P(URL,t,window.location.href).origin,t&&F(()=>this._connect())}addEventListener(e,t){this._listeners[e]=this._listeners[e]||[],this._listeners[e].find(e=>e===t||O(e)&&O(t)&&e?.handleEvent===t.handleEvent)||this._listeners[e].push(t)}removeEventListener(e,t){!t||!this._listeners[e]||(this._listeners[e]=S(this._listeners[e],e=>e!==t&&!(typeof e==`object`&&typeof t==`object`&&e?.handleEvent===t.handleEvent)))}dispatchEvent(e){if(!(e instanceof We))return!0;let t=this._listeners[e.type]||[];for(let n of t)p(n)?n(e):n&&p(n.handleEvent)&&n.handleEvent(e);let n=`on${e.type}`,r=this[n];return p(r)&&r(e),!e.defaultPrevented}close(){this.readyState!==e.CLOSED&&(this.readyState=e.CLOSED,this._dispatchEvent(`close`,``),this._controller&&=(this._controller.abort(),null))}_connect(){if(this.readyState===e.CLOSED)return;this._controller=P(AbortController);let t=this._options,n=t.headers||{},r=[`Accept`,`text/event-stream`],i=`Last-Event-ID`,a=this._lastEventId;if(H(n))N(n,r),a&&N(n,[i,a]);else if(m(n,Headers))n.append(r[0],r[1]),a&&n.append(i,a);else if(O(n)){let[e,t]=r;n[e]=t,a&&(n[i]=a)}let o={...t,headers:n,signal:this._controller.signal};fetch(this.url,o).then(t=>{Ge(t.ok,`HTTP error: ${t.status}`),Ge(t.body,`ReadableStream not supported`),this._origin=P(URL,t.url).origin,this.readyState=e.OPEN,this._dispatchEvent(`open`,``);let n=t.body.getReader(),r=new TextDecoder,i=``,a=({done:t,value:o})=>{if(t)return this.readyState!==e.CLOSED&&this._reconnect(),B();i+=r.decode(o,{stream:!0});let s=i.split(/\r\n|\r|\n/);return i=s.pop()||``,this._processEventStream(s),n.read().then(a).catch(t=>(t.name!==`AbortError`&&this.readyState!==e.CLOSED&&this._onError(t),B()))};return n.read().then(a).catch(t=>{t.name!==`AbortError`&&this.readyState!==e.CLOSED&&this._onError(t)})}).catch(t=>{t.name!==`AbortError`&&this.readyState!==e.CLOSED&&this._onError(t)})}_processEventStream(e){let t=`message`,n=``,r=null,i=null,o=()=>{if(n){if(n.endsWith(`
`)&&(n=n.substring(0,n.length-1)),r!==null&&(this._lastEventId=r),i!==null&&this._reconnectTime===null){let e=parseInt(i,10);Number.isNaN(e)||(this._reconnectTime=e)}this._dispatchEvent(t,n)}t=`message`,n=``,r=null,i=null};for(let s of e){if(s===``){o();continue}if(s.startsWith(`:`))continue;let e,c,l=s.indexOf(`:`);switch(l===-1?(e=s,c=``):(e=s.slice(0,l),c=s.slice(l+(s[l+1]===` `?2:1))),e){case`event`:t=c;break;case`data`:n=n?`${n}\n${c}`:c;break;case`id`:if(c.includes(`\0`))continue;r=c;break;case`retry`:i=c;break;default:throw P(a,`EventSource`,`EventSource: Unknown field "${e}", ignoring`)}}}_dispatchEvent(e,t){let n=P(We,e,{type:e,data:t,lastEventId:this._lastEventId,origin:this._origin});this.dispatchEvent(n)}_onError(t){let n=P(We,`error`,{type:`error`,data:``,lastEventId:this._lastEventId,origin:this._origin,error:t});this.dispatchEvent(n),this.readyState!==e.CLOSED&&this._reconnect()}_reconnect(){if(this._reconnectTime!==null&&this._reconnectTime<=0){this.close();return}this.readyState!==e.CLOSED&&(this.readyState=e.CONNECTING,F(()=>this._connect(),this._reconnectTime??1e3))}};Ke.CONNECTING=0,Ke.OPEN=1,Ke.CLOSED=2;var qe;(function(e){e[e.CONNECTING=0]=`CONNECTING`,e[e.OPEN=1]=`OPEN`,e[e.CLOSED=2]=`CLOSED`})(qe||={}),v(`useSSE`);var Je;(function(e){e.Open=`open`,e.Error=`error`,e.Message=`message`,e.Close=`close`})(Je||={});var Q=v(`useUploader`);function Ye(n,{limit:i=0,localLink:a,replaceSrc:o,mode:s}={}){let{create:c,computed:l,exposeProvider:u,ref:d}=ge(r()),f=b(),p=c([],`fileList`),m=l(()=>p.v[0],[p],`file`),h=c(!1,`uploading`),g=c(0,`successCount`),_=c(0,`failCount`),v=l(()=>({...p.v.reduce((e,{progress:t,status:n})=>(n!==0&&(e.total+=t.total,e.uploaded+=t.uploaded),e),{uploaded:0,total:0})}),[p],`progress`),y=l(()=>p.v.find(e=>e.error)?.error,[p],`error`),C=async(n={},r={})=>{let o=n,s=r;!n.file&&!H(n)&&(s=n,o=[]);let c=H(o)?o:[o];x(c)<=0&&(c=await Ye.selectFile(s)),Q(i<=0||x(p.v)+x(c)<=i,`The number of files exceeds the limit of ${i}`);let{converters:l}=Ye,u=await t.all(e(c,async t=>{let n=l.find(({is:e})=>e(t));Q(n,`Invalid file type, only ${e(l,({name:e})=>e).join(`, `)} are supported, if other file needs, customize convert function with \`useUploader.convertFile.push({ is: ..., convert: ... })\``);let r=await n.convert(t);return Q(r,`Failed to convert file`),{src:t.src||(a?URL.createObjectURL(r):void 0),file:r,status:0,progress:{uploaded:0,total:r.size}}})),d=s.start??x(p.v),f=S(u,Boolean),m=[...p.v];return ne(m,d,0,...f),p.v=m,x(u)},w=(t,n=[1,2],r=`upload`)=>{let i={upload:`uploaded`,abort:`aborted`}[r],a=p.v;return x(t)>0?e(t,(e,t)=>{let r=k(e),o=r?a[e]:e,s=r?`index ${e}`:`position ${t}`;return Q(o,`The file of ${s} does not exist`),x(n)>0&&Q(!D(n,o.status)&&O(o.file),`The file of ${s} cannot be ${i}, which status is ${o.status}`),o}):S(a,e=>!D(n,e.status))},T=(e,t)=>S(e,e=>x(t)>0?D(t,e.status):!0),E=d([]),A=(e,t)=>{p.v.findIndex(t=>t.file===e)>-1&&N(E.current,{f:e,m:t})},j=e=>{E.current=S(E.current,({m:t})=>t!==e)},M=(...t)=>{let n=w(t,[0,2,3],`abort`),r=[];x(n)>0?W(n,({file:e})=>{let t=E.current.find(({f:t})=>t===e);t&&N(r,t.m)}):N(r,...e(E.current,({m:e})=>e));let i=[];return W(r,e=>{i.includes(e)||N(i,e)}),se(e(i,e=>e.abort()))},F=(...e)=>{let t=w(e,[]);x(t)>0?(M(...T(t,[1])),p.v=S(p.v,e=>!D(t,e)),g.v=x(T(p.v,[2])),_.v=x(T(p.v,[3]))):(M(...T(p.v,[1])),p.v=[])},I=(e,t,n)=>{let r=Y.spawn(e,[]);return{successEvent:P(Ce,r,t,!1),errorEvent:P(we,r,n),completeEvent:P(Te,r,n?q:K,t,!1,n)}},L=(e,t,n,r,i=0)=>{if(e.status=t,t===2){if(e.progress.uploaded=e.progress.total,o){let t=o(n,i);t&&(e.src=t)}}else t===3&&(e.error=r);p.v=[...p.v]},R=(e,t)=>{let r=n(t);return r.onUpload(t=>{W(e,e=>{e.progress.uploaded=t.loaded*(e.progress.total/t.total)})}),W(e,({file:e})=>A(e,r)),r.then(t=>{W(e,(e,n)=>L(e,2,t,void 0,n)),g.v=x(T(p.v,[2]));let{successEvent:n,completeEvent:i}=I(r,t);return f.emit(K,n),f.emit(J,i),t},t=>{W(e,e=>L(e,3,void 0,t)),_.v=x(T(p.v,[3]));let{errorEvent:n,completeEvent:i}=I(r,void 0,t);return f.emit(q,n),f.emit(J,i),t}).finally(()=>{h.v=!1,j(r)})},te=r=>{let i=e(r,(e,t)=>{let i=n({file:e.file,name:e.file.name});return i.onUpload(({loaded:e,total:t})=>{W(r,n=>{n.progress.uploaded=e,n.progress.total=t})}),A(e.file,i),i.then(n=>{L(e,2,n,void 0,t),g.v+=1;let{successEvent:r,completeEvent:a}=I(i,n);return f.emit(K,r),f.emit(J,a),n},t=>{L(e,3,void 0,t),_.v+=1;let{errorEvent:n,completeEvent:r}=I(i,void 0,t);return f.emit(q,n),f.emit(J,r),t}).finally(()=>{j(i)})});return ee(t.all(i),()=>{h.v=!1})};return u({fileList:p,uploading:h,file:m,progress:v,successCount:g,failCount:_,error:y,appendFiles:C,removeFiles:F,upload:async(...t)=>{let n=w(t);W(n,e=>{e.status=1});let r=e(n,({file:e})=>({file:e,name:e.name}));return h.v=!0,s===`batch`?R(n,r):te(n)},abort:M,onSuccess:e=>{f.on(K,e)},onError:e=>{f.on(q,e)},onComplete:e=>{f.on(J,e)}})}Ye.selectFile=({multiple:t,accept:n}={})=>{let r=document.createElement(`input`);return r.type=`file`,r.multiple=!!t,n&&(r.accept=n),r.click(),P(Promise,t=>{r.addEventListener(`change`,()=>{t(e(Array.from(r.files||[]),e=>({file:e,name:e.name,mimeType:e.type})))})})};var Xe=`text/plain`;Ye.converters=[{name:`HTMLCanvasElement`,is:({file:e})=>m(e,HTMLCanvasElement),async convert({file:e,mimeType:n,name:r}){let i=await P(t,t=>e?.toBlob(t));if(i)return P(File,[i],r||`image.png`,{type:n||i.type})}},{name:`base64`,is:({file:e})=>A(e),convert({file:e=``,mimeType:t,name:n}){Q(/data:.+;base64,/.test(e),`Invalid base64 string`);let r=e.split(`,`),i=r[0].match(/:(.*?);/)?.[1],a=atob(r[1]),o=new Uint8Array(x(a));return W(Array.from(a),(e,t)=>{o[t]=e.charCodeAt(0)}),P(File,[o],n||`file`,{type:t||i||Xe})}},{name:`File`,is:({file:e})=>m(e,File),convert({file:e}){return e}},{name:`Blob`,is:({file:e})=>m(e,Blob),convert({file:e,name:t,mimeType:n}){return P(File,[e],t||`file`,{type:n||e.type||Xe})}},{name:`ArrayBuffer`,is:({file:e})=>m(e,ArrayBuffer),convert({file:e,name:t,mimeType:n}){return P(File,[P(Blob,[e])],t||`file`,{type:n||Xe})}}];var $=(e,t={})=>{let n=!0,{enableFocus:i=!0,enableVisibility:a=!0,enableNetwork:o=!0,pollingTime:s=0,throttle:c=1e3}=t,{onMounted:l,onUnmounted:u,__referingObj:d}=ge(r()),f=Pe(e,{...t,__referingObj:d}),p=()=>{n&&(f.send(),c>0&&(n=!1,setTimeout(()=>{n=!0},c)))},m=U,h=U,g=U,_=U;return l(()=>{C.ssr||(m=o?$.onNetwork(p,t):m,h=i?$.onFocus(p,t):h,g=a?$.onVisibility(p,t):g,_=s>0?$.onPolling(p,t):_)}),u(()=>{m(),h(),g(),_()}),f},Ze=(e,t)=>(window.addEventListener(e,t),()=>window.removeEventListener(e,t));$.onNetwork=e=>Ze(`online`,e),$.onFocus=e=>Ze(`focus`,e),$.onVisibility=e=>Ze(`visibilitychange`,()=>document.visibilityState===`visible`&&e()),$.onPolling=(e,t)=>{let n=setInterval(e,t.pollingTime);return()=>clearInterval(n)},v(`useCaptcha`),b(),v(`useRetriableRequest`),v(`subscriber`);function Qe(e){let{mutationFn:t,onSuccess:n,onError:r,onComplete:i,successMessage:a=`操作成功`}=e,{loading:o,send:s,abort:c}=Ne();return{mutate:async e=>{try{let i=await s(t(e));if(i===null){let t=V(Error(`操作失败`));return r?.(t,e),null}return a!==!1&&ce.success(a),n?.(i,e),i}catch(t){let n=V(t);return r?.(n,e),null}finally{i?.()}},loading:o,abort:c}}function $e(e){let{apiCall:t,apiCallParams:n,immediate:r=!0,defaultPage:i=1,defaultPageSize:a=10,statisticsFn:s,onSuccess:c,onError:l}=e,u=_([]),f=_(!1),p=_(null),m=_(``),h=_({}),g=_(i),v=_(a),y=_(0),b=async()=>{f.value=!0,p.value=null;let e=n?n({page:g.value,pageSize:v.value,searchQuery:m.value,filters:h.value}):{page:g.value,pageSize:v.value};try{let n=await t(e);if(n===null){p.value=V(Error(`获取数据失败`)),u.value=[],y.value=0;return}u.value=n.list||[],y.value=n.total||0,c?.(n)}catch(e){p.value=V(e),u.value=[],y.value=0,l?.(p.value)}finally{f.value=!1}},x=d(b,300);pe([g,v],()=>{b()},{immediate:r}),pe([m,h],()=>{x()},{deep:!0});let S=o(()=>Math.ceil(y.value/v.value)),C=o(()=>{let e=u.value;return s?s(e)||{}:{total:y.value}});return{data:u,loading:f,error:p,searchQuery:m,filters:h,filteredData:o(()=>u.value),paginatedData:o(()=>u.value),currentPage:g,pageSize:v,totalPages:S,total:y,statistics:C,fetchData:b,resetFilters:()=>{m.value=``,h.value={},g.value=i},goToPage:e=>{e>=1&&e<=S.value&&(g.value=e)},nextPage:()=>{g.value<S.value&&g.value++},prevPage:()=>{g.value>1&&g.value--},setPageSize:e=>{v.value=e,g.value=1},addData:e=>{u.value=[e,...u.value],y.value+=1},updateData:(e,t)=>{let n=u.value.findIndex(t=>t.id===e);n!==-1&&(u.value[n]={...u.value[n],...t})},removeData:e=>{u.value=u.value.filter(t=>t.id!==e),y.value=Math.max(y.value-1,0)},batchRemoveData:e=>{let t=u.value.filter(t=>e.includes(t.id)).length;u.value=u.value.filter(t=>!e.includes(t.id)),y.value=Math.max(y.value-t,0)}}}var et=_(new Map);o(()=>et.value.size>0),o(()=>et.value.values().next().value?.text||`加载中...`),o(()=>et.value.values().next().value?.type||`default`);function tt(){let e=c(),t=t=>e.hasPermission(t),n=t=>t.length?t.some(t=>e.hasPermission(t)):!0,r=t=>t.length?t.every(t=>e.hasPermission(t)):!0;return{hasPermission:t,hasAnyPermission:n,hasAllPermissions:r,hasRole:t=>e.user?.role===t,hasAnyRole:t=>t.length?t.some(t=>e.user?.role===t):!0,checkPermission:(e,i=`all`)=>Array.isArray(e)?i===`any`?n(e):r(e):t(e),usePermissionRef:e=>o(()=>t(e)),isAdmin:o(()=>e.isAdmin),isAuthenticated:o(()=>e.isAuthenticated)}}export{$e as n,Qe as r,tt as t};