import"./ScrollArea-u7vgQcwr.js";import"./RovingFocusItem-tfPyown7.js";import"./Presence-CTcpkTiJ.js";import"./TabsTrigger-BVA-KY5p.js";import{Bi as e,Ct as t,Ha as n,Ii as r,Ki as i,Li as a,Pa as o,Ri as s,St as c,Ui as ee,Wi as l,ba as te,er as u,ji as d,ka as f,la as p,lt as m,pa as h,qa as ne,sa as g,tt as _,wa as v,xt as y,yt as b,zi as x}from"./index-Bdnse1ke.js";import"./en_US-B-0xvqcl.js";import"./common-B6eu2cAW.js";import"./zh_CN-o6dt8jMH.js";import{i as re}from"./useFullscreen-Cz-fRWjR.js";import"./_plugin-vue_export-helper-CuErARa7.js";import{u as ie}from"./dist-CIVP1JAM.js";import"./theme-shared-CKGE9ZaP.js";import{t as ae}from"./TTable-BqF1vWP0.js";import"./useTableColumns-ClPoF4Nv.js";import"./useResponsive-Drj8-vqi.js";import{t as S}from"./TForm-D3MGp7pF.js";import"./TIcon-BqmThimp.js";import{t as C}from"./TModal-C-7FBAha.js";import{n as oe,t as se}from"./CardContent-CE0o8nDP.js";import{n as ce,t as le}from"./CardTitle-BRqhnrl0.js";import{n as ue,r as w}from"./composables-cmucIgPx.js";import"./business-Ca3ePTT7.js";import{t as T}from"./TDataCard-CaW7oY6O.js";import{t as E}from"./TStatusBadge-ByNmjsZv.js";import{t as D}from"./TPageHeader-B7msJezu.js";import{t as O}from"./TEmptyState-CimpC4Hh.js";import"./TBatchActions-CBzH8d8g.js";var k={class:`space-y-6`},A={class:`flex flex-wrap gap-3`},j={class:`bg-muted/40 border border-border/50 rounded-xl px-3 py-3`},M={class:`flex items-center gap-2`},N={class:`font-medium`},P={key:1,class:`text-muted-foreground`},F={key:1,class:`text-muted-foreground block text-center`},I=i({__name:`index`,setup(i){let{data:I,loading:L,searchQuery:R,fetchData:z}=ue({apiCall:async e=>await u.getMenus(e)||{list:[],total:0,page:1,pageSize:10},apiCallParams:e=>({search:e.searchQuery})});function B(e){let t=new Map,n=[];return e.forEach(e=>{t.set(e.id,{...e})}),e.forEach(e=>{let r=t.get(e.id);if(e.parentId&&t.has(e.parentId)){let n=t.get(e.parentId);n.children||=[],n.children.push(r),n.children.sort((e,t)=>e.sort-t.sort)}else n.push(r)}),n.sort((e,t)=>e.sort-t.sort)}let V=r(()=>B(I.value)),{mutate:H}=w({mutationFn:e=>u.createMenu({name:e.name,title:e.title,path:e.path,component:e.component,icon:e.icon,parentId:e.parentId||null,sort:e.sort||0,status:e.status,hidden:e.hidden||!1,keepAlive:e.keepAlive||!1,external:e.external||!1,permission:e.permission,type:e.type||`menu`}),successMessage:`菜单创建成功`,onSuccess:()=>{K.value=!1,we(),z()}}),{mutate:U}=w({mutationFn:({id:e,values:t})=>u.updateMenu(e,{name:t.name,title:t.title,path:t.path,component:t.component,icon:t.icon,parentId:t.parentId||null,sort:t.sort,status:t.status,hidden:t.hidden,keepAlive:t.keepAlive,external:t.external,permission:t.permission,type:t.type}),successMessage:`菜单更新成功`,onSuccess:()=>{q.value=!1,J.value=null,z()}}),{mutate:de}=w({mutationFn:e=>u.deleteMenu(e),successMessage:`菜单删除成功`,onSuccess:()=>z()}),{mutate:fe}=w({mutationFn:({id:e,status:t})=>u.updateMenuStatus(e,t),successMessage:`状态更新成功`,onSuccess:()=>z()}),W=o({keyword:``}),pe={layout:`inline`,fields:[{name:`keyword`,type:`input`,label:``,placeholder:`搜索菜单名称或路径...`,className:`w-[280px]`}],searchConfig:{enabled:!0,collapsed:!1,showCollapseButton:!1,searchText:`搜索`,resetText:`重置`,showReset:!0,onSearch:e=>{R.value=e.keyword||``},onReset:()=>{R.value=``}}},me=o();function G(e){return re(e)||_}let he=r(()=>({columns:[{title:`菜单名称`,dataIndex:`title`,width:200,slot:`title`},{title:`类型`,dataIndex:`type`,width:80,align:`center`,slot:`type`},{title:`路由路径`,dataIndex:`path`,width:160,ellipsis:!0},{title:`组件`,dataIndex:`component`,width:140,ellipsis:!0},{title:`图标`,dataIndex:`icon`,width:70,align:`center`,slot:`icon`},{title:`排序`,dataIndex:`sort`,width:60,align:`center`},{title:`状态`,dataIndex:`status`,width:80,slot:`status`},{title:`可见`,dataIndex:`hidden`,width:60,align:`center`,slot:`hidden`},{title:`缓存`,dataIndex:`keepAlive`,width:60,align:`center`,slot:`keepAlive`},{title:`外链`,dataIndex:`external`,width:60,align:`center`,slot:`external`}],childrenColumnName:`children`,indentSize:20,expandable:{defaultExpandAllRows:!0},pagination:!1,actions:[{text:`编辑`,type:`primary`,onClick:e=>be(e)},{text:`删除`,type:`danger`,confirm:!0,confirmText:`确定要删除该菜单吗？子菜单也会被删除，此操作不可恢复。`,onClick:e=>Ce(e.id)}],actionWidth:150,actionFixed:`right`})),K=o(!1),q=o(!1),J=o(null);function Y(){return{name:``,title:``,path:``,component:``,icon:``,parentId:null,sort:0,status:`active`,hidden:!1,keepAlive:!1,external:!1,permission:``,type:`menu`}}let X=o(Y()),Z=o({id:``,...Y()});te(()=>X.value.path,e=>{if(e&&!X.value.component){let t=e.startsWith(`/`)?e.slice(1):e;X.value.component=t?`${t}/index`:``}}),r(()=>[{label:`顶级菜单`,value:null},...(I.value||[]).map(e=>({label:e.title,value:e.id}))]);let ge=r(()=>{let e=t=>t.map(t=>({title:t.title,value:t.id,key:t.id,children:t.children?e(t.children):void 0}));return[{title:`顶级菜单`,value:``,key:`root`,children:e(V.value)}]}),_e=[{label:`目录`,value:`directory`,color:`blue`},{label:`菜单`,value:`menu`,color:`green`},{label:`按钮`,value:`button`,color:`orange`}];function Q(e){return[{name:`type`,type:`select`,label:`菜单类型`,placeholder:`请选择菜单类型`,options:_e,disabled:e,rules:[{required:!0,message:`请选择菜单类型`}]},{name:`title`,type:`input`,label:`菜单标题`,placeholder:`请输入菜单标题`,rules:[{required:!0,message:`菜单标题不能为空`},{min:2,message:`菜单标题至少2个字符`}]},{name:`name`,type:`input`,label:`路由名称`,placeholder:`请输入路由名称`,disabled:e,dependencies:{field:`type`,condition:e=>e!==`button`},rules:[{required:!0,message:`路由名称不能为空`},{pattern:/^[A-Za-z0-9_-]+$/,message:`名称只能包含字母、数字、下划线和横线`}]},{name:`path`,type:`input`,label:`路由路径`,placeholder:`请输入路由路径，如 /system/user`,dependencies:{field:`type`,condition:e=>e!==`button`},rules:[{required:!0,message:`路由路径不能为空`},{pattern:/^\/[A-Za-z0-9/_-]*$/,message:`路径格式不正确`}]},{name:`component`,type:`input`,label:`组件路径`,placeholder:`请输入组件路径，如 system/user/index`,dependencies:{field:`type`,condition:e=>e===`menu`},rules:[{required:!0,message:`组件路径不能为空`}]},{name:`parentId`,type:`tree-select`,label:`上级菜单`,placeholder:`请选择上级菜单`,options:ge.value,disabled:e,props:{treeDefaultExpandAll:!0,allowClear:!0,showSearch:!0,treeNodeFilterProp:`title`}},{name:`icon`,type:`icon`,label:`图标`,placeholder:`请选择图标`,dependencies:{field:`type`,condition:e=>e!==`button`},props:{showClear:!0,showCategoryTabs:!0,popupWidth:840,columns:10}},{name:`sort`,type:`number`,label:`排序`,placeholder:`请输入排序号`,min:0},{name:`permission`,type:`input`,label:`权限标识`,placeholder:`请输入权限标识，如 system:user:view`,dependencies:{field:`type`,condition:e=>e===`button`}},{name:`status`,type:`select`,label:`状态`,placeholder:`请选择状态`,options:[{label:`启用`,value:`active`},{label:`禁用`,value:`inactive`}],rules:[{required:!0,message:`请选择状态`}]},{name:`hidden`,type:`switch`,label:`隐藏菜单`,checkedChildren:`是`,unCheckedChildren:`否`,dependencies:{field:`type`,condition:e=>e!==`button`}},{name:`keepAlive`,type:`switch`,label:`缓存页面`,checkedChildren:`是`,unCheckedChildren:`否`,dependencies:{field:`type`,condition:e=>e===`menu`}},{name:`external`,type:`switch`,label:`外部链接`,checkedChildren:`是`,unCheckedChildren:`否`,dependencies:{field:`type`,condition:e=>e===`menu`}}]}let ve=r(()=>({layout:`horizontal`,columns:2,labelCol:{span:8},wrapperCol:{span:16},fields:Q(!1),actions:{showSubmit:!0,showReset:!0,submitText:`添加菜单`,resetText:`取消`,align:`right`,onReset:()=>{K.value=!1}}})),ye=r(()=>({layout:`horizontal`,columns:2,labelCol:{span:8},wrapperCol:{span:16},fields:Q(!0),actions:{showSubmit:!0,showReset:!0,submitText:`保存修改`,resetText:`取消`,align:`right`,onReset:()=>{q.value=!1}}}));function be(e){J.value=e,Z.value={id:e.id,name:e.name,title:e.title,path:e.path,component:e.component,icon:e.icon,parentId:e.parentId,sort:e.sort,status:e.status,hidden:e.hidden,keepAlive:e.keepAlive,external:e.external,permission:e.permission,type:e.type},q.value=!0}function xe(e){H(e)}function Se(e){J.value&&U({id:J.value.id,values:e})}function Ce(e){de(e)}function $(e){let t=e.status===`active`?`inactive`:`active`;fe({id:e.id,status:t})}function we(){X.value=Y()}let Te=r(()=>{let e=I.value||[],t=e.length;e.filter(e=>e.status===`active`).length,e.filter(e=>!e.hidden).length;let n=e.filter(e=>e.type===`directory`).length,r=e.filter(e=>e.type===`menu`).length,i=e.filter(e=>e.type===`button`).length;return[{title:`菜单总数`,value:t,icon:_,color:`text-blue-500`},{title:`目录`,value:n,icon:b,color:`text-cyan-500`},{title:`菜单`,value:r,icon:m,color:`text-green-500`},{title:`按钮`,value:i,icon:y,color:`text-orange-500`}]});return(r,i)=>(g(),e(`div`,k,[l(n(D),{title:`菜单管理`,subtitle:`管理系统导航菜单和路由配置`,actions:[{text:`添加菜单`,type:`primary`,iconName:`Plus`,onClick:()=>K.value=!0}]},null,8,[`actions`]),a(`div`,A,[(g(!0),e(d,null,p(n(Te),e=>(g(),s(n(T),{key:e.title,title:e.title,value:e.value,icon:e.icon,color:e.color,size:`sm`},null,8,[`title`,`value`,`icon`,`color`]))),128))]),a(`div`,j,[l(n(S),{modelValue:n(W),"onUpdate:modelValue":i[0]||=e=>f(W)?W.value=e:null,schema:pe},null,8,[`modelValue`])]),l(n(oe),{class:`bg-muted/40 border border-border/50 rounded-xl`},{default:v(()=>[l(n(ce),{class:`pb-4`},{default:v(()=>[l(n(le),{class:`text-base font-semibold`},{default:v(()=>[...i[6]||=[ee(`菜单结构`,-1)]]),_:1})]),_:1}),l(n(se),{class:`pt-0`},{default:v(()=>[l(n(ae),{ref_key:`tableRef`,ref:me,data:n(V),"onUpdate:data":i[1]||=e=>f(V)?V.value=e:null,schema:n(he),loading:n(L)},{title:v(({text:e,record:t})=>[a(`div`,M,[t?(g(),s(h(G(t.icon)),{key:0,class:`h-4 w-4 text-muted-foreground`})):x(``,!0),a(`span`,N,ne(e),1)])]),icon:v(({text:t})=>[t?(g(),s(h(G(t)),{key:0,class:`h-4 w-4 text-muted-foreground mx-auto`})):(g(),e(`span`,P,`-`))]),type:v(({text:e})=>[e?(g(),s(n(E),{key:0,status:e,"status-map":{directory:{text:`目录`,color:`info`},menu:{text:`菜单`,color:`success`},button:{text:`按钮`,color:`warning`}}},null,8,[`status`])):x(``,!0)]),status:v(({text:e,record:t})=>[t?(g(),s(n(E),{key:0,status:e,"status-map":{active:{text:`启用`,color:`success`},inactive:{text:`禁用`,color:`default`}},clickable:``,onClick:e=>$(t)},null,8,[`status`,`onClick`])):x(``,!0)]),hidden:v(({text:e})=>[e?(g(),s(n(c),{key:1,class:`h-4 w-4 text-gray-400 mx-auto`})):(g(),s(n(y),{key:0,class:`h-4 w-4 text-green-500 mx-auto`}))]),keepAlive:v(({text:e})=>[l(n(ie),{checked:e,size:`small`,disabled:``,class:`mx-auto`},null,8,[`checked`])]),external:v(({text:r})=>[r?(g(),s(n(t),{key:0,class:`h-4 w-4 text-blue-500 mx-auto`})):(g(),e(`span`,F,`-`))]),emptyText:v(()=>[l(n(O),{type:`data`,title:`暂无菜单数据`,description:`开始添加您的第一个菜单吧`,action:{text:`添加菜单`,type:`primary`,iconName:`Plus`,onClick:()=>K.value=!0}},null,8,[`action`])]),_:1},8,[`data`,`schema`,`loading`])]),_:1})]),_:1}),l(n(C),{open:n(K),"onUpdate:open":i[3]||=e=>f(K)?K.value=e:null,title:`添加菜单`,width:`800`,footer:null},{default:v(()=>[l(n(S),{modelValue:n(X),"onUpdate:modelValue":i[2]||=e=>f(X)?X.value=e:null,schema:n(ve),onSubmit:xe},null,8,[`modelValue`,`schema`])]),_:1},8,[`open`]),l(n(C),{open:n(q),"onUpdate:open":i[5]||=e=>f(q)?q.value=e:null,title:`编辑菜单`,width:`800`,footer:null},{default:v(()=>[n(J)?(g(),s(n(S),{key:0,modelValue:n(Z),"onUpdate:modelValue":i[4]||=e=>f(Z)?Z.value=e:null,schema:n(ye),onSubmit:Se},null,8,[`modelValue`,`schema`])):x(``,!0)]),_:1},8,[`open`])]))}});export{I as default};