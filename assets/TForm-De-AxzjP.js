import{t as e}from"./button-Bo4o88Eb.js";import{At as t,Bi as n,Bn as r,Di as i,Dn as a,E as o,Ea as s,Fi as c,Gi as l,Ii as u,Ki as d,Kt as f,M as p,Ma as m,Oa as h,Ot as g,Si as _,Ti as v,Ui as y,Vi as b,_i as x,bi as S,ci as C,ea as ee,fi as w,ga as T,h as E,ha as D,ja as O,k,ka as A,na as j,oa as M,sa as N,si as P,vi as F,wa as I,wi as L,xi as R,ya as z,yi as B,zn as te}from"./index-D9LA8apy.js";import{A as ne,C as re,D as ie,E as V,F as H,L as U,M as ae,O as W,P as G,R as oe,S as se,T as K,_ as ce,a as q,b as le,d as ue,g as de,h as fe,i as pe,j as me,k as J,m as Y,n as he,o as ge,p as _e,r as ve,t as X,u as ye,v as be,x as xe}from"./dist-guKItzxh.js";import{t as Se}from"./TIcon-DpsAxes7.js";var Ce=O(((e,t)=>{(function(n,r){typeof e==`object`&&t!==void 0?t.exports=r(J()):typeof define==`function`&&define.amd?define([`dayjs`],r):(n=typeof globalThis<`u`?globalThis:n||self).dayjs_locale_zh_cn=r(n.dayjs)})(e,(function(e){function t(e){return e&&typeof e==`object`&&`default`in e?e:{default:e}}var n=t(e),r={name:`zh-cn`,weekdays:`星期日_星期一_星期二_星期三_星期四_星期五_星期六`.split(`_`),weekdaysShort:`周日_周一_周二_周三_周四_周五_周六`.split(`_`),weekdaysMin:`日_一_二_三_四_五_六`.split(`_`),months:`一月_二月_三月_四月_五月_六月_七月_八月_九月_十月_十一月_十二月`.split(`_`),monthsShort:`1月_2月_3月_4月_5月_6月_7月_8月_9月_10月_11月_12月`.split(`_`),ordinal:function(e,t){return t===`W`?e+`周`:e+`日`},weekStart:1,yearStart:4,formats:{LT:`HH:mm`,LTS:`HH:mm:ss`,L:`YYYY/MM/DD`,LL:`YYYY年M月D日`,LLL:`YYYY年M月D日Ah点mm分`,LLLL:`YYYY年M月D日ddddAh点mm分`,l:`YYYY/M/D`,ll:`YYYY年M月D日`,lll:`YYYY年M月D日 HH:mm`,llll:`YYYY年M月D日dddd HH:mm`},relativeTime:{future:`%s内`,past:`%s前`,s:`几秒`,m:`1 分钟`,mm:`%d 分钟`,h:`1 小时`,hh:`%d 小时`,d:`1 天`,dd:`%d 天`,M:`1 个月`,MM:`%d 个月`,y:`1 年`,yy:`%d 年`},meridiem:function(e,t){var n=100*e+t;return n<600?`凌晨`:n<900?`早上`:n<1100?`上午`:n<1300?`中午`:n<1800?`下午`:`晚上`}};return n.default.locale(r,null,!0),r}))})),we=O(((e,t)=>{(function(n,r){typeof e==`object`&&t!==void 0?t.exports=r():typeof define==`function`&&define.amd?define(r):(n=typeof globalThis<`u`?globalThis:n||self).dayjs_locale_en=r()})(e,(function(){return{name:`en`,weekdays:`Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday`.split(`_`),months:`January_February_March_April_May_June_July_August_September_October_November_December`.split(`_`),ordinal:function(e){var t=[`th`,`st`,`nd`,`rd`],n=e%100;return`[`+e+(t[(n-20)%10]||t[n]||t[0])+`]`}}}))})),Te={class:`t-form-list space-y-4`},Ee={class:`flex items-start gap-4`},De={class:`flex-1 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4`},Oe=i({__name:`TFormList`,props:{field:{},formData:{},listConfig:{}},setup(t){let{t:n}=r(),i=t,a=0;function o(){return`list-item-${Date.now()}-${++a}`}let s=T([]),c=x({get:()=>i.formData[i.field.name]||[],set:e=>{i.formData[i.field.name]=e}});function u(e){return s.value[e]||(s.value[e]=o()),s.value[e]}function d(){let e={__id:o()};i.listConfig.fields.forEach(t=>{t.defaultValue!==void 0&&(e[t.name]=t.defaultValue)}),s.value.push(e.__id),c.value=[...c.value,e]}function f(e){let t=[...c.value];t.splice(e,1),s.value.splice(e,1),c.value=t}let m=x(()=>!(!i.listConfig.showAdd&&i.listConfig.showAdd!==void 0||i.listConfig.max&&c.value.length>=i.listConfig.max)),h=x(()=>!(!i.listConfig.showRemove&&i.listConfig.showRemove!==void 0||i.listConfig.min&&c.value.length<=i.listConfig.min));function g(){if(!c.value||c.value.length===0){let e=i.listConfig.min||1,t=[],n=[];for(let r=0;r<e;r++){let e=o(),r={__id:e};i.listConfig.fields.forEach(e=>{e.defaultValue!==void 0&&(r[e.name]=e.defaultValue)}),t.push(r),n.push(e)}s.value=n,c.value=t}}return g(),(r,i)=>(y(),R(`div`,Te,[(y(!0),R(w,null,l(c.value,(n,r)=>(y(),R(`div`,{key:u(r),class:`t-form-list-item p-4 border border-border rounded-lg bg-muted/50`},[F(`div`,Ee,[F(`div`,De,[(y(!0),R(w,null,l(t.listConfig.fields,e=>(y(),B(Z,{key:String(e.name),field:{...e,name:[t.field.name,r,e.name]},"form-data":t.formData},null,8,[`field`,`form-data`]))),128))]),h.value?(y(),B(I(e),{key:0,type:`button`,variant:`ghost`,size:`icon`,class:`shrink-0 text-destructive hover:text-destructive`,onClick:e=>f(r)},{default:M(()=>[v(I(E),{class:`h-4 w-4`})]),_:1},8,[`onClick`])):S(``,!0)])]))),128)),m.value?(y(),B(I(e),{key:0,type:`button`,variant:`outline`,class:`w-full`,onClick:d},{default:M(()=>[v(I(p),{class:`h-4 w-4 mr-2`}),L(` `+A(t.listConfig.addText||I(n)(`common.add`)),1)]),_:1})):S(``,!0)]))}}),ke={class:`t-form-group border border-border rounded-lg overflow-hidden bg-card`},Ae={class:`font-medium text-sm text-foreground`},je={class:`t-form-group-content p-4 space-y-4 bg-background`},Me=i({__name:`TFormGroup`,props:{field:{},formData:{},groupConfig:{}},setup(e){let n=e,r=T(n.groupConfig.defaultExpanded!==!1);function i(){n.groupConfig.collapsible!==!1&&(r.value=!r.value)}return(n,a)=>(y(),R(`div`,ke,[F(`div`,{class:s([`t-form-group-header flex items-center justify-between px-4 py-3 bg-muted cursor-pointer border-b border-border`,{"cursor-default":e.groupConfig.collapsible===!1}]),onClick:i},[F(`h4`,Ae,A(e.groupConfig.title||e.field.label),1),e.groupConfig.collapsible!==!1&&r.value?(y(),B(I(t),{key:0,class:`h-4 w-4 text-muted-foreground`})):e.groupConfig.collapsible!==!1&&!r.value?(y(),B(I(g),{key:1,class:`h-4 w-4 text-muted-foreground`})):S(``,!0)],2),N(F(`div`,je,[(y(!0),R(w,null,l(e.groupConfig.children,t=>(y(),B(Z,{key:String(t.name),field:t,"form-data":e.formData},null,8,[`field`,`form-data`]))),128))],512),[[C,r.value]])]))}}),Ne={key:27,class:`flex items-center gap-2`},Pe=[`disabled`],Z=i({__name:`TFormItem`,props:{field:{},formData:{}},setup(e,{expose:t}){let{t:i}=r(),a=e,o=T(!1),s=z([]),u=new Map,f=T(null),p=x(()=>a.field.virtualScroll?a.field.virtualScroll===!0?{enabled:!0,itemHeight:32,overscan:5}:{enabled:a.field.virtualScroll.enabled??!0,itemHeight:a.field.virtualScroll.itemHeight??32,overscan:a.field.virtualScroll.overscan??5}:null),m=x(()=>a.field.optionsDebounce??300),h=x(()=>typeof a.field.disabled==`function`?a.field.disabled(a.formData):a.field.disabled??!1),g=x({get:()=>a.formData[a.field.name],set:e=>{a.formData[a.field.name]=e}}),_=x(()=>typeof a.field.options==`function`),C=x(()=>_.value?s.value:a.field.options||[]);function ee(e){let t=a.field.props?.cacheFields;if(t&&t.length>0){let n={};return t.forEach(t=>{n[t]=e[t]}),JSON.stringify(n)}return JSON.stringify(e)}async function E(){_.value&&(f.value&&clearTimeout(f.value),f.value=setTimeout(async()=>{let e=ee(a.formData);if(u.has(e)){s.value=u.get(e);return}o.value=!0;try{let t=a.field.options,n=await t(a.formData);if(s.value=n,u.set(e,n),u.size>50){let e=u.keys().next().value;u.delete(e)}}catch(e){console.error(`[TForm] 加载字段 "${a.field.name}" 的选项失败:`,e),s.value=[]}finally{o.value=!1}},m.value))}function D(){u.clear()}j(()=>a.formData,()=>{_.value&&E()},{deep:!0,flush:`post`}),n(()=>{_.value&&E()}),b(()=>{f.value&&clearTimeout(f.value),u.clear()});let O=x(()=>{if(a.field.rules)return a.field.rules.map(e=>(a.field.type===`checkbox-single`||a.field.type===`switch`)&&e.required===!0&&!e.validator?{...e,validator:(t,n)=>n===!0?Promise.resolve():Promise.reject(Error(e.message||i(`common.pleaseCheckThis`)))}:e)});return x(()=>[`list`,`group`,`custom`,`color-picker`].includes(a.field.type)),t({clearOptionsCache:D}),(t,n)=>{let r=fe,a=Y,s=de,u=re,f=H,m=ae,_=me,b=ne,x=V,ee=ie,T=ye,E=se,D=ue,k=G,j=_e,z=xe,te=le,oe=ge,ce=q,J=W,X=ve,Ce=U,we=he,Te=pe,Ee=K,De=be;return y(),B(De,{name:e.field.name,label:e.field.label,rules:O.value,"label-col":e.field.labelCol,"wrapper-col":e.field.wrapperCol,tooltip:e.field.tooltip,"has-feedback":e.field.hasFeedback,"validate-status":e.field.validateStatus,help:e.field.help,extra:e.field.extra,required:e.field.required,"validate-trigger":e.field.validateTrigger,"validate-debounce":e.field.validateDebounce,"validate-first":e.field.validateFirst,hidden:e.field.hiddenItem,layout:e.field.layout},{default:M(()=>[e.field.type===`input`?(y(),B(r,c({key:0,value:g.value,"onUpdate:value":n[0]||=e=>g.value=e,placeholder:e.field.placeholder,disabled:h.value,autocomplete:e.field.props?.autocomplete},e.field.props),null,16,[`value`,`placeholder`,`disabled`,`autocomplete`])):e.field.type===`password`?(y(),B(a,c({key:1,value:g.value,"onUpdate:value":n[1]||=e=>g.value=e,placeholder:e.field.placeholder,disabled:h.value,autocomplete:e.field.props?.autocomplete||`current-password`},e.field.props),null,16,[`value`,`placeholder`,`disabled`,`autocomplete`])):e.field.type===`textarea`?(y(),B(s,c({key:2,value:g.value,"onUpdate:value":n[2]||=e=>g.value=e,placeholder:e.field.placeholder,disabled:h.value},e.field.props),null,16,[`value`,`placeholder`,`disabled`])):e.field.type===`number`?(y(),B(u,c({key:3,value:g.value,"onUpdate:value":n[3]||=e=>g.value=e,placeholder:e.field.placeholder,disabled:h.value,style:{width:`100%`}},e.field.props),null,16,[`value`,`placeholder`,`disabled`])):e.field.type===`select`?(y(),B(f,c({key:4,value:g.value,"onUpdate:value":n[4]||=e=>g.value=e,placeholder:e.field.placeholder,disabled:h.value,options:C.value,loading:o.value,virtual:p.value?.enabled,"list-height":p.value?p.value.itemHeight*10:void 0,style:{width:`100%`}},e.field.props),null,16,[`value`,`placeholder`,`disabled`,`options`,`loading`,`virtual`,`list-height`])):e.field.type===`radio`?(y(),B(_,c({key:5,value:g.value,"onUpdate:value":n[5]||=e=>g.value=e,disabled:h.value},e.field.props),{default:M(()=>[(y(!0),R(w,null,l(C.value,e=>(y(),B(m,{key:String(e.value),value:e.value,disabled:e.disabled},{default:M(()=>[L(A(e.label),1)]),_:2},1032,[`value`,`disabled`]))),128))]),_:1},16,[`value`,`disabled`])):e.field.type===`radio-button`?(y(),B(_,c({key:6,value:g.value,"onUpdate:value":n[6]||=e=>g.value=e,disabled:h.value},e.field.props),{default:M(()=>[(y(!0),R(w,null,l(C.value,e=>(y(),B(b,{key:String(e.value),value:e.value,disabled:e.disabled},{default:M(()=>[L(A(e.label),1)]),_:2},1032,[`value`,`disabled`]))),128))]),_:1},16,[`value`,`disabled`])):e.field.type===`checkbox`?(y(),B(ee,c({key:7,value:g.value,"onUpdate:value":n[7]||=e=>g.value=e,disabled:h.value},e.field.props),{default:M(()=>[(y(!0),R(w,null,l(C.value,e=>(y(),B(x,{key:String(e.value),value:e.value,disabled:e.disabled},{default:M(()=>[L(A(e.label),1)]),_:2},1032,[`value`,`disabled`]))),128))]),_:1},16,[`value`,`disabled`])):e.field.type===`checkbox-single`?(y(),B(x,c({key:8,checked:g.value,"onUpdate:checked":n[8]||=e=>g.value=e,disabled:h.value},e.field.props),{default:M(()=>[L(A(e.field.props?.label||``),1)]),_:1},16,[`checked`,`disabled`])):e.field.type===`switch`?(y(),B(T,c({key:9,checked:g.value,"onUpdate:checked":n[9]||=e=>g.value=e,disabled:h.value},e.field.props),null,16,[`checked`,`disabled`])):e.field.type===`slider`?(y(),B(E,c({key:10,value:g.value,"onUpdate:value":n[10]||=e=>g.value=e,disabled:h.value,tooltip:e.field.props?.tooltip===void 0?{formatter:null}:e.field.props?.tooltip},e.field.props),null,16,[`value`,`disabled`,`tooltip`])):e.field.type===`rate`?(y(),B(D,c({key:11,value:g.value,"onUpdate:value":n[11]||=e=>g.value=e,disabled:h.value},e.field.props),null,16,[`value`,`disabled`])):e.field.type===`auto-complete`?(y(),B(k,c({key:12,value:g.value,"onUpdate:value":n[12]||=e=>g.value=e,placeholder:e.field.placeholder,disabled:h.value,options:C.value,style:{width:`100%`}},e.field.props),null,16,[`value`,`placeholder`,`disabled`,`options`])):e.field.type===`mention`?(y(),B(j,c({key:13,value:g.value,"onUpdate:value":n[13]||=e=>g.value=e,placeholder:e.field.placeholder,disabled:h.value,options:C.value,style:{width:`100%`}},e.field.props),null,16,[`value`,`placeholder`,`disabled`,`options`])):e.field.type===`date-picker`?(y(),B(z,c({key:14,value:g.value,"onUpdate:value":n[14]||=e=>g.value=e,placeholder:e.field.placeholder,disabled:h.value,style:{width:`100%`}},e.field.props),null,16,[`value`,`placeholder`,`disabled`])):e.field.type===`month-picker`?(y(),B(z,c({key:15,value:g.value,"onUpdate:value":n[15]||=e=>g.value=e,placeholder:e.field.placeholder,disabled:h.value,picker:`month`,style:{width:`100%`}},e.field.props),null,16,[`value`,`placeholder`,`disabled`])):e.field.type===`quarter-picker`?(y(),B(z,c({key:16,value:g.value,"onUpdate:value":n[16]||=e=>g.value=e,placeholder:e.field.placeholder,disabled:h.value,picker:`quarter`,style:{width:`100%`}},e.field.props),null,16,[`value`,`placeholder`,`disabled`])):e.field.type===`year-picker`?(y(),B(z,c({key:17,value:g.value,"onUpdate:value":n[17]||=e=>g.value=e,placeholder:e.field.placeholder,disabled:h.value,picker:`year`,style:{width:`100%`}},e.field.props),null,16,[`value`,`placeholder`,`disabled`])):e.field.type===`week-picker`?(y(),B(z,c({key:18,value:g.value,"onUpdate:value":n[18]||=e=>g.value=e,placeholder:e.field.placeholder,disabled:h.value,picker:`week`,style:{width:`100%`}},e.field.props),null,16,[`value`,`placeholder`,`disabled`])):e.field.type===`range-picker`?(y(),B(te,c({key:19,value:g.value,"onUpdate:value":n[19]||=e=>g.value=e,disabled:h.value,style:{width:`100%`}},e.field.props),null,16,[`value`,`disabled`])):e.field.type===`time-picker`?(y(),B(oe,c({key:20,value:g.value,"onUpdate:value":n[20]||=e=>g.value=e,placeholder:e.field.placeholder,disabled:h.value,style:{width:`100%`}},e.field.props),null,16,[`value`,`placeholder`,`disabled`])):e.field.type===`time-range-picker`?(y(),B(ce,c({key:21,value:g.value,"onUpdate:value":n[21]||=e=>g.value=e,disabled:h.value,style:{width:`100%`}},e.field.props),null,16,[`value`,`disabled`])):e.field.type===`cascader`?(y(),B(J,c({key:22,value:g.value,"onUpdate:value":n[22]||=e=>g.value=e,placeholder:e.field.placeholder,disabled:h.value,options:C.value,virtual:p.value?.enabled,style:{width:`100%`}},e.field.props),null,16,[`value`,`placeholder`,`disabled`,`options`,`virtual`])):e.field.type===`tree-select`?(y(),B(X,c({key:23,value:g.value,"onUpdate:value":n[23]||=e=>g.value=e,placeholder:e.field.placeholder,disabled:h.value,"tree-data":C.value,virtual:p.value?.enabled,style:{width:`100%`}},e.field.props),null,16,[`value`,`placeholder`,`disabled`,`tree-data`,`virtual`])):e.field.type===`upload`?(y(),B(we,c({key:24,"file-list":g.value,"onUpdate:fileList":n[24]||=e=>g.value=e,disabled:h.value},e.field.props),{default:M(()=>[e.field.props?.customUpload?S(``,!0):(y(),B(Ce,{key:0},{icon:M(()=>[...n[30]||=[F(`svg`,{class:`w-4 h-4`,fill:`none`,stroke:`currentColor`,viewBox:`0 0 24 24`},[F(`path`,{"stroke-linecap":`round`,"stroke-linejoin":`round`,"stroke-width":`2`,d:`M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12`})],-1)]]),default:M(()=>[L(` `+A(e.field.props?.uploadText||I(i)(`common.clickToUpload`)),1)]),_:1}))]),_:1},16,[`file-list`,`disabled`])):e.field.type===`transfer`?(y(),B(Te,c({key:25,"target-keys":g.value,"onUpdate:targetKeys":n[25]||=e=>g.value=e,"data-source":C.value,disabled:h.value,render:e=>e.label},e.field.props),null,16,[`target-keys`,`data-source`,`disabled`,`render`])):e.field.type===`segmented`?(y(),B(Ee,c({key:26,value:g.value,"onUpdate:value":n[26]||=e=>g.value=e,options:C.value,disabled:h.value},e.field.props),null,16,[`value`,`options`,`disabled`])):e.field.type===`color-picker`?(y(),R(`div`,Ne,[N(F(`input`,c({"onUpdate:modelValue":n[27]||=e=>g.value=e,type:`color`,disabled:h.value,class:`w-10 h-10 p-0 border rounded cursor-pointer`},e.field.props),null,16,Pe),[[P,g.value]]),v(r,c({value:g.value,"onUpdate:value":n[28]||=e=>g.value=e,disabled:h.value,placeholder:e.field.placeholder,style:{width:`120px`}},e.field.props?.inputProps),null,16,[`value`,`disabled`,`placeholder`])])):e.field.type===`icon`?(y(),B(I(Se),{key:28,modelValue:g.value,"onUpdate:modelValue":n[29]||=e=>g.value=e,placeholder:e.field.placeholder,disabled:h.value,size:e.field.props?.size,"show-clear":e.field.props?.showClear??!0,categories:e.field.props?.categories,"exclude-categories":e.field.props?.excludeCategories,"popup-width":e.field.props?.popupWidth,"popup-height":e.field.props?.popupHeight,columns:e.field.props?.columns,"show-category-tabs":e.field.props?.showCategoryTabs??!0},null,8,[`modelValue`,`placeholder`,`disabled`,`size`,`show-clear`,`categories`,`exclude-categories`,`popup-width`,`popup-height`,`columns`,`show-category-tabs`])):e.field.type===`list`&&e.field.listConfig?(y(),B(Oe,{key:29,field:e.field,"form-data":e.formData,"list-config":e.field.listConfig},null,8,[`field`,`form-data`,`list-config`])):e.field.type===`group`&&e.field.groupConfig?(y(),B(Me,{key:30,field:e.field,"form-data":e.formData,"group-config":e.field.groupConfig},null,8,[`field`,`form-data`,`group-config`])):e.field.type===`custom`?d(t.$slots,e.field.slot,{key:31,field:e.field,value:g.value,disabled:h.value}):S(``,!0)]),_:3},8,[`name`,`label`,`rules`,`label-col`,`wrapper-col`,`tooltip`,`has-feedback`,`validate-status`,`help`,`extra`,`required`,`validate-trigger`,`validate-debounce`,`validate-first`,`hidden`,`layout`])}}}),Q={"oklch(0.205 0 0)":`#171717`,"oklch(0.985 0 0)":`#fafafa`,"oklch(0.97 0 0)":`#f5f5f5`,"oklch(0.145 0 0)":`#262626`,"oklch(1 0 0)":`#ffffff`,"oklch(0.556 0 0)":`#737373`,"oklch(0.922 0 0)":`#e5e5e5`,"oklch(0.708 0 0)":`#a3a3a3`,"oklch(0.577 0.245 27.325)":`#dc2626`,"oklch(0.269 0 0)":`#404040`,"oklch(0.546 0.245 262.881)":`#2563eb`,"oklch(0.527 0.154 150.069)":`#16a34a`,"oklch(0.558 0.288 302.321)":`#9333ea`,"oklch(0.646 0.222 41.116)":`#ea580c`,"oklch(0.606 0.285 349.5)":`#db2777`,"oklch(0.6 0.118 184.704)":`#0891b2`,"oklch(0.511 0.262 276.5)":`#4f46e5`,"oklch(0.769 0.188 70.08)":`#ca8a04`,"oklch(0.696 0.17 162.48)":`#059669`,"oklch(0.75 0.18 85)":`#d97706`,"oklch(1 0 0 / 10%)":`rgba(255, 255, 255, 0.1)`,"oklch(1 0 0 / 15%)":`rgba(255, 255, 255, 0.15)`,"oklch(0.704 0.191 22.216)":`#ef4444`};function $(e){if(Q[e])return Q[e];if(e.includes(`/`)){let t=e.split(` /`)[0].trim();if(Q[t])return Q[t]}return console.warn(`[TForm Theme] 无法转换颜色: ${e}，请添加到 colorMap`),e}function Fe(){let e=a();return x(()=>{let t=e.currentColors,n=e.layoutConfig.radius;return{algorithm:e.currentMode===`dark`?X.darkAlgorithm:X.defaultAlgorithm,token:{colorPrimary:$(t.primary),colorBgContainer:$(t.background),colorBgElevated:$(t.card),colorText:$(t.foreground),colorTextSecondary:$(t.mutedForeground),colorBorder:$(t.border),colorError:$(t.destructive),borderRadius:n*16,borderRadiusSM:n*12,borderRadiusLG:n*20,paddingSM:8,padding:12,paddingMD:16,paddingLG:20,paddingXL:24,fontSizeSM:12,fontSize:14,fontSizeLG:16,fontSizeXL:18},components:{Form:{colorTextLabel:$(t.foreground),colorTextDescription:$(t.mutedForeground)},Input:{colorBorder:$(t.input),colorBgContainer:$(t.background),colorText:$(t.foreground),colorTextPlaceholder:$(t.mutedForeground)},Select:{colorBorder:$(t.border),colorBgContainer:$(t.background),colorText:$(t.foreground),colorTextPlaceholder:$(t.mutedForeground),colorBgElevated:$(t.popover)},DatePicker:{colorBorder:$(t.border),colorBgContainer:$(t.background),colorText:$(t.foreground),colorBgElevated:$(t.popover),colorPrimary:$(t.primary)},Button:{colorPrimary:$(t.primary),colorPrimaryHover:$(t.primary),colorPrimaryActive:$(t.primary),colorText:$(t.foreground),colorBgContainer:$(t.background),colorBorder:$(t.border)},Switch:{colorPrimary:$(t.primary)},Slider:{colorPrimary:$(t.primary),colorBgElevated:$(t.muted)},Rate:{colorFillContent:$(t.muted)},Radio:{colorPrimary:$(t.primary),colorText:$(t.foreground)},Checkbox:{colorPrimary:$(t.primary),colorText:$(t.foreground)},Cascader:{colorBorder:$(t.border),colorBgContainer:$(t.background),colorBgElevated:$(t.popover),colorText:$(t.foreground)},TreeSelect:{colorBorder:$(t.border),colorBgContainer:$(t.background),colorBgElevated:$(t.popover),colorText:$(t.foreground)},Upload:{colorText:$(t.foreground),colorTextDescription:$(t.mutedForeground)},Transfer:{colorBorder:$(t.border),colorBgContainer:$(t.background),colorBgElevated:$(t.card),colorText:$(t.foreground)},Segmented:{colorBgElevated:$(t.background),colorText:$(t.foreground),colorTextLabel:$(t.foreground)},Mentions:{colorBorder:$(t.border),colorBgContainer:$(t.background),colorText:$(t.foreground),colorBgElevated:$(t.popover)},AutoComplete:{colorBorder:$(t.border),colorBgContainer:$(t.background),colorBgElevated:$(t.popover),colorText:$(t.foreground)},InputNumber:{colorBorder:$(t.border),colorBgContainer:$(t.background),colorText:$(t.foreground)},TimePicker:{colorBorder:$(t.border),colorBgContainer:$(t.background),colorBgElevated:$(t.popover),colorText:$(t.foreground),colorPrimary:$(t.primary)}}}})}function Ie(e){try{return JSON.parse(JSON.stringify(e))}catch(t){return console.warn(`[useFormMeta] 深拷贝失败，使用浅拷贝`,t),Array.isArray(e)?[...e]:{...e}}}function Le(e,t){let n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;for(let i of n){if(!r.includes(i))return!1;let n=e[i],a=t[i];if(n instanceof Date&&a instanceof Date){if(n.getTime()!==a.getTime())return!1;continue}if(typeof n!=typeof a)return!1;if(typeof n==`object`&&n&&a!==null){if(Array.isArray(n)&&Array.isArray(a)){if(n.length!==a.length)return!1;for(let e=0;e<n.length;e++)if(typeof n[e]==`object`&&n[e]!==null){if(!Le(n[e],a[e]))return!1}else if(n[e]!==a[e])return!1;continue}if(!Le(n,a))return!1;continue}if(n!==a)return!1}return!0}function Re(){let e=D({dirty:!1,touched:!1,valid:!0,submitting:!1,validating:!1}),t=T({});function n(e){t.value=Ie(e)}function r(n){e.dirty=!Le(n,t.value)}function i(){e.touched=!0}function a(t){e.valid=t}function o(t){e.submitting=t}function s(t){e.validating=t}function c(){e.dirty=!1,e.touched=!1,e.valid=!0,e.submitting=!1,e.validating=!1,t.value={}}function l(){return{...e}}return{meta:e,initialFormData:t,setInitialData:n,updateMeta:r,markTouched:i,setValid:a,setSubmitting:o,setValidating:s,resetMeta:c,getMetaSnapshot:l}}var ze={enabled:!1,collapsed:!1,collapseThreshold:3,showCollapseButton:!0,collapseButtonText:`Collapse`,expandButtonText:`Expand`,columns:3,gutter:16,searchText:`Search`,resetText:`Reset`,showReset:!0,onSearch:void 0,onReset:void 0};function Be(e){let{schema:t,formData:n,initialCollapsed:r,locale:i}=e,a=x(()=>n instanceof Object&&`value`in n?n.value:n),o=T(r??t.searchConfig?.collapsed??!1),s=x(()=>t.searchConfig?.enabled===!0),c=x(()=>{let e=i?{searchText:i.value.searchText,resetText:i.value.resetText,expandButtonText:i.value.expandButtonText,collapseButtonText:i.value.collapseButtonText}:{};return{...ze,...t.searchConfig,...e}});function l(e){return typeof e.hidden==`function`?e.hidden(a.value):e.hidden??!1}function u(e){if(!e.dependencies)return!0;let{field:t,condition:n}=e.dependencies,r=a.value[t];return n(r,a.value)}let d=x(()=>t.fields.filter(e=>!(l(e)||!u(e)))),f=x(()=>{let e=d.value;return!s.value||!o.value?e:e.slice(0,c.value.collapseThreshold)}),p=x(()=>d.value.length>c.value.collapseThreshold),m=x(()=>d.value.length<=c.value.collapseThreshold+1);function h(){o.value=!o.value}function g(){o.value=!1}function _(){o.value=!0}return{isCollapsed:o,isSearchMode:s,searchConfig:c,visibleFields:d,searchVisibleFields:f,hasMoreFields:p,shouldShowInline:m,toggleCollapse:h,expand:g,collapse:_}}var Ve=m(J(),1);Ce(),we();var He={key:0,class:`search-form-inline`},Ue={class:`search-form-fields`},We={class:`search-form-actions-inline`},Ge=[`disabled`],Ke=[`data-collapsed`],qe={class:`search-form-actions-collapsed`},Je=[`disabled`],Ye=[`data-collapsed`],Xe={class:`search-form-actions-expanded`},Ze=[`disabled`],Qe=[`data-collapsed`],$e=i({name:`TForm`,__name:`TForm`,props:{schema:{},modelValue:{default:()=>({})},loading:{type:Boolean,default:!1}},emits:[`update:modelValue`,`submit`,`finishFailed`,`reset`,`change`,`fieldsChange`],setup(n,{expose:i,emit:a}){let p=n,m=a,{t:g,locale:b}=r(),C=Fe(),E=T(null);async function O(){let e=b.value;E.value=await te(e),Ve.default.locale(e===`zh-CN`?`zh-cn`:`en`)}j(b,O,{immediate:!0});let N=ee(),P=T(null),z=D({}),ne=D(new Map),re=D(new Map),ie=x(()=>({searchText:g(`common.search`),resetText:g(`common.reset`),expandButtonText:g(`common.expand`),collapseButtonText:g(`common.collapse`)})),{isCollapsed:V,isSearchMode:H,searchConfig:U,visibleFields:ae,searchVisibleFields:W,hasMoreFields:G,shouldShowInline:se,toggleCollapse:K}=Be({schema:p.schema,formData:z,locale:ie}),{meta:q,setInitialData:le,updateMeta:ue,markTouched:de,setValid:fe,setSubmitting:pe,setValidating:me,getMetaSnapshot:J}=Re();function Y(e){return Array.isArray(e)?e.join(`.`):String(e)}function he(e,t){let n=Y(e);ne.set(n,t)}function ge(e,t){let n=Y(e);re.set(n,t)}function _e(){p.schema.fields.forEach(e=>{let t=e.name;e.defaultValue!==void 0&&z[t]===void 0&&(z[t]=e.defaultValue)}),le(z)}function ve(e){m(`finishFailed`,e)}function X(){P.value?.resetFields(),H.value&&p.schema.searchConfig?.onReset&&p.schema.searchConfig.onReset(),!H.value&&p.schema.actions?.onReset&&p.schema.actions.onReset(),m(`reset`)}function ye(e){H.value&&p.schema.searchConfig?.onSearch&&p.schema.searchConfig.onSearch(e),m(`submit`,e)}function xe(e,t){m(`fieldsChange`,e,t)}let Se={setFieldValue:(e,t)=>{P.value?.setFieldValue(e,t)},getFieldValue:e=>P.value?.getFieldValue(e),setFieldDisabled:he,setFieldHidden:ge},Ce=x(()=>{let e=[];return p.schema.fields.forEach(t=>{t.watch&&t.watch.length>0&&t.watch.forEach(n=>{e.push({field:Y(t.name),watch:n})})}),e});function we(e){Object.assign(z,e),de(),ue(z),u(()=>{Ce.value.forEach(({watch:t})=>{let n=t.field;if(n in e){let e=z[n];t.handler(e,{...z},Se)}})}),m(`update:modelValue`,{...z}),m(`change`,e,{...z})}let Te=x(()=>{if(p.schema.layout===`horizontal`)return{offset:p.schema.labelCol?.span||0,span:p.schema.wrapperCol?.span||24}});return i({validate:e=>P.value?.validateFields(e)||Promise.resolve({}),validateFields:e=>P.value?.validateFields(e)||Promise.resolve({}),resetFields:e=>{P.value?.resetFields(e)},clearValidate:e=>{P.value?.clearValidate(e)},getFieldValue:e=>P.value?.getFieldValue(e),getFieldsValue:e=>P.value?.getFieldsValue(e)||{},setFieldValue:(e,t)=>{P.value?.setFieldValue(e,t)},setFieldsValue:e=>{P.value?.setFieldsValue(e)},setFieldDisabled:he,getMeta:J,isDirty:()=>q.dirty,isTouched:()=>q.touched,isValid:()=>q.valid,getFormInstance:()=>P.value??void 0}),j(()=>p.modelValue,e=>{e&&Object.assign(z,e)},{immediate:!0,deep:!0}),j(()=>p.schema,()=>{_e()},{deep:!0}),_e(),(r,i)=>{let a=be,u=ce;return E.value?(y(),B(I(oe),{key:0,theme:I(C),locale:E.value},{default:M(()=>[v(u,{ref_key:`formRef`,ref:P,model:z,layout:I(H)?`inline`:n.schema.layout,"label-col":I(H)?void 0:n.schema.labelCol,"wrapper-col":I(H)?void 0:n.schema.wrapperCol,"label-align":n.schema.labelAlign,size:n.schema.size,disabled:n.schema.disabled||n.loading,colon:n.schema.colon,variant:n.schema.variant,"validate-trigger":n.schema.validateTrigger,"validate-messages":n.schema.validateMessages,preserve:n.schema.preserve,"clear-on-destroy":n.schema.clearOnDestroy,"scroll-to-first-error":n.schema.scrollToFirstError,class:s(I(f)(`t-form`,{"t-form-search":I(H),"t-form-collapsed":I(H)&&I(V)},r.$attrs.class)),onFinish:ye,onFinishFailed:ve,onValuesChange:we,onFieldsChange:xe},{default:M(()=>[I(H)?(y(),R(w,{key:0},[I(se)?(y(),R(`div`,He,[F(`div`,Ue,[(y(!0),R(w,null,l(I(W),e=>(y(),B(Z,{key:String(e.name),field:e,"form-data":z,class:`search-form-item-inline`},_({_:2},[e.type===`custom`&&e.slot&&I(N)[e.slot]?{name:e.slot,fn:M(t=>[d(r.$slots,e.slot,c({ref_for:!0},t))]),key:`0`}:void 0]),1032,[`field`,`form-data`]))),128))]),F(`div`,We,[F(`button`,{type:`submit`,disabled:n.loading,class:`inline-flex items-center justify-center rounded-md bg-primary px-3 py-[5px] text-sm font-medium text-primary-foreground shadow-sm hover:bg-primary/90 focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50`},[v(I(o),{class:`w-4 h-4 mr-1`}),L(` `+A(I(U).searchText),1)],8,Ge),I(U).showReset?(y(),R(`button`,{key:0,type:`button`,class:`inline-flex items-center justify-center rounded-md border border-input bg-background px-3 py-[5px] text-sm font-medium text-foreground shadow-sm hover:bg-accent hover:text-accent-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2`,onClick:X},[v(I(k),{class:`w-4 h-4 mr-1`}),L(` `+A(I(U).resetText),1)])):S(``,!0),I(U).showCollapseButton&&I(G)?(y(),R(`button`,{key:1,type:`button`,class:`collapse-btn`,"data-collapsed":I(V),onClick:i[0]||=(...e)=>I(K)&&I(K)(...e)},[L(A(I(V)?I(U).expandButtonText:I(U).collapseButtonText)+` `,1),v(I(t),{class:`chevron-icon w-4 h-4 ml-1`})],8,Ke)):S(``,!0)])])):(y(),R(w,{key:1},[I(V)?(y(),R(`div`,{key:0,class:`search-form-container search-form-collapsed-row`,style:h({display:`grid`,gridTemplateColumns:`repeat(${I(U).columns}, minmax(0, 1fr))`,gap:`${I(U).gutter}px`})},[(y(!0),R(w,null,l(I(W),e=>(y(),B(Z,{key:String(e.name),field:e,"form-data":z,class:`search-form-item`},_({_:2},[e.type===`custom`&&e.slot&&I(N)[e.slot]?{name:e.slot,fn:M(t=>[d(r.$slots,e.slot,c({ref_for:!0},t))]),key:`0`}:void 0]),1032,[`field`,`form-data`]))),128)),F(`div`,qe,[F(`button`,{type:`submit`,disabled:n.loading,class:`search-btn-collapsed`},[v(I(o),{class:`w-4 h-4 mr-1`}),L(` `+A(I(U).searchText),1)],8,Je),I(U).showReset?(y(),R(`button`,{key:0,type:`button`,class:`reset-btn-collapsed`,onClick:X},[v(I(k),{class:`w-4 h-4 mr-1`}),L(` `+A(I(U).resetText),1)])):S(``,!0),I(U).showCollapseButton&&I(G)?(y(),R(`button`,{key:1,type:`button`,class:`collapse-btn collapse-btn-inline`,"data-collapsed":I(V),onClick:i[1]||=(...e)=>I(K)&&I(K)(...e)},[L(A(I(U).expandButtonText)+` `,1),v(I(t),{class:`chevron-icon w-4 h-4 ml-1`})],8,Ye)):S(``,!0)])],4)):(y(),R(`div`,{key:1,class:`search-form-container search-form-expanded-row`,style:h({display:`grid`,gridTemplateColumns:`repeat(${I(U).columns}, minmax(0, 1fr))`,gap:`${I(U).gutter}px`})},[(y(!0),R(w,null,l(I(W),e=>(y(),B(Z,{key:String(e.name),field:e,"form-data":z,class:`search-form-item`},_({_:2},[e.type===`custom`&&e.slot&&I(N)[e.slot]?{name:e.slot,fn:M(t=>[d(r.$slots,e.slot,c({ref_for:!0},t))]),key:`0`}:void 0]),1032,[`field`,`form-data`]))),128)),F(`div`,Xe,[F(`button`,{type:`submit`,disabled:n.loading,class:`search-btn-expanded`},[v(I(o),{class:`w-4 h-4 mr-1`}),L(` `+A(I(U).searchText),1)],8,Ze),I(U).showReset?(y(),R(`button`,{key:0,type:`button`,class:`reset-btn-expanded`,onClick:X},[v(I(k),{class:`w-4 h-4 mr-1`}),L(` `+A(I(U).resetText),1)])):S(``,!0),I(U).showCollapseButton&&I(G)?(y(),R(`button`,{key:1,type:`button`,class:`collapse-btn collapse-btn-inline`,"data-collapsed":I(V),onClick:i[2]||=(...e)=>I(K)&&I(K)(...e)},[L(A(I(U).collapseButtonText)+` `,1),v(I(t),{class:`chevron-icon w-4 h-4 ml-1`})],8,Qe)):S(``,!0)])],4))],64))],64)):(y(),R(w,{key:1},[n.schema.columns&&n.schema.columns>1?(y(),R(`div`,{key:0,class:`t-form-grid`,style:h({display:`grid`,gridTemplateColumns:`repeat(${n.schema.columns}, 1fr)`,gap:`16px 24px`})},[(y(!0),R(w,null,l(I(ae),e=>(y(),B(Z,{key:String(e.name),field:e,"form-data":z,style:{"margin-bottom":`0`}},_({_:2},[e.type===`custom`&&e.slot&&I(N)[e.slot]?{name:e.slot,fn:M(t=>[d(r.$slots,e.slot,c({ref_for:!0},t))]),key:`0`}:void 0]),1032,[`field`,`form-data`]))),128))],4)):(y(!0),R(w,{key:1},l(I(ae),e=>(y(),B(Z,{key:String(e.name),field:e,"form-data":z},_({_:2},[e.type===`custom`&&e.slot&&I(N)[e.slot]?{name:e.slot,fn:M(t=>[d(r.$slots,e.slot,c({ref_for:!0},t))]),key:`0`}:void 0]),1032,[`field`,`form-data`]))),128)),n.schema.actions?.showSubmit!==!1||n.schema.actions?.showReset?(y(),B(a,{key:2,"wrapper-col":Te.value,class:s({"t-form-actions-fullwidth":n.schema.columns&&n.schema.columns>1})},{default:M(()=>[F(`div`,{class:s(I(f)(`flex gap-2`,{"justify-start":n.schema.actions?.align===`left`,"justify-center":n.schema.actions?.align===`center`,"justify-end":!n.schema.actions?.align||n.schema.actions?.align===`right`}))},[n.schema.actions?.showSubmit===!1?S(``,!0):(y(),B(I(e),{key:0,type:`submit`,loading:n.loading},{default:M(()=>[L(A(n.schema.actions?.submitText||I(g)(`common.submit`)),1)]),_:1},8,[`loading`])),n.schema.actions?.showReset?(y(),B(I(e),{key:1,type:`button`,variant:`outline`,onClick:X},{default:M(()=>[L(A(n.schema.actions?.resetText||I(g)(`common.reset`)),1)]),_:1})):S(``,!0)],2)]),_:1},8,[`wrapper-col`,`class`])):S(``,!0)],64))]),_:3},8,[`model`,`layout`,`label-col`,`wrapper-col`,`label-align`,`size`,`disabled`,`colon`,`variant`,`validate-trigger`,`validate-messages`,`preserve`,`clear-on-destroy`,`scroll-to-first-error`,`class`])]),_:3},8,[`theme`,`locale`])):S(``,!0)}}});export{$e as t};