import"./ScrollArea-CW0-18Hy.js";import"./RovingFocusItem-DihGLheP.js";import{t as e}from"./button-Bo4o88Eb.js";import"./Presence-CX2vXdhf.js";import"./defu-BJL4Fjh2.js";import"./usePrimitiveElement-bvCn2QxH.js";import"./TabsTrigger-EHjOJe4X.js";import{$ as t,Ct as n,Di as ee,Ea as r,Gi as te,Gn as i,M as a,Ti as o,Ui as s,Yi as ne,_i as c,bi as l,da as u,fi as re,g as d,ga as f,jn as p,ka as m,oa as h,ot as g,vi as _,wa as v,wi as y,xi as b,yi as x,z as S}from"./index-D9LA8apy.js";import"./en_US-N9Q-_HQi.js";import"./common-rttX-sZZ.js";import"./zh_CN-RQJLYl9H.js";import"./useTabBar-WvhELTvw.js";import{t as C}from"./badge-DoBLqkFL.js";import{n as ie,t as ae}from"./CardContent-bGWyUVF7.js";import{n as oe,t as se}from"./CardTitle-9YsRePqj.js";import"./dist-guKItzxh.js";import{t as ce}from"./TTable-BJXg8Gts.js";import{t as w}from"./TForm-De-AxzjP.js";import"./Input-DxyLxkUT.js";import"./TIcon-DpsAxes7.js";import{t as T}from"./TModal-l0DmcJma.js";import{n as le}from"./composables-B_2v-ght.js";import"./constants-BrhrixW3.js";var ue={class:`space-y-6`},de={class:`flex flex-col sm:flex-row sm:items-center justify-between gap-4`},fe={class:`flex flex-wrap gap-3`},pe={class:`flex items-baseline gap-2`},me={class:`text-lg font-semibold`},he={class:`text-xs text-muted-foreground`},E={class:`bg-muted/30 rounded-lg p-4`},D={class:`flex flex-col lg:flex-row lg:items-center gap-4`},O={class:`flex-1`},k={key:0,class:`flex items-center gap-2 lg:border-l lg:pl-4`},A={class:`text-sm text-muted-foreground`},j={class:`flex items-center justify-between`},M={class:`flex items-center gap-3`},N={class:`text-xs text-muted-foreground bg-muted px-2 py-0.5 rounded-full`},P={class:`flex items-center gap-2 text-sm text-muted-foreground`},F={class:`flex items-center gap-2`},I={class:`font-medium`},L={class:`flex flex-col items-center justify-center py-12 text-muted-foreground`},R={class:`w-16 h-16 rounded-full bg-muted flex items-center justify-center mb-4`},z=ee({__name:`Categories`,setup(ee){let{data:z,loading:ge,searchQuery:B,filters:V,currentPage:_e,pageSize:ve,total:ye,statistics:H,fetchData:U,goToPage:be,setPageSize:xe,addData:Se,updateData:Ce,removeData:we,batchRemoveData:Te}=le({apiCall:async e=>await p.getCategories(e)||{list:[],total:0,page:1,pageSize:10},apiCallParams:e=>({page:e.page,pageSize:e.pageSize,search:e.searchQuery,level:e.filters.level,status:e.filters.status}),statisticsFn:e=>({total:e.length,level1:e.filter(e=>e.level===1).length,level2:e.filter(e=>e.level===2).length,active:e.filter(e=>e.status===i.ACTIVE).length,totalProducts:e.reduce((e,t)=>e+(t.productCount||0),0)})}),Ee=c(()=>{let e=H.value||{};return[{title:`总分类`,value:e.total||0,icon:g,color:`text-blue-500`},{title:`一级分类`,value:e.level1||0,icon:t,color:`text-purple-500`},{title:`二级分类`,value:e.level2||0,icon:d,color:`text-orange-500`},{title:`已启用`,value:e.active||0,icon:n,color:`text-green-500`}]}),W=f({keyword:``,level:``,status:``}),De={layout:`inline`,fields:[{name:`keyword`,type:`input`,label:``,placeholder:`搜索分类名称...`,className:`w-[200px]`},{name:`level`,type:`select`,label:``,placeholder:`全部级别`,options:[{label:`全部级别`,value:``},{label:`一级分类`,value:`1`},{label:`二级分类`,value:`2`}],className:`w-[140px]`},{name:`status`,type:`select`,label:``,placeholder:`全部状态`,options:[{label:`全部状态`,value:``},{label:`启用`,value:i.ACTIVE},{label:`禁用`,value:i.INACTIVE}],className:`w-[140px]`}],searchConfig:{enabled:!0,collapsed:!1,showCollapseButton:!1,searchText:`搜索`,resetText:`重置`,showReset:!0,onSearch:e=>{B.value=e.keyword||``,V.value={level:e.level?Number(e.level):void 0,status:e.status}},onReset:()=>{B.value=``,V.value={}}}},G=f(),Oe=c(()=>({columns:[{title:`分类名称`,dataIndex:`name`,width:180,slot:`name`},{title:`分类编码`,dataIndex:`code`,width:150},{title:`级别`,dataIndex:`level`,width:100,slot:`level`},{title:`上级分类`,dataIndex:`parentName`,width:150,customRender:({text:e})=>e||`-`},{title:`商品数量`,dataIndex:`productCount`,width:100,sorter:!0},{title:`排序`,dataIndex:`sort`,width:80,sorter:!0},{title:`状态`,dataIndex:`status`,width:100,slot:`status`}],pagination:{pageSize:10,show:!0,showSizeChanger:!0},rowSelection:{type:`checkbox`,show:!0},actions:[{text:`编辑`,type:`primary`,onClick:e=>Me(e)},{text:`删除`,type:`danger`,confirm:!0,confirmText:`确定要删除该分类吗？`,onClick:e=>Pe(e.id)}],actionWidth:150,actionFixed:`right`})),K=c(()=>z.value.filter(e=>e.level===1)),q=c(()=>z.value.map(e=>({...e,key:e.id}))),J=f(!1),Y=f(!1),X=f(null),Z=f({name:``,code:``,level:1,parentId:``,sort:0,status:`active`,description:``}),Q=f({id:``,name:``,code:``,level:1,parentId:``,sort:0,status:`active`,description:``}),ke={layout:`horizontal`,labelCol:{span:6},wrapperCol:{span:18},fields:[{name:`name`,type:`input`,label:`分类名称`,placeholder:`请输入分类名称`,rules:[{required:!0,message:`分类名称不能为空`}]},{name:`code`,type:`input`,label:`分类编码`,placeholder:`请输入分类编码`,rules:[{required:!0,message:`分类编码不能为空`}]},{name:`level`,type:`select`,label:`分类级别`,placeholder:`请选择级别`,options:[{label:`一级分类`,value:1},{label:`二级分类`,value:2}],rules:[{required:!0,message:`请选择分类级别`}]},{name:`parentId`,type:`select`,label:`上级分类`,placeholder:`请选择上级分类`,options:()=>K.value.map(e=>({label:e.name,value:e.id})),show:()=>Z.value.level===2},{name:`sort`,type:`number`,label:`排序`,placeholder:`请输入排序号`},{name:`status`,type:`select`,label:`状态`,placeholder:`请选择状态`,options:[{label:`启用`,value:`active`},{label:`禁用`,value:`inactive`}]},{name:`description`,type:`textarea`,label:`描述`,placeholder:`请输入描述（可选）`}],actions:{showSubmit:!0,showReset:!0,submitText:`添加分类`,resetText:`取消`,align:`right`,onReset:()=>{J.value=!1}}},Ae={layout:`horizontal`,labelCol:{span:6},wrapperCol:{span:18},fields:[{name:`name`,type:`input`,label:`分类名称`,placeholder:`请输入分类名称`,rules:[{required:!0,message:`分类名称不能为空`}]},{name:`code`,type:`input`,label:`分类编码`,placeholder:`请输入分类编码`,rules:[{required:!0,message:`分类编码不能为空`}]},{name:`sort`,type:`number`,label:`排序`,placeholder:`请输入排序号`},{name:`status`,type:`select`,label:`状态`,placeholder:`请选择状态`,options:[{label:`启用`,value:`active`},{label:`禁用`,value:`inactive`}]},{name:`description`,type:`textarea`,label:`描述`,placeholder:`请输入描述（可选）`}],actions:{showSubmit:!0,showReset:!0,submitText:`保存修改`,resetText:`取消`,align:`right`,onReset:()=>{Y.value=!1}}};async function je(e){let t=K.value.find(t=>t.id===e.parentId);await p.createCategory({name:e.name,code:e.code,level:e.level,parentId:e.level===2?e.parentId:void 0,parentName:t?.name,sort:Number(e.sort)||0,status:e.status,productCount:0,description:e.description}),J.value=!1,Z.value={name:``,code:``,level:1,parentId:``,sort:0,status:`active`,description:``},await U()}function Me(e){X.value=e,Q.value={id:e.id,name:e.name,code:e.code,level:e.level,parentId:e.parentId||``,sort:e.sort,status:e.status,description:e.description||``},Y.value=!0}async function Ne(e){X.value&&(p.updateCategory(X.value.id,{name:e.name,code:e.code,sort:Number(e.sort),status:e.status,description:e.description}),Y.value=!1,X.value=null,U())}async function Pe(e){await p.deleteCategory(e),await U()}let $=f([]);function Fe(e){$.value=e}async function Ie(){if($.value.length===0){alert(`请先选择要删除的分类`);return}confirm(`确定要删除选中的 ${$.value.length} 个分类吗？`)&&(await p.batchDeleteCategories($.value.map(String)),G.value?.clearSelection(),await U())}function Le(e){e.current!==void 0&&be(e.current),e.pageSize!==void 0&&xe(e.pageSize)}return(t,n)=>(s(),b(`div`,ue,[_(`div`,de,[n[9]||=_(`div`,null,[_(`h1`,{class:`text-3xl font-bold tracking-tight`},`分类管理`),_(`p`,{class:`text-muted-foreground mt-1.5 text-sm`},`管理商品分类和层级`)],-1),o(v(e),{class:`gap-2`,onClick:n[0]||=e=>J.value=!0},{default:h(()=>[o(v(a),{class:`h-4 w-4`}),n[8]||=y(` 添加分类 `,-1)]),_:1})]),o(v(T),{open:v(J),"onUpdate:open":n[2]||=e=>u(J)?J.value=e:null,title:`添加分类`,width:`560`,footer:null},{default:h(()=>[o(v(w),{modelValue:v(Z),"onUpdate:modelValue":n[1]||=e=>u(Z)?Z.value=e:null,schema:ke,onSubmit:je},null,8,[`modelValue`])]),_:1},8,[`open`]),o(v(T),{open:v(Y),"onUpdate:open":n[4]||=e=>u(Y)?Y.value=e:null,title:`编辑分类`,width:`560`,footer:null},{default:h(()=>[v(X)?(s(),x(v(w),{key:0,modelValue:v(Q),"onUpdate:modelValue":n[3]||=e=>u(Q)?Q.value=e:null,schema:Ae,onSubmit:Ne},null,8,[`modelValue`])):l(``,!0)]),_:1},8,[`open`]),_(`div`,fe,[(s(!0),b(re,null,te(v(Ee),e=>(s(),b(`div`,{key:e.title,class:`flex items-center gap-3 px-4 py-2.5 bg-muted/50 rounded-lg hover:bg-muted/70 transition-colors`},[(s(),x(ne(e.icon),{class:r([`h-4 w-4`,e.color])},null,8,[`class`])),_(`div`,pe,[_(`span`,me,m(e.value),1),_(`span`,he,m(e.title),1)])]))),128))]),_(`div`,E,[_(`div`,D,[_(`div`,O,[o(v(w),{modelValue:v(W),"onUpdate:modelValue":n[5]||=e=>u(W)?W.value=e:null,schema:De},null,8,[`modelValue`])]),v($).length>0?(s(),b(`div`,k,[_(`span`,A,`已选 `+m(v($).length)+` 项`,1),o(v(e),{variant:`outline`,size:`sm`,class:`h-8 text-xs text-destructive hover:text-destructive`,onClick:Ie},{default:h(()=>[...n[10]||=[y(` 批量删除 `,-1)]]),_:1})])):l(``,!0)])]),o(v(ie),{class:`border-0 shadow-sm`},{default:h(()=>[o(v(oe),{class:`pb-4`},{default:h(()=>[_(`div`,j,[_(`div`,M,[o(v(se),{class:`text-base font-semibold`},{default:h(()=>[...n[11]||=[y(`分类列表`,-1)]]),_:1}),_(`span`,N,` 共 `+m(v(q).length)+` 个 `,1)]),_(`div`,P,[o(v(S),{class:`h-4 w-4`}),_(`span`,null,`关联商品: `+m(v(H).totalProducts||0),1)])])]),_:1}),o(v(ae),{class:`pt-0`},{default:h(()=>[o(v(ce),{ref_key:`tableRef`,ref:G,data:v(q),"onUpdate:data":n[7]||=e=>u(q)?q.value=e:null,schema:v(Oe),onSelectChange:Fe,onChange:Le},{name:h(e=>[_(`div`,F,[e.record.level===1?(s(),x(v(g),{key:0,class:`h-4 w-4 text-blue-500`})):(s(),x(v(d),{key:1,class:`h-4 w-4 text-orange-500`})),_(`span`,I,m(e.text),1)])]),level:h(e=>[o(v(C),{variant:e.text===1?`default`:`secondary`},{default:h(()=>[y(m(e.text===1?`一级`:`二级`),1)]),_:2},1032,[`variant`])]),status:h(e=>[o(v(C),{class:r({"bg-green-500/10 text-green-500 border-green-500/20":e.text===v(i).ACTIVE,"bg-gray-500/10 text-gray-500 border-gray-500/20":e.text===v(i).INACTIVE}),variant:`outline`},{default:h(()=>[y(m(e.text===v(i).ACTIVE?`启用`:`禁用`),1)]),_:2},1032,[`class`])]),emptyText:h(()=>[_(`div`,L,[_(`div`,R,[o(v(g),{class:`w-8 h-8 text-muted-foreground/50`})]),n[13]||=_(`p`,{class:`text-base font-medium mb-1`},`暂无分类数据`,-1),n[14]||=_(`p`,{class:`text-sm text-muted-foreground mb-4`},`开始添加您的第一个分类吧`,-1),o(v(e),{size:`sm`,onClick:n[6]||=e=>J.value=!0},{default:h(()=>[o(v(a),{class:`h-4 w-4 mr-1`}),n[12]||=y(` 添加分类 `,-1)]),_:1})])]),_:1},8,[`data`,`schema`])]),_:1})]),_:1})]))}});export{z as default};