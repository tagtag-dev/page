import"./ScrollArea-CW0-18Hy.js";import"./RovingFocusItem-DihGLheP.js";import{t as e}from"./button-Bo4o88Eb.js";import"./Presence-CX2vXdhf.js";import"./defu-BJL4Fjh2.js";import"./usePrimitiveElement-bvCn2QxH.js";import"./TabsTrigger-EHjOJe4X.js";import{$ as t,Ct as ee,Di as n,Ea as r,Gi as te,Jn as i,M as a,Nn as o,Ti as s,Ui as c,Yi as ne,_i as l,bi as u,bt as re,da as d,f as ie,fi as f,ga as p,ka as m,oa as h,p as g,qn as _,vi as v,wa as y,wi as b,xi as x,yi as S,z as C}from"./index-D9LA8apy.js";import"./en_US-N9Q-_HQi.js";import"./common-rttX-sZZ.js";import"./zh_CN-RQJLYl9H.js";import"./useTabBar-WvhELTvw.js";import{t as ae}from"./badge-DoBLqkFL.js";import{n as oe,t as se}from"./CardContent-bGWyUVF7.js";import{n as ce,t as le}from"./CardTitle-9YsRePqj.js";import{N as ue,w}from"./dist-guKItzxh.js";import{t as T}from"./TTable-BJXg8Gts.js";import{t as E}from"./TForm-De-AxzjP.js";import"./Input-DxyLxkUT.js";import"./TIcon-DpsAxes7.js";import{t as D}from"./TModal-l0DmcJma.js";import{n as de,r as O}from"./composables-B_2v-ght.js";import"./constants-BrhrixW3.js";var fe={class:`space-y-6`},pe={class:`flex flex-col sm:flex-row sm:items-center justify-between gap-4`},me={class:`flex flex-wrap gap-3`},k={class:`flex items-baseline gap-2`},A={class:`text-lg font-semibold`},j={class:`text-xs text-muted-foreground`},he={class:`bg-muted/30 rounded-lg p-4`},M={class:`flex flex-col lg:flex-row lg:items-center gap-4`},N={class:`flex-1`},P={key:0,class:`flex items-center gap-2 lg:border-l lg:pl-4`},F={class:`text-sm text-muted-foreground`},I={class:`flex items-center justify-between`},L={class:`flex items-center gap-3`},R={class:`text-xs text-muted-foreground bg-muted px-2 py-0.5 rounded-full`},ge={class:`flex items-center gap-4 text-sm text-muted-foreground`},_e={class:`flex items-center gap-1`},ve={class:`flex items-center gap-1`},ye={class:`font-medium`},be={class:`text-xs text-muted-foreground font-mono`},xe={class:`font-medium text-primary`},Se={class:`flex flex-col items-center justify-center py-12 text-muted-foreground`},Ce={class:`w-16 h-16 rounded-full bg-muted flex items-center justify-center mb-4`},z=n({__name:`Products`,setup(n){let{data:z,loading:we,searchQuery:B,filters:V,currentPage:Te,pageSize:Ee,total:De,statistics:H,fetchData:U,goToPage:Oe,setPageSize:ke,addData:Ae,updateData:je,removeData:Me,batchRemoveData:Ne}=de({apiCall:async e=>await o.getProducts(e)||{list:[],total:0,page:1,pageSize:10},apiCallParams:e=>({page:e.page,pageSize:e.pageSize,search:e.searchQuery,category:e.filters.category,status:e.filters.status}),statisticsFn:e=>({total:e.length,active:e.filter(e=>e.status===_.ACTIVE).length,lowStock:e.filter(e=>e.status===_.LOW_STOCK).length,outOfStock:e.filter(e=>e.status===_.OUT_OF_STOCK).length,totalSales:e.reduce((e,t)=>e+(t.sales||0),0),totalStock:e.reduce((e,t)=>e+(t.stock||0),0)})}),{mutate:Pe,loading:Fe}=O({mutationFn:e=>{let t=Number(e.stock);return o.createProduct({name:e.name,category:e.category,price:Number(e.price),stock:t,status:t===0?_.OUT_OF_STOCK:t<10?_.LOW_STOCK:_.ACTIVE,sales:0,description:e.description})},onSuccess:()=>{q.value=!1,X.value={name:``,category:``,price:0,stock:0,description:``},U()}}),{mutate:Ie,loading:Le}=O({mutationFn:({id:e,values:t})=>o.updateProduct(e,{name:t.name,category:t.category,price:Number(t.price),stock:Number(t.stock),description:t.description}),onSuccess:()=>{J.value=!1,Y.value=null,U()}}),{mutate:Re}=O({mutationFn:e=>o.deleteProduct(e),onSuccess:()=>U()}),{mutate:ze}=O({mutationFn:e=>o.batchDeleteProducts(e),onSuccess:()=>{G.value?.clearSelection(),U()}}),Be=l(()=>{let e=H.value||{};return[{title:`总商品`,value:e.total||0,icon:C,color:`text-blue-500`,bgColor:`bg-blue-50`},{title:`在售`,value:e.active||0,icon:ee,color:`text-green-500`,bgColor:`bg-green-50`},{title:`库存不足`,value:e.lowStock||0,icon:ie,color:`text-yellow-500`,bgColor:`bg-yellow-50`},{title:`缺货`,value:e.outOfStock||0,icon:re,color:`text-red-500`,bgColor:`bg-red-50`}]}),W=p({keyword:``,category:``,status:``}),Ve={layout:`inline`,fields:[{name:`keyword`,type:`input`,label:``,placeholder:`搜索商品名称、SKU...`,className:`w-[200px]`},{name:`category`,type:`select`,label:``,placeholder:`全部分类`,options:[{label:`全部分类`,value:``},{label:`电子产品`,value:`电子产品`},{label:`配件`,value:`配件`},{label:`音频设备`,value:`音频设备`}],className:`w-[140px]`},{name:`status`,type:`select`,label:``,placeholder:`全部状态`,options:[{label:`全部状态`,value:``},{label:i.PRODUCT.ACTIVE.text,value:i.PRODUCT.ACTIVE.value},{label:i.PRODUCT.LOW_STOCK.text,value:i.PRODUCT.LOW_STOCK.value},{label:i.PRODUCT.OUT_OF_STOCK.text,value:i.PRODUCT.OUT_OF_STOCK.value}],className:`w-[140px]`}],searchConfig:{enabled:!0,collapsed:!1,collapseThreshold:3,showCollapseButton:!1,searchText:`搜索`,resetText:`重置`,showReset:!0,onSearch:e=>{B.value=e.keyword||``,V.value={category:e.category,status:e.status}},onReset:()=>{B.value=``,V.value={}}}},G=p(),He=l(()=>({columns:[{title:`商品信息`,dataIndex:`name`,width:250,slot:`product`},{title:`分类`,dataIndex:`category`,width:120,filters:[{text:`电子产品`,value:`电子产品`},{text:`配件`,value:`配件`},{text:`音频设备`,value:`音频设备`}]},{title:`价格`,dataIndex:`price`,width:100,slot:`price`,sorter:!0},{title:`库存`,dataIndex:`stock`,width:100,slot:`stock`,sorter:!0},{title:`销量`,dataIndex:`sales`,width:100,sorter:!0},{title:`状态`,dataIndex:`status`,width:120,slot:`status`,filters:[{text:i.PRODUCT.ACTIVE.text,value:i.PRODUCT.ACTIVE.value},{text:i.PRODUCT.LOW_STOCK.text,value:i.PRODUCT.LOW_STOCK.value},{text:i.PRODUCT.OUT_OF_STOCK.text,value:i.PRODUCT.OUT_OF_STOCK.value}]}],pagination:{pageSize:10,show:!0,showSizeChanger:!0,showQuickJumper:!0},rowSelection:{type:`checkbox`,show:!0},actions:[{text:`编辑`,type:`primary`,onClick:e=>Ge(e)},{text:`删除`,type:`danger`,confirm:!0,confirmText:`确定要删除该商品吗？此操作不可恢复。`,onClick:e=>Je(e.id)}],actionWidth:150,actionFixed:`right`})),K=l(()=>z.value.map(e=>({...e,key:e.id}))),q=p(!1),J=p(!1),Y=p(null),X=p({name:``,category:``,price:0,stock:0,description:``}),Z=p({id:``,name:``,category:``,price:0,stock:0,description:``}),Q={layout:`horizontal`,labelCol:{span:6},wrapperCol:{span:18},fields:[{name:`name`,type:`input`,label:`商品名称`,placeholder:`请输入商品名称`,rules:[{required:!0,message:`商品名称不能为空`},{min:2,message:`商品名称至少2个字符`}]},{name:`category`,type:`select`,label:`分类`,placeholder:`请选择分类`,options:[{label:`电子产品`,value:`电子产品`},{label:`配件`,value:`配件`},{label:`音频设备`,value:`音频设备`}],rules:[{required:!0,message:`请选择分类`}]},{name:`price`,type:`number`,label:`价格`,placeholder:`请输入价格`,rules:[{required:!0,message:`价格不能为空`},{type:`number`,min:0,message:`价格不能为负数`}]},{name:`stock`,type:`number`,label:`库存`,placeholder:`请输入库存数量`,rules:[{required:!0,message:`库存不能为空`},{type:`number`,min:0,message:`库存不能为负数`}]},{name:`description`,type:`textarea`,label:`商品描述`,placeholder:`请输入商品描述（可选）`}]},Ue={...Q,actions:{showSubmit:!0,showReset:!0,submitText:`添加商品`,resetText:`取消`,align:`right`,onReset:()=>{q.value=!1}}},We={...Q,actions:{showSubmit:!0,showReset:!0,submitText:`保存修改`,resetText:`取消`,align:`right`,onReset:()=>{J.value=!1}}};function Ge(e){Y.value=e,Z.value={id:e.id,name:e.name,category:e.category,price:e.price,stock:e.stock,description:e.description||``},J.value=!0}function Ke(e){Pe(e)}function qe(e){Y.value&&Ie({id:Y.value.id,values:e})}function Je(e){Re(e)}let $=p([]),Ye=p([]);function Xe(e,t){$.value=e,Ye.value=t}function Ze(){if($.value.length===0){alert(`请先选择要删除的商品`);return}confirm(`确定要删除选中的 ${$.value.length} 个商品吗？`)&&ze($.value.map(String))}function Qe(e){e.current!==void 0&&Oe(e.current),e.pageSize!==void 0&&ke(e.pageSize)}return(ee,n)=>(c(),x(`div`,fe,[v(`div`,pe,[n[9]||=v(`div`,null,[v(`h1`,{class:`text-3xl font-bold tracking-tight`},`商品管理`),v(`p`,{class:`text-muted-foreground mt-1.5 text-sm`},`管理商品库存和价格`)],-1),s(y(e),{class:`gap-2`,onClick:n[0]||=e=>q.value=!0},{default:h(()=>[s(y(a),{class:`h-4 w-4`}),n[8]||=b(` 添加商品 `,-1)]),_:1})]),s(y(D),{open:y(q),"onUpdate:open":n[2]||=e=>d(q)?q.value=e:null,title:`添加新商品`,width:`560`,footer:null},{default:h(()=>[s(y(E),{modelValue:y(X),"onUpdate:modelValue":n[1]||=e=>d(X)?X.value=e:null,schema:Ue,onSubmit:Ke},null,8,[`modelValue`])]),_:1},8,[`open`]),s(y(D),{open:y(J),"onUpdate:open":n[4]||=e=>d(J)?J.value=e:null,title:`编辑商品`,width:`560`,footer:null},{default:h(()=>[y(Y)?(c(),S(y(E),{key:0,modelValue:y(Z),"onUpdate:modelValue":n[3]||=e=>d(Z)?Z.value=e:null,schema:We,onSubmit:qe},null,8,[`modelValue`])):u(``,!0)]),_:1},8,[`open`]),v(`div`,me,[(c(!0),x(f,null,te(y(Be),e=>(c(),x(`div`,{key:e.title,class:`flex items-center gap-3 px-4 py-2.5 bg-muted/50 rounded-lg hover:bg-muted/70 transition-colors`},[(c(),S(ne(e.icon),{class:r([`h-4 w-4`,e.color])},null,8,[`class`])),v(`div`,k,[v(`span`,A,m(e.value),1),v(`span`,j,m(e.title),1)])]))),128))]),v(`div`,he,[v(`div`,M,[v(`div`,N,[s(y(E),{modelValue:y(W),"onUpdate:modelValue":n[5]||=e=>d(W)?W.value=e:null,schema:Ve},null,8,[`modelValue`])]),y($).length>0?(c(),x(`div`,P,[v(`span`,F,`已选 `+m(y($).length)+` 项`,1),s(y(e),{variant:`outline`,size:`sm`,class:`h-8 text-xs text-destructive hover:text-destructive`,onClick:Ze},{default:h(()=>[...n[10]||=[b(` 批量删除 `,-1)]]),_:1})])):u(``,!0)])]),s(y(oe),{class:`border-0 shadow-sm`},{default:h(()=>[s(y(ce),{class:`pb-4`},{default:h(()=>[v(`div`,I,[v(`div`,L,[s(y(le),{class:`text-base font-semibold`},{default:h(()=>[...n[11]||=[b(`商品列表`,-1)]]),_:1}),v(`span`,R,` 共 `+m(y(K).length)+` 件 `,1)]),v(`div`,ge,[v(`div`,_e,[s(y(g),{class:`h-4 w-4`}),v(`span`,null,`总销量: `+m(y(H).value?.totalSales||0),1)]),v(`div`,ve,[s(y(t),{class:`h-4 w-4`}),v(`span`,null,`总库存: `+m(y(H).value?.totalStock||0),1)])])])]),_:1}),s(y(se),{class:`pt-0`},{default:h(()=>[s(y(T),{ref_key:`tableRef`,ref:G,data:y(K),"onUpdate:data":n[7]||=e=>d(K)?K.value=e:null,schema:y(He),onSelectChange:Xe,onChange:Qe},{product:h(e=>[s(y(w),null,{default:h(()=>[s(y(ue),{style:{backgroundColor:`#f0f0f0`,color:`#666`},shape:`square`,size:40},{default:h(()=>[s(y(C),{class:`h-5 w-5`})]),_:1}),s(y(w),{direction:`vertical`,size:`small`},{default:h(()=>[v(`span`,ye,m(e.record.name),1),v(`span`,be,m(e.record.sku),1)]),_:2},1024)]),_:2},1024)]),price:h(e=>[v(`span`,xe,`¥`+m(Number(e.text).toFixed(2)),1)]),stock:h(e=>[s(y(w),null,{default:h(()=>[v(`span`,{class:r([`font-medium`,e.record.stock===0?`text-red-500`:e.record.stock<10?`text-yellow-500`:`text-green-500`])},m(e.text),3),e.record.stock<10?(c(),S(y(g),{key:0,class:`h-4 w-4 text-red-500`})):u(``,!0)]),_:2},1024)]),status:h(e=>[s(y(ae),{class:r({"bg-green-500/10 text-green-500 border-green-500/20":e.text===y(_).ACTIVE,"bg-yellow-500/10 text-yellow-500 border-yellow-500/20":e.text===y(_).LOW_STOCK,"bg-red-500/10 text-red-500 border-red-500/20":e.text===y(_).OUT_OF_STOCK}),variant:`outline`},{default:h(()=>[b(m(y(i).PRODUCT[e.text]?.text||e.text),1)]),_:2},1032,[`class`])]),emptyText:h(()=>[v(`div`,Se,[v(`div`,Ce,[s(y(C),{class:`w-8 h-8 text-muted-foreground/50`})]),n[13]||=v(`p`,{class:`text-base font-medium mb-1`},`暂无商品数据`,-1),n[14]||=v(`p`,{class:`text-sm text-muted-foreground mb-4`},`开始添加您的第一个商品吧`,-1),s(y(e),{size:`sm`,onClick:n[6]||=e=>q.value=!0},{default:h(()=>[s(y(a),{class:`h-4 w-4 mr-1`}),n[12]||=b(` 添加商品 `,-1)]),_:1})])]),_:1},8,[`data`,`schema`])]),_:1})]),_:1})]))}});export{z as default};