import{$r as e,Ar as t,Br as n,Cr as r,Dr as i,Er as a,Fr as o,Gr as s,Hr as c,Ii as l,Ir as u,Jr as d,Kn as f,Kr as p,Ln as m,Lr as h,Mr as g,Nr as _,Or as v,Pa as y,Pr as b,Qr as x,Rr as S,Sr as C,Tr as w,Ur as T,Vr as E,Wr as D,Xr as ee,Yr as O,Zr as k,_i as A,ai as j,ba as M,ci as N,cr as P,di as te,ei as F,fi as I,gi as L,hi as ne,ii as R,jr as re,kr as z,li as ie,mi as ae,ni as B,oi as oe,pi as se,qr as V,ri as ce,rr as H,si as le,ti as U,ui as ue,vi as de,wr as fe,yi as pe,zr as W}from"./index-DX59uxwP.js";var me=(e,t)=>{let n=null;return function(...r){let i=e.bind(this,...r),a=ee(t)?t:t(...r);n&&_(n),a>0?n=se(i,a):i()}},he=(e,t)=>{let n={};for(let r in e)n[r]=t(e[r],r,e);return n},G;(function(e){e[e.USE_REQUEST=1]=`USE_REQUEST`,e[e.USE_WATCHER=2]=`USE_WATCHER`,e[e.USE_FETCHER=3]=`USE_FETCHER`})(G||={});function ge(e,r={trackedKeys:{},bindError:!1,initialRequest:!1,...p()}){let i=t=>e.ref?e.ref(t):{current:t};r=i(r).current;let o=t=>(e.export||a)(t,r),c=t=>{if(!O(e.memorize))return t;let n=e.memorize(t);return n.memorized=!0,n},{dehydrate:l}=e,u=(t,n,i)=>t!==l(n,i,r)&&r.trackedKeys[i]&&e.update(t,n,i,r),d=e=>F(e,e=>V(e,v)?e.e:e),f=[],m={};return{create:(t,n)=>(I(f,n),U(z,e.create(t,n,r),n,e=>l(e,n,r),o,(e,t)=>u(t,e,n))),computed:(t,i,a)=>(n(i,e=>{e.k&&(m[e.k]=!0)}),U(v,e.computed(t,d(i),a,r),a,e=>l(e,a,r),o)),effectRequest:t=>e.effectRequest(t,r),ref:i,watch:(t,n)=>e.watch(d(t),n,r),onMounted:t=>e.onMounted(t,r),onUnmounted:t=>e.onUnmounted(t,r),memorize:c,__referingObj:r,exposeProvider:e=>{let i={},a={},o=[];for(let n in e){let l=e[n];if(O(l)&&!r.trackedKeys[n])i[n]=n.startsWith(`on`)?(...e)=>(l(...e),g):l.memorized?l:c(l);else{!s([`uploading`,`downloading`],n)&&!n.startsWith(`__`)&&I(o,n);let e=V(l,v);e&&(a[n]=l.s),t.defineProperty(i,n,{get:()=>(r.trackedKeys[n]=!0,e?l.e:l),set:B,enumerable:!0,configurable:!0})}}let{update:l,__proxyState:d}=i;r.trackedKeys={...m},r.bindError=!1;let{then:p}=i,g=R(i,{__referingObj:r,update:c(e=>{j(e).forEach(t=>{s(f,t)?u(e[t],a[t],t):t in i&&O(l)&&l({[t]:e[t]})})}),__proxyState:c(t=>s(f,t)&&V(e[t],v)?(r.trackedKeys[t]=!0,e[t]):d(t)),then(e,t){n(o,e=>{r.trackedKeys[e]=!0});let i=()=>{h(g,`then`),e(g)};O(p)?p(i,t):i()}});return g},objectify:(e,t)=>e.reduce((e,n)=>(e[n.k]=t?n[t]:n,e),{}),transformState2Proxy:(e,t)=>U(z,e,t,e=>l(e,t,r),o,(e,n)=>u(n,e,t))}}b(``);var _e=b(`useRequest`),ve=b(`useWatcher`),ye=b(`useFetcher`),be=e=>({[G.USE_REQUEST]:_e,[G.USE_WATCHER]:ve,[G.USE_FETCHER]:ye})[e],xe=(e,t)=>e(V(t,C),`expected a method instance.`),K=`success`,q=`error`,J=`complete`,Se=(e,t,n,r)=>({m:void 0,rf:{},fs:{},em:n,ht:e,c:t,ro:r,ms:{}}),Y=class e{constructor(e,t){this.method=e,this.args=t}clone(){return{...this}}static spawn(t,n){return U(e,t,n)}},Ce=class extends Y{constructor(e,t,n){super(e.method,e.args),this.data=t,this.fromCache=n}},we=class extends Y{constructor(e,t){super(e.method,e.args),this.error=t}},Te=class extends Y{constructor(e,t,n,r,i){super(e.method,e.args),this.status=t,this.data=n,this.fromCache=t===`error`?!1:r,this.error=i}},Ee=(e,t)=>t(),De={},Oe=(e,t)=>{let n=De[e]||{};return n[t]?Array.from(n[t]):[]},ke=(e,t,n)=>{let r=De[e]=De[e]||{};r[t]||(r[t]=U(Set)),r[t].add(n)},Ae=(e,t,n)=>{let r=De[e],i=r[t];r&&i&&(n?i.delete(n):i.clear(),i.size===0&&h(r,t))};function je(e,t,r=[]){let i=be(e.ht),a=c(t,i,r),{fs:o,ht:s,c:l}=e,{loading:u,data:d,error:f}=o,p=s===G.USE_FETCHER,{force:m=!1,middleware:h=Ee}=l,{id:g}=E(a),_=T(a),{abortLast:v=!0}=l,y=!e.m;return e.m=a,(async()=>{let c=B,b=!1,x=ue(void 0),S=B,C=B,T=await w(a),E=()=>!!T,D=!1;p||(ke(g,_,e),c=()=>Ae(g,_,e));let ee=t=>{b=!0;let{force:n=m,method:i=a}=t||{},s=ae(n,[U(Y,a,r)]),l=e=>({loaded:t,total:n})=>{o[e].v={loaded:t,total:n}};a=i,e.rf[_]=c,D||(u.v=!!s||!T);let{downloading:d,uploading:f}=e.ro.trackedKeys;return S=d?a.onDownload(l(`downloading`)):S,C=f?a.onUpload(l(`uploading`)):C,x=a.send(s),E=()=>a.fromCache||!1,x},O={method:a,cachedResponse:T,config:l,abort:()=>a.abort()},k=()=>s!==G.USE_WATCHER||!v||e.m===a,A=(e=!0)=>{e&&y&&(u.v=!1),D=e},j=h(p?{...O,args:r,fetch:(t,...n)=>(xe(i,t),je(e,t,n)),proxyStates:le(o,`data`),controlLoading:A}:{...O,args:r,send:(...n)=>je(e,t,n),proxyStates:o,controlLoading:A},ee),M,N=Y.spawn(a,r);try{let t=await j,r=t=>(p?e.c.updateState!==!1&&n(Oe(g,_),e=>{e.fs.data.v=t}):k()&&(d.v=t),k()&&(f.v=void 0,!D&&(u.v=!1),e.em.emit(K,U(Ce,N,t,E())),e.em.emit(J,U(Te,N,K,t,E(),void 0))),t);M=t===void 0?b?await te(x,r,()=>r(void 0)):void 0:r(t),!b&&!D&&(u.v=!1)}catch(t){throw k()&&(f.v=t,!D&&(u.v=!1),e.em.emit(q,U(we,N,t)),e.em.emit(J,U(Te,N,q,void 0,E(),t))),t}return S(),C(),M})()}var X=e=>e.current;function Me(e,t,i,a,s=!1,l,f=0){i={...i};let p=!!s,m;if(s)try{let n=c(t,be(e)),r=E(n),a=r.l1Cache.get(g(r.id,T(n)));if(a&&!V(a,re)){let[e,t]=a;(!t||t>D())&&(m=e)}p=!!ae(i.force??!1)||!m}catch{}let{create:h,effectRequest:_,ref:v,objectify:y,exposeProvider:b,transformState2Proxy:x,__referingObj:S}=ge(fe(),i.__referingObj),C={total:0,loaded:0},{managedStates:w={}}=i,k=he(w,(e,t)=>x(e,t)),A=h(m??(O(a)?a():a),`data`),j=h(p,`loading`),M=h(void 0,`error`),N=h({...C},`downloading`),P=h({...C},`uploading`),F=y([A,j,M,N,P]),I=o(),L=X(v(Se(e,i,I,S)));L.fs=F,L.em=I,L.c=i,L.ms={...F,...k};let ne=l!==void 0,R=(e=t,n)=>je(L,e,n),z=v(void 0),ie=v(!1),B=X(v(u())),ce=(e=S,t)=>{B(()=>{(!r.ssr||X(z))&&(S.initialRequest=ie.current=!0,te(R(t),()=>{var e;(e=X(z))==null||e.resolve()},t=>{var n;if(!e.bindError&&!e.trackedKeys.error&&!X(z))throw t;(n=X(z))==null||n.reject(t)}))})},H=v(me((e,t,n)=>ce(t,n),e=>ee(e)?d(f)?f[e]:f:0));_({handler:ne?e=>H.current(e,S,t):()=>ce(S),removeStates:()=>{n(oe(L.rf),e=>e())},frontStates:{...F,...k},watchingStates:l,immediate:s??!0});let le=b({...y([A,j,M,N,P]),abort:()=>L.m&&L.m.abort(),send:(e,t)=>R(t,e),onSuccess(e){I.on(K,e)},onError(e){S.bindError=!0,I.on(q,e)},onComplete(e){I.on(J,e)},then(e,t){let{promise:n,resolve:r,reject:i}=de();z.current={resolve:r,reject:i},se(()=>{!ie.current&&r()},10),te(n,()=>{e(le)},t)}});return le}function Ne(e={}){let t=Me(G.USE_FETCHER,B,e),{send:n}=t;return h(t,`send`),R(t,{fetch:(e,...t)=>(xe(ye,e),n(t,e))})}function Pe(e,t={}){let{immediate:n=!0,initialData:r}=t,i=Me(G.USE_REQUEST,e,t,r,!!n),{send:a}=i;return R(i,{send:(...e)=>a(e)})}b(`usePagination`);var Fe=`valueOf`,Ie;o(),b(`useSQRequest`);var Le=Symbol(`vdid`),Re=e=>{let t=e?.[Le];t&&Ie&&(Ie[t]=void 0)},ze=(e,t=!0)=>{Re(e);let n=e?.[Le];return(n?`[vd:${n}]`:void 0)||(t?e:void 0)};function Be(){return ze(this)}var Ve=function(){};Ve.prototype=t.create(null,{[Fe]:pe(Be)});var He=function(){};He.prototype=t.create(null,{[Fe]:pe(Be)});var Z=class{constructor(e,t={}){this.cancelBubble=!1,this.currentTarget=null,this.defaultPrevented=!1,this.eventPhase=0,this.isTrusted=!1,this.returnValue=!0,this.srcElement=null,this.target=null,this.NONE=0,this.CAPTURING_PHASE=1,this.AT_TARGET=2,this.BUBBLING_PHASE=3,this.type=e,this.bubbles=t.bubbles??!1,this.cancelable=t.cancelable??!1,this.composed=t.composed??!1,this.timeStamp=Date.now()}preventDefault(){this.cancelable&&(this.defaultPrevented=!0)}stopImmediatePropagation(){}stopPropagation(){this.cancelBubble=!0}composedPath(){return[]}initEvent(e,t,n){}};Z.NONE=0,Z.CAPTURING_PHASE=1,Z.AT_TARGET=2,Z.BUBBLING_PHASE=3;var Ue=typeof Event<`u`?Event:Z,We=class extends Ue{constructor(e,t){super(e,{bubbles:!0,cancelable:!0,composed:!0}),this.data=t.data,this.lastEventId=t.lastEventId,this.origin=t.origin||``,this.error=t.error}},Ge=b(`EventSourceFetch`),Ke=class e{constructor(t,n,r={}){this.CONNECTING=0,this.OPEN=1,this.CLOSED=2,this.onopen=null,this.onmessage=null,this.onerror=null,this._listeners={},this._reconnectTime=null,this._controller=null,this._lastEventId=``,this._origin=``,this.url=t,this.readyState=e.CONNECTING,this._options={...r},this._reconnectTime=n,this._origin=U(URL,t,window.location.href).origin,t&&se(()=>this._connect())}addEventListener(e,t){this._listeners[e]=this._listeners[e]||[],this._listeners[e].find(e=>e===t||k(e)&&k(t)&&e?.handleEvent===t.handleEvent)||this._listeners[e].push(t)}removeEventListener(e,t){!t||!this._listeners[e]||(this._listeners[e]=W(this._listeners[e],e=>e!==t&&!(typeof e==`object`&&typeof t==`object`&&e?.handleEvent===t.handleEvent)))}dispatchEvent(e){if(!(e instanceof We))return!0;let t=this._listeners[e.type]||[];for(let n of t)O(n)?n(e):n&&O(n.handleEvent)&&n.handleEvent(e);let n=`on${e.type}`,r=this[n];return O(r)&&r(e),!e.defaultPrevented}close(){this.readyState!==e.CLOSED&&(this.readyState=e.CLOSED,this._dispatchEvent(`close`,``),this._controller&&=(this._controller.abort(),null))}_connect(){if(this.readyState===e.CLOSED)return;this._controller=U(AbortController);let t=this._options,n=t.headers||{},r=[`Accept`,`text/event-stream`],i=`Last-Event-ID`,a=this._lastEventId;if(d(n))I(n,r),a&&I(n,[i,a]);else if(V(n,Headers))n.append(r[0],r[1]),a&&n.append(i,a);else if(k(n)){let[e,t]=r;n[e]=t,a&&(n[i]=a)}let o={...t,headers:n,signal:this._controller.signal};fetch(this.url,o).then(t=>{Ge(t.ok,`HTTP error: ${t.status}`),Ge(t.body,`ReadableStream not supported`),this._origin=U(URL,t.url).origin,this.readyState=e.OPEN,this._dispatchEvent(`open`,``);let n=t.body.getReader(),r=new TextDecoder,i=``,a=({done:t,value:o})=>{if(t)return this.readyState!==e.CLOSED&&this._reconnect(),ue();i+=r.decode(o,{stream:!0});let s=i.split(/\r\n|\r|\n/);return i=s.pop()||``,this._processEventStream(s),n.read().then(a).catch(t=>(t.name!==`AbortError`&&this.readyState!==e.CLOSED&&this._onError(t),ue()))};return n.read().then(a).catch(t=>{t.name!==`AbortError`&&this.readyState!==e.CLOSED&&this._onError(t)})}).catch(t=>{t.name!==`AbortError`&&this.readyState!==e.CLOSED&&this._onError(t)})}_processEventStream(e){let t=`message`,n=``,r=null,a=null,o=()=>{if(n){if(n.endsWith(`
`)&&(n=n.substring(0,n.length-1)),r!==null&&(this._lastEventId=r),a!==null&&this._reconnectTime===null){let e=parseInt(a,10);Number.isNaN(e)||(this._reconnectTime=e)}this._dispatchEvent(t,n)}t=`message`,n=``,r=null,a=null};for(let s of e){if(s===``){o();continue}if(s.startsWith(`:`))continue;let e,c,l=s.indexOf(`:`);switch(l===-1?(e=s,c=``):(e=s.slice(0,l),c=s.slice(l+(s[l+1]===` `?2:1))),e){case`event`:t=c;break;case`data`:n=n?`${n}\n${c}`:c;break;case`id`:if(c.includes(`\0`))continue;r=c;break;case`retry`:a=c;break;default:throw U(i,`EventSource`,`EventSource: Unknown field "${e}", ignoring`)}}}_dispatchEvent(e,t){let n=U(We,e,{type:e,data:t,lastEventId:this._lastEventId,origin:this._origin});this.dispatchEvent(n)}_onError(t){let n=U(We,`error`,{type:`error`,data:``,lastEventId:this._lastEventId,origin:this._origin,error:t});this.dispatchEvent(n),this.readyState!==e.CLOSED&&this._reconnect()}_reconnect(){if(this._reconnectTime!==null&&this._reconnectTime<=0){this.close();return}this.readyState!==e.CLOSED&&(this.readyState=e.CONNECTING,se(()=>this._connect(),this._reconnectTime??1e3))}};Ke.CONNECTING=0,Ke.OPEN=1,Ke.CLOSED=2;var qe;(function(e){e[e.CONNECTING=0]=`CONNECTING`,e[e.OPEN=1]=`OPEN`,e[e.CLOSED=2]=`CLOSED`})(qe||={}),b(`useSSE`);var Je;(function(e){e.Open=`open`,e.Error=`error`,e.Message=`message`,e.Close=`close`})(Je||={});var Q=b(`useUploader`);function Ye(t,{limit:r=0,localLink:i,replaceSrc:a,mode:c}={}){let{create:l,computed:u,exposeProvider:f,ref:p}=ge(fe()),m=o(),h=l([],`fileList`),g=u(()=>h.v[0],[h],`file`),_=l(!1,`uploading`),v=l(0,`successCount`),y=l(0,`failCount`),b=u(()=>({...h.v.reduce((e,{progress:t,status:n})=>(n!==0&&(e.total+=t.total,e.uploaded+=t.uploaded),e),{uploaded:0,total:0})}),[h],`progress`),x=u(()=>h.v.find(e=>e.error)?.error,[h],`error`),S=async(t={},n={})=>{let a=t,o=n;!t.file&&!d(t)&&(o=t,a=[]);let s=d(a)?a:[a];e(s)<=0&&(s=await Ye.selectFile(o)),Q(r<=0||e(h.v)+e(s)<=r,`The number of files exceeds the limit of ${r}`);let{converters:c}=Ye,l=await re.all(F(s,async e=>{let t=c.find(({is:t})=>t(e));Q(t,`Invalid file type, only ${F(c,({name:e})=>e).join(`, `)} are supported, if other file needs, customize convert function with \`useUploader.convertFile.push({ is: ..., convert: ... })\``);let n=await t.convert(e);return Q(n,`Failed to convert file`),{src:e.src||(i?URL.createObjectURL(n):void 0),file:n,status:0,progress:{uploaded:0,total:n.size}}})),u=o.start??e(h.v),f=W(l,Boolean),p=[...h.v];return ne(p,u,0,...f),h.v=p,e(l)},C=(t,n=[1,2],r=`upload`)=>{let i={upload:`uploaded`,abort:`aborted`}[r],a=h.v;return e(t)>0?F(t,(t,r)=>{let o=ee(t),c=o?a[t]:t,l=o?`index ${t}`:`position ${r}`;return Q(c,`The file of ${l} does not exist`),e(n)>0&&Q(!s(n,c.status)&&k(c.file),`The file of ${l} cannot be ${i}, which status is ${c.status}`),c}):W(a,e=>!s(n,e.status))},w=(t,n)=>W(t,t=>e(n)>0?s(n,t.status):!0),T=p([]),E=(e,t)=>{h.v.findIndex(t=>t.file===e)>-1&&I(T.current,{f:e,m:t})},D=e=>{T.current=W(T.current,({m:t})=>t!==e)},O=(...t)=>{let r=C(t,[0,2,3],`abort`),i=[];e(r)>0?n(r,({file:e})=>{let t=T.current.find(({f:t})=>t===e);t&&I(i,t.m)}):I(i,...F(T.current,({m:e})=>e));let a=[];return n(i,e=>{a.includes(e)||I(a,e)}),N(F(a,e=>e.abort()))},A=(...t)=>{let n=C(t,[]);e(n)>0?(O(...w(n,[1])),h.v=W(h.v,e=>!s(n,e)),v.v=e(w(h.v,[2])),y.v=e(w(h.v,[3]))):(O(...w(h.v,[1])),h.v=[])},j=(e,t,n)=>{let r=Y.spawn(e,[]);return{successEvent:U(Ce,r,t,!1),errorEvent:U(we,r,n),completeEvent:U(Te,r,n?q:K,t,!1,n)}},M=(e,t,n,r,i=0)=>{if(e.status=t,t===2){if(e.progress.uploaded=e.progress.total,a){let t=a(n,i);t&&(e.src=t)}}else t===3&&(e.error=r);h.v=[...h.v]},P=(r,i)=>{let a=t(i);return a.onUpload(e=>{n(r,t=>{t.progress.uploaded=e.loaded*(t.progress.total/e.total)})}),n(r,({file:e})=>E(e,a)),a.then(t=>{n(r,(e,n)=>M(e,2,t,void 0,n)),v.v=e(w(h.v,[2]));let{successEvent:i,completeEvent:o}=j(a,t);return m.emit(K,i),m.emit(J,o),t},t=>{n(r,e=>M(e,3,void 0,t)),y.v=e(w(h.v,[3]));let{errorEvent:i,completeEvent:o}=j(a,void 0,t);return m.emit(q,i),m.emit(J,o),t}).finally(()=>{_.v=!1,D(a)})},te=e=>{let r=F(e,(r,i)=>{let a=t({file:r.file,name:r.file.name});return a.onUpload(({loaded:t,total:r})=>{n(e,e=>{e.progress.uploaded=t,e.progress.total=r})}),E(r.file,a),a.then(e=>{M(r,2,e,void 0,i),v.v+=1;let{successEvent:t,completeEvent:n}=j(a,e);return m.emit(K,t),m.emit(J,n),e},e=>{M(r,3,void 0,e),y.v+=1;let{errorEvent:t,completeEvent:n}=j(a,void 0,e);return m.emit(q,t),m.emit(J,n),e}).finally(()=>{D(a)})});return ie(re.all(r),()=>{_.v=!1})};return f({fileList:h,uploading:_,file:g,progress:b,successCount:v,failCount:y,error:x,appendFiles:S,removeFiles:A,upload:async(...e)=>{let t=C(e);n(t,e=>{e.status=1});let r=F(t,({file:e})=>({file:e,name:e.name}));return _.v=!0,c===`batch`?P(t,r):te(t)},abort:O,onSuccess:e=>{m.on(K,e)},onError:e=>{m.on(q,e)},onComplete:e=>{m.on(J,e)}})}Ye.selectFile=({multiple:e,accept:t}={})=>{let n=document.createElement(`input`);return n.type=`file`,n.multiple=!!e,t&&(n.accept=t),n.click(),U(Promise,e=>{n.addEventListener(`change`,()=>{e(F(Array.from(n.files||[]),e=>({file:e,name:e.name,mimeType:e.type})))})})};var Xe=`text/plain`;Ye.converters=[{name:`HTMLCanvasElement`,is:({file:e})=>V(e,HTMLCanvasElement),async convert({file:e,mimeType:t,name:n}){let r=await U(re,t=>e?.toBlob(t));if(r)return U(File,[r],n||`image.png`,{type:t||r.type})}},{name:`base64`,is:({file:e})=>x(e),convert({file:t=``,mimeType:r,name:i}){Q(/data:.+;base64,/.test(t),`Invalid base64 string`);let a=t.split(`,`),o=a[0].match(/:(.*?);/)?.[1],s=atob(a[1]),c=new Uint8Array(e(s));return n(Array.from(s),(e,t)=>{c[t]=e.charCodeAt(0)}),U(File,[c],i||`file`,{type:r||o||Xe})}},{name:`File`,is:({file:e})=>V(e,File),convert({file:e}){return e}},{name:`Blob`,is:({file:e})=>V(e,Blob),convert({file:e,name:t,mimeType:n}){return U(File,[e],t||`file`,{type:n||e.type||Xe})}},{name:`ArrayBuffer`,is:({file:e})=>V(e,ArrayBuffer),convert({file:e,name:t,mimeType:n}){return U(File,[U(Blob,[e])],t||`file`,{type:n||Xe})}}];var $=(e,t={})=>{let n=!0,{enableFocus:i=!0,enableVisibility:a=!0,enableNetwork:o=!0,pollingTime:s=0,throttle:c=1e3}=t,{onMounted:l,onUnmounted:u,__referingObj:d}=ge(fe()),f=Pe(e,{...t,__referingObj:d}),p=()=>{n&&(f.send(),c>0&&(n=!1,setTimeout(()=>{n=!0},c)))},m=B,h=B,g=B,_=B;return l(()=>{r.ssr||(m=o?$.onNetwork(p,t):m,h=i?$.onFocus(p,t):h,g=a?$.onVisibility(p,t):g,_=s>0?$.onPolling(p,t):_)}),u(()=>{m(),h(),g(),_()}),f},Ze=(e,t)=>(window.addEventListener(e,t),()=>window.removeEventListener(e,t));$.onNetwork=e=>Ze(`online`,e),$.onFocus=e=>Ze(`focus`,e),$.onVisibility=e=>Ze(`visibilitychange`,()=>document.visibilityState===`visible`&&e()),$.onPolling=(e,t)=>{let n=setInterval(e,t.pollingTime);return()=>clearInterval(n)},b(`useCaptcha`),o(),b(`useRetriableRequest`),b(`subscriber`);function Qe(e){let{mutationFn:t,onSuccess:n,onError:r,onComplete:i,successMessage:a=`操作成功`}=e,{loading:o,send:s,abort:c}=Ne();return{mutate:async e=>{try{let i=await s(t(e));if(i===null){let t=H(Error(`操作失败`));return r?.(t,e),null}return a!==!1&&P.success(a),n?.(i,e),i}catch(t){let n=H(t);return r?.(n,e),null}finally{i?.()}},loading:o,abort:c}}function $e(e){let{apiCall:t,apiCallParams:n,immediate:r=!0,defaultPage:i=1,defaultPageSize:a=10,statisticsFn:o,onSuccess:s,onError:c}=e,u=y([]),d=y(!1),f=y(null),p=y(``),h=y({}),g=y(i),_=y(a),v=y(0),b=async()=>{d.value=!0,f.value=null;let e=n?n({page:g.value,pageSize:_.value,searchQuery:p.value,filters:h.value}):{page:g.value,pageSize:_.value};try{let n=await t(e);if(n===null){f.value=H(Error(`获取数据失败`)),u.value=[],v.value=0;return}u.value=n.list||[],v.value=n.total||0,s?.(n)}catch(e){f.value=H(e),u.value=[],v.value=0,c?.(f.value)}finally{d.value=!1}},x=m(b,300);M([g,_],()=>{b()},{immediate:r}),M([p,h],()=>{x()},{deep:!0});let S=l(()=>Math.ceil(v.value/_.value)),C=l(()=>{let e=u.value;return o?o(e)||{}:{total:v.value}});return{data:u,loading:d,error:f,searchQuery:p,filters:h,filteredData:l(()=>u.value),paginatedData:l(()=>u.value),currentPage:g,pageSize:_,totalPages:S,total:v,statistics:C,fetchData:b,resetFilters:()=>{p.value=``,h.value={},g.value=i},goToPage:e=>{e>=1&&e<=S.value&&(g.value=e)},nextPage:()=>{g.value<S.value&&g.value++},prevPage:()=>{g.value>1&&g.value--},setPageSize:e=>{_.value=e,g.value=1},addData:e=>{u.value=[e,...u.value],v.value+=1},updateData:(e,t)=>{let n=u.value.findIndex(t=>t.id===e);n!==-1&&(u.value[n]={...u.value[n],...t})},removeData:e=>{u.value=u.value.filter(t=>t.id!==e),v.value=Math.max(v.value-1,0)},batchRemoveData:e=>{let t=u.value.filter(t=>e.includes(t.id)).length;u.value=u.value.filter(t=>!e.includes(t.id)),v.value=Math.max(v.value-t,0)}}}var et=y(new Map);l(()=>et.value.size>0),l(()=>et.value.values().next().value?.text||`加载中...`),l(()=>et.value.values().next().value?.type||`default`);function tt(){let e=f(),t=t=>e.hasPermission(t),n=t=>t.length?t.some(t=>e.hasPermission(t)):!0,r=t=>t.length?t.every(t=>e.hasPermission(t)):!0;return{hasPermission:t,hasAnyPermission:n,hasAllPermissions:r,hasRole:t=>e.user?.role===t,hasAnyRole:t=>t.length?t.some(t=>e.user?.role===t):!0,checkPermission:(e,i=`all`)=>Array.isArray(e)?i===`any`?n(e):r(e):t(e),usePermissionRef:e=>l(()=>t(e)),isAdmin:l(()=>e.isAdmin),isAuthenticated:l(()=>e.isAuthenticated)}}export{$e as n,Qe as r,tt as t};