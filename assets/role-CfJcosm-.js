import"./ScrollArea-DFVXjTz0.js";import"./RovingFocusItem-CVjkq2qt.js";import"./Presence-3Lrzvetv.js";import"./defu-DUbmuhNq.js";import"./TabsTrigger-DqwypIQj.js";import{Ai as e,Ca as t,Fi as n,Gi as r,Gt as ee,Hi as i,Ii as a,Ka as o,Li as s,N as c,Na as l,Oa as u,Ri as d,Ua as te,Ui as f,Va as p,Zn as m,ca as ne,dt as re,ea as ie,l as ae,n as h,oa as g,zi as _}from"./index-D6Cod0pL.js";import"./en_US-LGbIKe0x.js";import"./common-HQCQB71w.js";import"./zh_CN-Cgumeokr.js";import"./useFullscreen-lrjpQVTw.js";import"./_plugin-vue_export-helper-Dey4FfNi.js";import{N as oe,V as v,s as y,u as se}from"./dist-D3XftLPo.js";import"./theme-shared-BpTdpb0d.js";import{t as ce}from"./TTable-B13ZnM5N.js";import"./useTableColumns-qs-cYpaB.js";import{n as le,t as b}from"./TForm-Drq7Qn9R.js";import"./TIcon-C-hNhMC1.js";import{t as x}from"./TModal-OyBXzO5K.js";import{n as ue,t as de}from"./CardContent-CMuL0LxG.js";import{n as fe,t as pe}from"./CardTitle-D06OZslX.js";import{n as me,r as S}from"./composables-CTAVZAup.js";import{t as he}from"./business-DYFIcNWr.js";import{t as ge}from"./TDataCard-C7I9agpQ.js";import{t as _e}from"./TStatusBadge-DZzFEG5C.js";import{t as ve}from"./TPageHeader-CTxQMWSB.js";import{t as ye}from"./TEmptyState-B9XitPgC.js";import{t as be}from"./TBatchActions-CX-6FAVm.js";var xe={class:`space-y-6`},Se={class:`flex flex-wrap gap-3`},Ce={class:`bg-muted/40 border border-border/50 rounded-xl px-3 py-3`},we={class:`flex items-center justify-between`},C={class:`flex items-center gap-3`},w={class:`text-xs text-muted-foreground bg-muted px-2 py-0.5 rounded-full`},T={class:`flex items-center gap-2`},E={class:`font-medium`},D={class:`truncate block max-w-[200px]`},O={key:1,class:`text-muted-foreground`},k={key:0,class:`space-y-4`},Te={class:`flex items-center gap-3 p-4 bg-gradient-to-r from-primary/5 to-primary/10 rounded-lg border border-primary/10`},Ee={class:`w-10 h-10 rounded-full bg-primary/10 flex items-center justify-center`},De={class:`flex-1 min-w-0`},Oe={class:`font-medium text-base`},ke={class:`text-sm text-muted-foreground truncate`},Ae={class:`flex items-center justify-between px-1 flex-wrap gap-y-2`},je={class:`flex items-center gap-2`},Me={class:`flex items-center justify-between px-3 py-2 bg-muted/30 rounded-lg`},Ne={class:`flex items-center gap-2`},Pe={class:`border rounded-lg p-4 bg-muted/20`},Fe={class:`flex justify-end gap-2`},A=r({__name:`index`,setup(r){let{data:A,loading:Ie,searchQuery:j,currentPage:Le,pageSize:Re,total:M,fetchData:N,goToPage:ze,setPageSize:Be}=me({apiCall:async e=>await m.getRoles(e)||{list:[],total:0,page:1,pageSize:10},apiCallParams:e=>({page:e.page,pageSize:e.pageSize,search:e.searchQuery})}),{mutate:Ve}=S({mutationFn:e=>m.createRole({name:e.name,code:e.code,description:e.description,permissions:e.permissions||[],status:e.status}),successMessage:`角色创建成功`,onSuccess:()=>{I.value=!1,it(),N()}}),{mutate:He}=S({mutationFn:({id:e,values:t})=>m.updateRole(e,{name:t.name,code:t.code,description:t.description,permissions:t.permissions,status:t.status}),successMessage:`角色更新成功`,onSuccess:()=>{L.value=!1,z.value=null,N()}}),{mutate:Ue}=S({mutationFn:e=>m.deleteRole(e),successMessage:`角色删除成功`,onSuccess:()=>N()}),{mutate:We}=S({mutationFn:e=>m.batchDeleteRoles(e),successMessage:`批量删除成功`,onSuccess:()=>{F.value?.clearSelection(),N()}}),{mutate:Ge}=S({mutationFn:({id:e,permissions:t})=>m.updateRolePermissions(e,t),successMessage:`权限分配成功`,onSuccess:()=>{R.value=!1,B.value=null,N()}}),Ke=l([{id:`dashboard`,name:`仪表盘`,code:`dashboard`,children:[{id:`dashboard:view`,name:`查看仪表盘`,code:`dashboard:view`},{id:`dashboard:export`,name:`导出数据`,code:`dashboard:export`}]},{id:`system`,name:`系统管理`,code:`system`,children:[{id:`system:user`,name:`用户管理`,code:`system:user`,children:[{id:`system:user:view`,name:`查看用户`,code:`system:user:view`},{id:`system:user:create`,name:`创建用户`,code:`system:user:create`},{id:`system:user:update`,name:`编辑用户`,code:`system:user:update`},{id:`system:user:delete`,name:`删除用户`,code:`system:user:delete`}]},{id:`system:organization`,name:`组织架构`,code:`system:organization`,children:[{id:`system:organization:view`,name:`查看部门`,code:`system:organization:view`},{id:`system:organization:create`,name:`创建部门`,code:`system:organization:create`},{id:`system:organization:update`,name:`编辑部门`,code:`system:organization:update`},{id:`system:organization:delete`,name:`删除部门`,code:`system:organization:delete`}]},{id:`system:role`,name:`角色管理`,code:`system:role`,children:[{id:`system:role:view`,name:`查看角色`,code:`system:role:view`},{id:`system:role:create`,name:`创建角色`,code:`system:role:create`},{id:`system:role:update`,name:`编辑角色`,code:`system:role:update`},{id:`system:role:delete`,name:`删除角色`,code:`system:role:delete`},{id:`system:role:permission`,name:`分配权限`,code:`system:role:permission`}]},{id:`system:menu`,name:`菜单管理`,code:`system:menu`,children:[{id:`system:menu:view`,name:`查看菜单`,code:`system:menu:view`},{id:`system:menu:create`,name:`创建菜单`,code:`system:menu:create`},{id:`system:menu:update`,name:`编辑菜单`,code:`system:menu:update`},{id:`system:menu:delete`,name:`删除菜单`,code:`system:menu:delete`}]}]},{id:`products`,name:`商品管理`,code:`products`,children:[{id:`products:view`,name:`查看商品`,code:`products:view`},{id:`products:create`,name:`创建商品`,code:`products:create`},{id:`products:update`,name:`编辑商品`,code:`products:update`},{id:`products:delete`,name:`删除商品`,code:`products:delete`}]},{id:`orders`,name:`订单管理`,code:`orders`,children:[{id:`orders:view`,name:`查看订单`,code:`orders:view`},{id:`orders:create`,name:`创建订单`,code:`orders:create`},{id:`orders:update`,name:`编辑订单`,code:`orders:update`},{id:`orders:delete`,name:`删除订单`,code:`orders:delete`}]}]),P=l({keyword:``}),qe={layout:`inline`,fields:[{name:`keyword`,type:`input`,label:``,placeholder:`搜索角色名称或编码...`,className:`w-[280px]`}],searchConfig:{enabled:!0,collapsed:!1,showCollapseButton:!1,searchText:`搜索`,resetText:`重置`,showReset:!0,onSearch:e=>{j.value=e.keyword||``},onReset:()=>{j.value=``}}},F=l(),Je=n(()=>({columns:[{title:`角色名称`,dataIndex:`name`,width:180,slot:`name`},{title:`角色编码`,dataIndex:`code`,width:150},{title:`用户数`,dataIndex:`userCount`,width:100,align:`center`,slot:`userCount`},{title:`权限数`,dataIndex:`permissions`,width:100,align:`center`,slot:`permissionCount`},{title:`状态`,dataIndex:`status`,width:100,slot:`status`},{title:`描述`,dataIndex:`description`,ellipsis:!0,slot:`description`},{title:`创建时间`,dataIndex:`createdAt`,width:150}],pagination:{pageSize:10,show:!0,showSizeChanger:!0,showQuickJumper:!0,total:M.value},rowSelection:{type:`checkbox`,show:!0},actions:[{text:`权限`,type:`default`,onClick:e=>at(e)},{text:`编辑`,type:`primary`,onClick:e=>Ze(e)},{text:`删除`,type:`danger`,confirm:!0,confirmText:`确定要删除该角色吗？此操作不可恢复。`,onClick:e=>J(e.id)}],actionWidth:260,actionFixed:`right`})),I=l(!1),L=l(!1),R=l(!1),z=l(null),B=l(null),V=l(),H=l(),U=l([]),W=l([`system`]),G=n(()=>{let e=t=>t.map(t=>({key:t.id,title:t.name,children:t.children?e(t.children):void 0}));return e(Ke.value)}),K=l({name:``,code:``,description:``,permissions:[],status:`active`}),q=l({id:``,name:``,code:``,description:``,permissions:[],status:`active`}),Ye={layout:`horizontal`,labelCol:{span:6},wrapperCol:{span:18},fields:[{name:`name`,type:`input`,label:`角色名称`,placeholder:`请输入角色名称`,rules:[{required:!0,message:`角色名称不能为空`},{min:2,message:`角色名称至少2个字符`}]},{name:`code`,type:`input`,label:`角色编码`,placeholder:`请输入角色编码`,rules:[{required:!0,message:`角色编码不能为空`},{pattern:/^[A-Za-z0-9_]+$/,message:`编码只能包含字母、数字和下划线`}]},{name:`status`,type:`select`,label:`状态`,placeholder:`请选择状态`,options:[{label:`启用`,value:`active`},{label:`禁用`,value:`inactive`}],rules:[{required:!0,message:`请选择状态`}]},{name:`description`,type:`textarea`,label:`描述`,placeholder:`请输入角色描述`,rows:3}],actions:{showSubmit:!0,showReset:!0,submitText:`添加角色`,resetText:`取消`,align:`right`,onReset:()=>{I.value=!1}}},Xe={layout:`horizontal`,labelCol:{span:6},wrapperCol:{span:18},fields:[{name:`name`,type:`input`,label:`角色名称`,placeholder:`请输入角色名称`,rules:[{required:!0,message:`角色名称不能为空`},{min:2,message:`角色名称至少2个字符`}]},{name:`code`,type:`input`,label:`角色编码`,placeholder:`请输入角色编码`,disabled:!0,rules:[{required:!0,message:`角色编码不能为空`}]},{name:`status`,type:`select`,label:`状态`,placeholder:`请选择状态`,options:[{label:`启用`,value:`active`},{label:`禁用`,value:`inactive`}],rules:[{required:!0,message:`请选择状态`}]},{name:`description`,type:`textarea`,label:`描述`,placeholder:`请输入角色描述`,rows:3}],actions:{showSubmit:!0,showReset:!0,submitText:`保存修改`,resetText:`取消`,align:`right`,onReset:()=>{L.value=!1}}};function Ze(e){z.value=e,q.value={id:e.id,name:e.name,code:e.code,description:e.description,permissions:e.permissions||[],status:e.status},L.value=!0}function Qe(e){Ve(e)}function $e(e){z.value&&He({id:z.value.id,values:e})}function J(e){Ue(e)}let Y=l([]),X=l([]);function et(e,t){Y.value=e,X.value=t}function tt(){Y.value=[],X.value=[],F.value?.clearSelection()}function nt(){if(Y.value.length===0){alert(`请先选择要删除的角色`);return}confirm(`确定要删除选中的 ${Y.value.length} 个角色吗？`)&&We(Y.value)}function rt(e){e.current!==void 0&&ze(e.current),e.pageSize!==void 0&&Be(e.pageSize)}function it(){K.value={name:``,code:``,description:``,permissions:[],status:`active`}}let Z=l(!1),Q=l([]),$=l(null);function at(e){B.value=e,Z.value=!1,Q.value=[],U.value=[...e.permissions||[]],W.value=[`system`],R.value=!0}function ot(e){Z.value||(Q.value=e.halfCheckedKeys)}function st(e){Z.value=e,e?Q.value=[]:ie(()=>{let e=$.value?.getHalfCheckedKeys();e&&(Q.value=e)})}function ct(){if(B.value){let e=Array.isArray(U.value)?U.value:[],t=Array.isArray(Q.value)?Q.value:[],n=Z.value?e:[...e,...t];Ge({id:B.value.id,permissions:[...new Set(n)]})}}let lt=n(()=>{let e=A.value||[],t=e.length,n=e.filter(e=>e.status===`active`).length,r=e.reduce((e,t)=>e+(t.userCount||0),0),i=e.reduce((e,t)=>e+(t.permissions?.length||0),0);return[{title:`角色总数`,value:t,icon:c,color:`text-blue-500`},{title:`启用角色`,value:n,icon:ee,color:`text-green-500`},{title:`关联用户`,value:r,icon:ae,color:`text-purple-500`},{title:`权限总数`,value:i,icon:re,color:`text-orange-500`}]});return(n,r)=>(g(),_(`div`,xe,[f(p(ve),{title:`角色管理`,subtitle:`管理系统角色和权限分配`,actions:[{text:`添加角色`,type:`primary`,iconName:`Plus`,onClick:()=>I.value=!0}]},null,8,[`actions`]),a(`div`,Se,[(g(!0),_(e,null,ne(p(lt),e=>(g(),s(p(ge),{key:e.title,title:e.title,value:e.value,icon:e.icon,color:e.color,size:`sm`},null,8,[`title`,`value`,`icon`,`color`]))),128))]),a(`div`,Ce,[f(p(b),{modelValue:p(P),"onUpdate:modelValue":r[0]||=e=>u(P)?P.value=e:null,schema:qe},null,8,[`modelValue`])]),f(p(ue),{class:`bg-muted/40 border border-border/50 rounded-xl`},{default:t(()=>[f(p(fe),null,{default:t(()=>[a(`div`,we,[a(`div`,C,[f(p(pe),{class:`text-base font-semibold`},{default:t(()=>[...r[12]||=[i(`角色列表`,-1)]]),_:1}),a(`span`,w,` 共 `+o(p(A)?.length||0)+` 个角色 `,1)]),f(p(be),{count:p(Y).length,total:p(M),"item-name":`角色`,"class-name":`border-0 bg-transparent shadow-none px-0 py-0`,actions:[{text:`批量删除`,type:`danger`,confirm:!0,confirmText:`确定要删除选中的角色吗？此操作不可恢复。`,onClick:nt}],onClear:tt},null,8,[`count`,`total`,`actions`])])]),_:1}),f(p(de),{class:`pt-0`},{default:t(()=>[f(p(ce),{ref_key:`tableRef`,ref:F,data:p(A),"onUpdate:data":r[1]||=e=>u(A)?A.value=e:null,schema:p(Je),loading:p(Ie),onSelectChange:et,onChange:rt},{name:t(e=>[a(`div`,T,[f(p(c),{class:`h-4 w-4 text-muted-foreground`}),a(`span`,E,o(e.text),1)])]),userCount:t(e=>[f(p(y),{color:`blue`},{default:t(()=>[i(o(e.text)+`人`,1)]),_:2},1024)]),permissionCount:t(e=>[f(p(y),{color:`purple`},{default:t(()=>[i(o(e.text?.length||0),1)]),_:2},1024)]),status:t(e=>[f(p(_e),{status:e.text,"status-map":{active:{text:`启用`,color:`success`},inactive:{text:`禁用`,color:`default`},disabled:{text:`停用`,color:`error`}}},null,8,[`status`])]),description:t(e=>[e.text?(g(),s(p(v),{key:0,title:e.text},{default:t(()=>[a(`span`,D,o(e.text),1)]),_:2},1032,[`title`])):(g(),_(`span`,O,`-`))]),emptyText:t(()=>[f(p(ye),{type:`data`,title:`暂无角色数据`,description:`开始添加您的第一个角色吧`,action:{text:`添加角色`,type:`primary`,iconName:`Plus`,onClick:()=>I.value=!0}},null,8,[`action`])]),_:1},8,[`data`,`schema`,`loading`])]),_:1})]),_:1}),f(p(x),{open:p(I),"onUpdate:open":r[3]||=e=>u(I)?I.value=e:null,title:`添加角色`,width:`560`,"form-ref":p(V),onSubmit:Qe},{default:t(()=>[f(p(b),{ref_key:`addFormRef`,ref:V,modelValue:p(K),"onUpdate:modelValue":r[2]||=e=>u(K)?K.value=e:null,schema:Ye,embedded:``},null,8,[`modelValue`])]),_:1},8,[`open`,`form-ref`]),f(p(x),{open:p(L),"onUpdate:open":r[5]||=e=>u(L)?L.value=e:null,title:`编辑角色`,width:`560`,"form-ref":p(H),onSubmit:$e},{default:t(()=>[p(z)?(g(),s(p(b),{key:0,ref_key:`editFormRef`,ref:H,modelValue:p(q),"onUpdate:modelValue":r[4]||=e=>u(q)?q.value=e:null,schema:Xe,embedded:``},null,8,[`modelValue`])):d(``,!0)]),_:1},8,[`open`,`form-ref`]),f(p(he),{open:p(R),"onUpdate:open":r[11]||=e=>u(R)?R.value=e:null,title:`权限分配`,width:`520`},{footer:t(()=>[a(`div`,Fe,[f(p(h),{variant:`outline`,onClick:r[10]||=e=>R.value=!1},{default:t(()=>[...r[16]||=[i(` 取消 `,-1)]]),_:1}),f(p(h),{onClick:ct},{default:t(()=>[...r[17]||=[i(` 保存 `,-1)]]),_:1})])]),default:t(()=>[p(B)?(g(),_(`div`,k,[a(`div`,Te,[a(`div`,Ee,[f(p(c),{class:`h-5 w-5 text-primary`})]),a(`div`,De,[a(`div`,Oe,o(p(B).name),1),a(`div`,ke,o(p(B).code),1)]),f(p(oe),{class:te({"bg-green-500/10 text-green-500 border-green-500/20":p(B).status===`active`,"bg-gray-500/10 text-gray-500 border-gray-500/20":p(B).status===`inactive`}),variant:`outline`},{default:t(()=>[i(o(p(B).status===`active`?`启用`:`禁用`),1)]),_:1},8,[`class`])]),a(`div`,Ae,[a(`div`,je,[r[13]||=a(`span`,{class:`text-sm font-medium`},`权限列表`,-1),f(p(y),{color:`blue`},{default:t(()=>[i(o(p(G).length)+` 个模块`,1)]),_:1})])]),a(`div`,Me,[a(`div`,Ne,[r[15]||=a(`span`,{class:`text-sm font-medium`},`父子节点联动`,-1),f(p(v),{title:`开启后，选中父节点会自动选中所有子节点`},{default:t(()=>[...r[14]||=[a(`span`,{class:`text-muted-foreground cursor-help`},`(?)`,-1)]]),_:1})]),f(p(se),{checked:p(Z),"onUpdate:checked":r[6]||=e=>u(Z)?Z.value=e:null,"checked-children":`独立`,"un-checked-children":`联动`,onChange:st},null,8,[`checked`])]),a(`div`,Pe,[f(p(le),{ref_key:`permissionTreeRef`,ref:$,modelValue:p(U),"onUpdate:modelValue":r[7]||=e=>u(U)?U.value=e:null,"half-checked-keys":p(Q),"onUpdate:halfCheckedKeys":r[8]||=e=>u(Q)?Q.value=e:null,"expanded-keys":p(W),"onUpdate:expandedKeys":r[9]||=e=>u(W)?W.value=e:null,"tree-data":p(G),"check-strictly":p(Z),checkable:``,toolbar:``,statistics:{enabled:!0,label:`已选择`,unit:`个权限`,showHalfChecked:!p(Z)},onCheck:ot},null,8,[`modelValue`,`half-checked-keys`,`expanded-keys`,`tree-data`,`check-strictly`,`statistics`])])])):d(``,!0)]),_:1},8,[`open`])]))}});export{A as default};