import"./ScrollArea-CW0-18Hy.js";import"./RovingFocusItem-DihGLheP.js";import{t as e}from"./button-Bo4o88Eb.js";import"./Presence-CX2vXdhf.js";import"./defu-BJL4Fjh2.js";import"./usePrimitiveElement-bvCn2QxH.js";import"./TabsTrigger-EHjOJe4X.js";import{Di as t,E as n,Ea as r,G as i,Gi as a,In as o,M as s,Q as c,Ti as l,Ui as u,Yi as d,_i as f,bi as p,ct as m,da as h,fi as ee,ga as g,ka as _,lt as te,na as ne,oa as v,ot as re,ut as ie,vi as y,wa as b,wi as x,xi as S,yi as C}from"./index-D9LA8apy.js";import"./en_US-N9Q-_HQi.js";import"./common-rttX-sZZ.js";import"./zh_CN-RQJLYl9H.js";import{n as ae}from"./useTabBar-WvhELTvw.js";import{t as w}from"./badge-DoBLqkFL.js";import{n as oe,t as se}from"./CardContent-bGWyUVF7.js";import{n as ce,t as le}from"./CardTitle-9YsRePqj.js";import{u as ue}from"./dist-guKItzxh.js";import{t as de}from"./TTable-BJXg8Gts.js";import{t as T}from"./TForm-De-AxzjP.js";import"./Input-DxyLxkUT.js";import"./TIcon-DpsAxes7.js";import{t as E}from"./TModal-l0DmcJma.js";import{n as fe,r as D}from"./composables-B_2v-ght.js";var pe={class:`space-y-6`},O={class:`flex flex-col sm:flex-row sm:items-center justify-between gap-4`},k={class:`flex flex-wrap gap-3`},A={class:`flex items-baseline gap-2`},j={class:`text-lg font-semibold`},M={class:`text-xs text-muted-foreground`},N={class:`bg-muted/30 rounded-lg p-4`},P={class:`flex items-center gap-2`},F={class:`font-medium`},I={key:1,class:`text-muted-foreground`},L={key:1,class:`text-muted-foreground block text-center`},R={class:`flex flex-col items-center justify-center py-12 text-muted-foreground`},z={class:`w-16 h-16 rounded-full bg-muted flex items-center justify-center mb-4`},B=t({__name:`index`,setup(t){let{data:B,loading:me,searchQuery:V,fetchData:H}=fe({apiCall:async e=>await o.getMenus(e)||{list:[],total:0,page:1,pageSize:10},apiCallParams:e=>({search:e.searchQuery})});function he(e){let t=new Map,n=[];return e.forEach(e=>{t.set(e.id,{...e})}),e.forEach(e=>{let r=t.get(e.id);if(e.parentId&&t.has(e.parentId)){let n=t.get(e.parentId);n.children||=[],n.children.push(r),n.children.sort((e,t)=>e.sort-t.sort)}else n.push(r)}),n.sort((e,t)=>e.sort-t.sort)}let U=f(()=>he(B.value)),{mutate:ge}=D({mutationFn:e=>o.createMenu({name:e.name,title:e.title,path:e.path,component:e.component,icon:e.icon,parentId:e.parentId,sort:e.sort||0,status:e.status,hidden:e.hidden||!1,keepAlive:e.keepAlive||!1,external:e.external||!1,permission:e.permission,type:e.type||`menu`}),successMessage:`菜单创建成功`,onSuccess:()=>{K.value=!1,Me(),H()}}),{mutate:_e}=D({mutationFn:({id:e,values:t})=>o.updateMenu(e,{name:t.name,title:t.title,path:t.path,component:t.component,icon:t.icon,parentId:t.parentId,sort:t.sort,status:t.status,hidden:t.hidden,keepAlive:t.keepAlive,external:t.external,permission:t.permission,type:t.type}),successMessage:`菜单更新成功`,onSuccess:()=>{q.value=!1,J.value=null,H()}}),{mutate:ve}=D({mutationFn:e=>o.deleteMenu(e),successMessage:`菜单删除成功`,onSuccess:()=>H()}),{mutate:ye}=D({mutationFn:({id:e,status:t})=>o.updateMenuStatus(e,t),successMessage:`状态更新成功`,onSuccess:()=>H()}),W=g({keyword:``}),be={layout:`inline`,fields:[{name:`keyword`,type:`input`,label:``,placeholder:`搜索菜单名称或路径...`,className:`w-[280px]`}],searchConfig:{enabled:!0,collapsed:!1,showCollapseButton:!1,searchText:`搜索`,resetText:`重置`,showReset:!0,onSearch:e=>{V.value=e.keyword||``},onReset:()=>{V.value=``}}},xe=g();function G(e){return ae(e)||i}function Se(e){let t={directory:{label:`目录`,color:`blue`},menu:{label:`菜单`,color:`green`},button:{label:`按钮`,color:`orange`}};return t[e]||t.menu}let Ce=f(()=>({columns:[{title:`菜单名称`,dataIndex:`title`,width:200,slot:`title`},{title:`类型`,dataIndex:`type`,width:80,align:`center`,slot:`type`},{title:`路由路径`,dataIndex:`path`,width:160,ellipsis:!0},{title:`组件`,dataIndex:`component`,width:140,ellipsis:!0},{title:`图标`,dataIndex:`icon`,width:70,align:`center`,slot:`icon`},{title:`排序`,dataIndex:`sort`,width:60,align:`center`},{title:`状态`,dataIndex:`status`,width:80,slot:`status`},{title:`可见`,dataIndex:`hidden`,width:60,align:`center`,slot:`hidden`},{title:`缓存`,dataIndex:`keepAlive`,width:60,align:`center`,slot:`keepAlive`},{title:`外链`,dataIndex:`external`,width:60,align:`center`,slot:`external`}],childrenColumnName:`children`,indentSize:20,expandable:{defaultExpandAllRows:!0},pagination:!1,actions:[{text:`编辑`,type:`primary`,onClick:e=>$(e)},{text:`删除`,type:`danger`,confirm:!0,confirmText:`确定要删除该菜单吗？子菜单也会被删除，此操作不可恢复。`,onClick:e=>Ae(e.id)}],actionWidth:150,actionFixed:`right`})),K=g(!1),q=g(!1),J=g(null);function Y(){return{name:``,title:``,path:``,component:``,icon:``,parentId:null,sort:0,status:`active`,hidden:!1,keepAlive:!1,external:!1,permission:``,type:`menu`}}let X=g(Y()),Z=g({id:``,...Y()});ne(()=>X.value.path,e=>{if(e&&!X.value.component){let t=e.startsWith(`/`)?e.slice(1):e;X.value.component=t?`${t}/index`:``}}),f(()=>[{label:`顶级菜单`,value:null},...(B.value||[]).map(e=>({label:e.title,value:e.id}))]);let we=f(()=>{let e=t=>t.map(t=>({title:t.title,value:t.id,key:t.id,children:t.children?e(t.children):void 0}));return[{title:`顶级菜单`,value:0,key:`root`,children:e(U.value)}]}),Te=[{label:`目录`,value:`directory`,color:`blue`},{label:`菜单`,value:`menu`,color:`green`},{label:`按钮`,value:`button`,color:`orange`}];function Q(e){return[{name:`type`,type:`select`,label:`菜单类型`,placeholder:`请选择菜单类型`,options:Te,disabled:e,rules:[{required:!0,message:`请选择菜单类型`}]},{name:`title`,type:`input`,label:`菜单标题`,placeholder:`请输入菜单标题`,rules:[{required:!0,message:`菜单标题不能为空`},{min:2,message:`菜单标题至少2个字符`}]},{name:`name`,type:`input`,label:`路由名称`,placeholder:`请输入路由名称`,disabled:e,dependencies:{field:`type`,condition:e=>e!==`button`},rules:[{required:!0,message:`路由名称不能为空`},{pattern:/^[A-Za-z0-9_-]+$/,message:`名称只能包含字母、数字、下划线和横线`}]},{name:`path`,type:`input`,label:`路由路径`,placeholder:`请输入路由路径，如 /system/user`,dependencies:{field:`type`,condition:e=>e!==`button`},rules:[{required:!0,message:`路由路径不能为空`},{pattern:/^\/[A-Za-z0-9/_-]*$/,message:`路径格式不正确`}]},{name:`component`,type:`input`,label:`组件路径`,placeholder:`请输入组件路径，如 system/user/index`,dependencies:{field:`type`,condition:e=>e===`menu`},rules:[{required:!0,message:`组件路径不能为空`}]},{name:`parentId`,type:`tree-select`,label:`上级菜单`,placeholder:`请选择上级菜单`,options:we.value,disabled:e,props:{treeDefaultExpandAll:!0,allowClear:!0,showSearch:!0,treeNodeFilterProp:`title`}},{name:`icon`,type:`icon`,label:`图标`,placeholder:`请选择图标`,dependencies:{field:`type`,condition:e=>e!==`button`},props:{showClear:!0,showCategoryTabs:!0,popupWidth:840,columns:10}},{name:`sort`,type:`number`,label:`排序`,placeholder:`请输入排序号`,min:0},{name:`permission`,type:`input`,label:`权限标识`,placeholder:`请输入权限标识，如 system:user:view`,dependencies:{field:`type`,condition:e=>e===`button`}},{name:`status`,type:`select`,label:`状态`,placeholder:`请选择状态`,options:[{label:`启用`,value:`active`},{label:`禁用`,value:`inactive`}],rules:[{required:!0,message:`请选择状态`}]},{name:`hidden`,type:`switch`,label:`隐藏菜单`,checkedChildren:`是`,unCheckedChildren:`否`,dependencies:{field:`type`,condition:e=>e!==`button`}},{name:`keepAlive`,type:`switch`,label:`缓存页面`,checkedChildren:`是`,unCheckedChildren:`否`,dependencies:{field:`type`,condition:e=>e===`menu`}},{name:`external`,type:`switch`,label:`外部链接`,checkedChildren:`是`,unCheckedChildren:`否`,dependencies:{field:`type`,condition:e=>e===`menu`}}]}let Ee=f(()=>({layout:`horizontal`,columns:2,labelCol:{span:8},wrapperCol:{span:16},fields:Q(!1),actions:{showSubmit:!0,showReset:!0,submitText:`添加菜单`,resetText:`取消`,align:`right`,onReset:()=>{K.value=!1}}})),De=f(()=>({layout:`horizontal`,columns:2,labelCol:{span:8},wrapperCol:{span:16},fields:Q(!0),actions:{showSubmit:!0,showReset:!0,submitText:`保存修改`,resetText:`取消`,align:`right`,onReset:()=>{q.value=!1}}}));function $(e){J.value=e,Z.value={id:e.id,name:e.name,title:e.title,path:e.path,component:e.component,icon:e.icon,parentId:e.parentId,sort:e.sort,status:e.status,hidden:e.hidden,keepAlive:e.keepAlive,external:e.external,permission:e.permission,type:e.type},q.value=!0}function Oe(e){ge(e)}function ke(e){J.value&&_e({id:J.value.id,values:e})}function Ae(e){ve(e)}function je(e){let t=e.status===`active`?`inactive`:`active`;ye({id:e.id,status:t})}function Me(){X.value=Y()}let Ne=f(()=>{let e=B.value||[],t=e.length;e.filter(e=>e.status===`active`).length,e.filter(e=>!e.hidden).length;let n=e.filter(e=>e.type===`directory`).length,r=e.filter(e=>e.type===`menu`).length,a=e.filter(e=>e.type===`button`).length;return[{title:`菜单总数`,value:t,icon:i,color:`text-blue-500`},{title:`目录`,value:n,icon:re,color:`text-cyan-500`},{title:`菜单`,value:r,icon:c,color:`text-green-500`},{title:`按钮`,value:a,icon:m,color:`text-orange-500`}]});return(t,i)=>(u(),S(`div`,pe,[y(`div`,O,[i[9]||=y(`div`,null,[y(`h1`,{class:`text-3xl font-bold tracking-tight`},`菜单管理`),y(`p`,{class:`text-muted-foreground mt-1.5 text-sm`},`管理系统导航菜单和路由配置`)],-1),l(b(e),{class:`gap-2`,onClick:i[0]||=e=>K.value=!0},{default:v(()=>[l(b(s),{class:`h-4 w-4`}),i[8]||=x(` 添加菜单 `,-1)]),_:1})]),y(`div`,k,[(u(!0),S(ee,null,a(b(Ne),e=>(u(),S(`div`,{key:e.title,class:`flex items-center gap-3 px-4 py-2.5 bg-muted/50 rounded-lg hover:bg-muted/70 transition-colors`},[(u(),C(d(e.icon),{class:r([`h-4 w-4`,e.color])},null,8,[`class`])),y(`div`,A,[y(`span`,j,_(e.value),1),y(`span`,M,_(e.title),1)])]))),128))]),y(`div`,N,[l(b(T),{modelValue:b(W),"onUpdate:modelValue":i[1]||=e=>h(W)?W.value=e:null,schema:be},null,8,[`modelValue`])]),l(b(oe),{class:`border-0 shadow-sm`},{default:v(()=>[l(b(ce),{class:`pb-4`},{default:v(()=>[l(b(le),{class:`text-base font-semibold`},{default:v(()=>[...i[10]||=[x(`菜单结构`,-1)]]),_:1})]),_:1}),l(b(se),{class:`pt-0`},{default:v(()=>[l(b(de),{ref_key:`tableRef`,ref:xe,data:b(U),"onUpdate:data":i[3]||=e=>h(U)?U.value=e:null,schema:b(Ce),loading:b(me)},{title:v(({text:e,record:t})=>[y(`div`,P,[t?(u(),C(d(G(t.icon)),{key:0,class:`h-4 w-4 text-muted-foreground`})):p(``,!0),y(`span`,F,_(e),1)])]),icon:v(({text:e})=>[e?(u(),C(d(G(e)),{key:0,class:`h-4 w-4 text-muted-foreground mx-auto`})):(u(),S(`span`,I,`-`))]),type:v(({text:e})=>[e?(u(),C(b(w),{key:0,class:r({"bg-blue-500/10 text-blue-500 border-blue-500/20":e===`directory`,"bg-green-500/10 text-green-500 border-green-500/20":e===`menu`,"bg-orange-500/10 text-orange-500 border-orange-500/20":e===`button`}),variant:`outline`},{default:v(()=>[x(_(Se(e).label),1)]),_:2},1032,[`class`])):p(``,!0)]),status:v(({text:e,record:t})=>[t?(u(),C(b(w),{key:0,class:r({"bg-green-500/10 text-green-500 border-green-500/20 cursor-pointer hover:bg-green-500/20":e===`active`,"bg-gray-500/10 text-gray-500 border-gray-500/20 cursor-pointer hover:bg-gray-500/20":e===`inactive`}),variant:`outline`,onClick:e=>je(t)},{default:v(()=>[x(_(e===`active`?`启用`:`禁用`),1)]),_:2},1032,[`class`,`onClick`])):p(``,!0)]),hidden:v(({text:e})=>[e?(u(),C(b(te),{key:1,class:`h-4 w-4 text-gray-400 mx-auto`})):(u(),C(b(m),{key:0,class:`h-4 w-4 text-green-500 mx-auto`}))]),keepAlive:v(({text:e})=>[l(b(ue),{checked:e,size:`small`,disabled:``,class:`mx-auto`},null,8,[`checked`])]),external:v(({text:e})=>[e?(u(),C(b(ie),{key:0,class:`h-4 w-4 text-blue-500 mx-auto`})):(u(),S(`span`,L,`-`))]),emptyText:v(()=>[y(`div`,R,[y(`div`,z,[l(b(n),{class:`w-8 h-8 text-muted-foreground/50`})]),i[12]||=y(`p`,{class:`text-base font-medium mb-1`},`暂无菜单数据`,-1),i[13]||=y(`p`,{class:`text-sm text-muted-foreground mb-4`},`开始添加您的第一个菜单吧`,-1),l(b(e),{size:`sm`,onClick:i[2]||=e=>K.value=!0},{default:v(()=>[l(b(s),{class:`h-4 w-4 mr-1`}),i[11]||=x(` 添加菜单 `,-1)]),_:1})])]),_:1},8,[`data`,`schema`,`loading`])]),_:1})]),_:1}),l(b(E),{open:b(K),"onUpdate:open":i[5]||=e=>h(K)?K.value=e:null,title:`添加菜单`,width:`800`,footer:null},{default:v(()=>[l(b(T),{modelValue:b(X),"onUpdate:modelValue":i[4]||=e=>h(X)?X.value=e:null,schema:b(Ee),onSubmit:Oe},null,8,[`modelValue`,`schema`])]),_:1},8,[`open`]),l(b(E),{open:b(q),"onUpdate:open":i[7]||=e=>h(q)?q.value=e:null,title:`编辑菜单`,width:`800`,footer:null},{default:v(()=>[b(J)?(u(),C(b(T),{key:0,modelValue:b(Z),"onUpdate:modelValue":i[6]||=e=>h(Z)?Z.value=e:null,schema:b(De),onSubmit:ke},null,8,[`modelValue`,`schema`])):p(``,!0)]),_:1},8,[`open`])]))}});export{B as default};