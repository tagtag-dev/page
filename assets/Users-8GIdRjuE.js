import"./ScrollArea-CW0-18Hy.js";import"./RovingFocusItem-DihGLheP.js";import{t as e}from"./button-Bo4o88Eb.js";import"./Presence-CX2vXdhf.js";import"./defu-BJL4Fjh2.js";import"./usePrimitiveElement-bvCn2QxH.js";import"./TabsTrigger-EHjOJe4X.js";import{Di as t,E as n,Ea as r,Gi as ee,Jn as i,Ln as a,M as o,Oa as te,Qn as s,Ti as c,Ui as l,Yi as ne,Zn as u,_i as d,a as re,bi as f,c as ie,da as p,fi as ae,ga as m,ka as h,l as oe,oa as g,p as se,vi as _,wa as v,wi as y,xi as b,yi as x}from"./index-D9LA8apy.js";import"./en_US-N9Q-_HQi.js";import"./common-rttX-sZZ.js";import"./zh_CN-RQJLYl9H.js";import"./useTabBar-WvhELTvw.js";import{t as S}from"./badge-DoBLqkFL.js";import{n as C,t as ce}from"./CardContent-bGWyUVF7.js";import{n as le,t as ue}from"./CardTitle-9YsRePqj.js";import{N as de,s as fe,w as pe}from"./dist-guKItzxh.js";import{t as me}from"./TTable-BJXg8Gts.js";import{t as w}from"./TForm-De-AxzjP.js";import"./Input-DxyLxkUT.js";import"./TIcon-DpsAxes7.js";import{t as T}from"./TModal-l0DmcJma.js";import{n as E,r as D}from"./composables-B_2v-ght.js";import"./constants-BrhrixW3.js";var O={class:`space-y-6`},k={class:`flex flex-col sm:flex-row sm:items-center justify-between gap-4`},A={class:`flex flex-wrap gap-3`},j={class:`flex items-baseline gap-2`},M={class:`text-lg font-semibold`},N={class:`text-xs text-muted-foreground`},P={class:`bg-muted/30 rounded-lg p-4`},F={class:`flex flex-col lg:flex-row lg:items-center gap-4`},I={class:`flex-1`},L={key:0,class:`flex items-center gap-2 lg:border-l lg:pl-4`},R={class:`text-sm text-muted-foreground`},z={class:`flex items-center justify-between`},he={class:`flex items-center gap-3`},ge={class:`text-xs text-muted-foreground bg-muted px-2 py-0.5 rounded-full`},_e={class:`font-medium`},ve={class:`text-sm text-muted-foreground`},ye={class:`flex flex-col items-center justify-center py-12 text-muted-foreground`},be={class:`w-16 h-16 rounded-full bg-muted flex items-center justify-center mb-4`},B=t({__name:`Users`,setup(t){let{data:B,loading:xe,searchQuery:V,filters:H,currentPage:Se,pageSize:Ce,total:U,statistics:we,fetchData:W,goToPage:Te,setPageSize:G,addData:Ee,updateData:De,removeData:Oe,batchRemoveData:ke}=E({apiCall:async e=>await a.getUsers(e)||{list:[],total:0,page:1,pageSize:10},apiCallParams:e=>({page:e.page,pageSize:e.pageSize,search:e.searchQuery,role:e.filters.role,status:e.filters.status}),statisticsFn:e=>({total:e.length,active:e.filter(e=>e.status===s.ACTIVE).length,admins:e.filter(e=>e.role===u.ADMIN).length,today:e.filter(e=>{let t=new Date(e.createdAt),n=new Date;return t.toDateString()===n.toDateString()}).length})}),{mutate:Ae}=D({mutationFn:e=>a.createUser({name:e.name,email:e.email,role:e.role,status:e.status}),successMessage:`用户创建成功`,onSuccess:()=>{J.value=!1,Z.value={name:``,email:``,role:u.VIEWER,status:s.ACTIVE},W()}}),{mutate:je}=D({mutationFn:({id:e,values:t})=>a.updateUser(e,{name:t.name,email:t.email,role:t.role,status:t.status}),successMessage:`用户更新成功`,onSuccess:()=>{Y.value=!1,X.value=null,W()}}),{mutate:Me,loading:Ne}=D({mutationFn:e=>a.deleteUser(e),successMessage:`用户删除成功`,onSuccess:()=>W()}),{mutate:Pe}=D({mutationFn:e=>a.batchDeleteUsers(e),successMessage:`批量删除成功`,onSuccess:()=>{q.value?.clearSelection(),W()}}),Fe=d(()=>{let e=we.value||{};return[{title:`总用户`,value:e.total||0,icon:re,color:`text-blue-500`,bgColor:`bg-blue-50`},{title:`活跃用户`,value:e.active||0,icon:oe,color:`text-green-500`,bgColor:`bg-green-50`},{title:`管理员`,value:e.admins||0,icon:ie,color:`text-purple-500`,bgColor:`bg-purple-50`},{title:`今日新增`,value:e.today||0,icon:se,color:`text-orange-500`,bgColor:`bg-orange-50`}]}),K=m({keyword:``,role:``,status:``}),Ie={layout:`inline`,fields:[{name:`keyword`,type:`input`,label:``,placeholder:`搜索用户名或邮箱...`,className:`w-[200px]`},{name:`role`,type:`select`,label:``,placeholder:`全部角色`,options:[{label:`全部角色`,value:``},{label:`管理员`,value:u.ADMIN},{label:`编辑`,value:u.EDITOR},{label:`查看者`,value:u.VIEWER}],className:`w-[140px]`},{name:`status`,type:`select`,label:``,placeholder:`全部状态`,options:[{label:`全部状态`,value:``},{label:i.USER.ACTIVE.text,value:i.USER.ACTIVE.value},{label:i.USER.INACTIVE.text,value:i.USER.INACTIVE.value},{label:i.USER.SUSPENDED.text,value:i.USER.SUSPENDED.value}],className:`w-[140px]`}],searchConfig:{enabled:!0,collapsed:!1,collapseThreshold:3,showCollapseButton:!1,searchText:`搜索`,resetText:`重置`,showReset:!0,onSearch:e=>{V.value=e.keyword||``,H.value={role:e.role,status:e.status}},onReset:()=>{V.value=``,H.value={}}}},q=m(),Le=d(()=>({columns:[{title:`用户`,dataIndex:`name`,width:200,slot:`user`},{title:`角色`,dataIndex:`role`,width:120,slot:`role`,filters:[{text:`管理员`,value:u.ADMIN},{text:`编辑`,value:u.EDITOR},{text:`查看者`,value:u.VIEWER}]},{title:`状态`,dataIndex:`status`,width:100,slot:`status`,filters:[{text:i.USER.ACTIVE.text,value:i.USER.ACTIVE.value},{text:i.USER.INACTIVE.text,value:i.USER.INACTIVE.value},{text:i.USER.SUSPENDED.text,value:i.USER.SUSPENDED.value}]},{title:`创建时间`,dataIndex:`createdAt`,width:120,sorter:!0},{title:`最后登录`,dataIndex:`lastLogin`,width:120,customRender:({text:e})=>e||`-`}],pagination:{pageSize:10,show:!0,showSizeChanger:!0,showQuickJumper:!0,total:U.value},rowSelection:{type:`checkbox`,show:!0},actions:[{text:`编辑`,type:`primary`,onClick:e=>Be(e)},{text:`删除`,type:`danger`,confirm:!0,confirmText:`确定要删除该用户吗？此操作不可恢复。`,onClick:e=>Ue(e.id)}],actionWidth:150,actionFixed:`right`})),J=m(!1),Y=m(!1),X=m(null),Z=m({name:``,email:``,role:u.VIEWER,status:s.ACTIVE}),Q=m({id:``,name:``,email:``,role:u.VIEWER,status:s.ACTIVE}),Re={layout:`horizontal`,labelCol:{span:6},wrapperCol:{span:18},fields:[{name:`name`,type:`input`,label:`姓名`,placeholder:`请输入姓名`,rules:[{required:!0,message:`姓名不能为空`},{min:2,message:`姓名至少2个字符`}]},{name:`email`,type:`input`,label:`邮箱`,placeholder:`请输入邮箱`,rules:[{required:!0,message:`邮箱不能为空`},{type:`email`,message:`邮箱格式不正确`}]},{name:`role`,type:`select`,label:`角色`,placeholder:`请选择角色`,options:[{label:`管理员`,value:u.ADMIN},{label:`编辑`,value:u.EDITOR},{label:`查看者`,value:u.VIEWER}],rules:[{required:!0,message:`请选择角色`}]},{name:`status`,type:`select`,label:`状态`,placeholder:`请选择状态`,options:[{label:i.USER.ACTIVE.text,value:i.USER.ACTIVE.value},{label:i.USER.INACTIVE.text,value:i.USER.INACTIVE.value},{label:i.USER.SUSPENDED.text,value:i.USER.SUSPENDED.value}],rules:[{required:!0,message:`请选择状态`}]}],actions:{showSubmit:!0,showReset:!0,submitText:`添加用户`,resetText:`取消`,align:`right`,onReset:()=>{J.value=!1}}},ze={layout:`horizontal`,labelCol:{span:6},wrapperCol:{span:18},fields:[{name:`name`,type:`input`,label:`姓名`,placeholder:`请输入姓名`,rules:[{required:!0,message:`姓名不能为空`},{min:2,message:`姓名至少2个字符`}]},{name:`email`,type:`input`,label:`邮箱`,placeholder:`请输入邮箱`,rules:[{required:!0,message:`邮箱不能为空`},{type:`email`,message:`邮箱格式不正确`}]},{name:`role`,type:`select`,label:`角色`,placeholder:`请选择角色`,options:[{label:`管理员`,value:u.ADMIN},{label:`编辑`,value:u.EDITOR},{label:`查看者`,value:u.VIEWER}],rules:[{required:!0,message:`请选择角色`}]},{name:`status`,type:`select`,label:`状态`,placeholder:`请选择状态`,options:[{label:i.USER.ACTIVE.text,value:i.USER.ACTIVE.value},{label:i.USER.INACTIVE.text,value:i.USER.INACTIVE.value},{label:i.USER.SUSPENDED.text,value:i.USER.SUSPENDED.value}],rules:[{required:!0,message:`请选择状态`}]}],actions:{showSubmit:!0,showReset:!0,submitText:`保存修改`,resetText:`取消`,align:`right`,onReset:()=>{Y.value=!1}}};function Be(e){X.value=e,Q.value={id:e.id,name:e.name,email:e.email,role:e.role,status:e.status},Y.value=!0}function Ve(e){Ae(e)}function He(e){X.value&&je({id:X.value.id,values:e})}function Ue(e){Me(e)}let $=m([]),We=m([]);function Ge(e,t){$.value=e,We.value=t}function Ke(){if($.value.length===0){alert(`请先选择要删除的用户`);return}confirm(`确定要删除选中的 ${$.value.length} 个用户吗？`)&&Pe($.value)}function qe(e){e.current!==void 0&&Te(e.current),e.pageSize!==void 0&&G(e.pageSize)}return(t,a)=>(l(),b(`div`,O,[_(`div`,k,[a[9]||=_(`div`,null,[_(`h1`,{class:`text-3xl font-bold tracking-tight`},`用户管理`),_(`p`,{class:`text-muted-foreground mt-1.5 text-sm`},`管理系统用户和权限`)],-1),c(v(e),{class:`gap-2`,onClick:a[0]||=e=>J.value=!0},{default:g(()=>[c(v(o),{class:`h-4 w-4`}),a[8]||=y(` 添加用户 `,-1)]),_:1})]),c(v(T),{open:v(J),"onUpdate:open":a[2]||=e=>p(J)?J.value=e:null,title:`添加新用户`,width:`480`,footer:null},{default:g(()=>[c(v(w),{modelValue:v(Z),"onUpdate:modelValue":a[1]||=e=>p(Z)?Z.value=e:null,schema:Re,onSubmit:Ve},null,8,[`modelValue`])]),_:1},8,[`open`]),_(`div`,A,[(l(!0),b(ae,null,ee(v(Fe),e=>(l(),b(`div`,{key:e.title,class:`flex items-center gap-3 px-4 py-2.5 bg-muted/50 rounded-lg hover:bg-muted/70 transition-colors`},[(l(),x(ne(e.icon),{class:r([`h-4 w-4`,e.color])},null,8,[`class`])),_(`div`,j,[_(`span`,M,h(e.value),1),_(`span`,N,h(e.title),1)])]))),128))]),_(`div`,P,[_(`div`,F,[_(`div`,I,[c(v(w),{modelValue:v(K),"onUpdate:modelValue":a[3]||=e=>p(K)?K.value=e:null,schema:Ie},null,8,[`modelValue`])]),v($).length>0?(l(),b(`div`,L,[_(`span`,R,`已选 `+h(v($).length)+` 项`,1),c(v(e),{variant:`outline`,size:`sm`,class:`h-8 text-xs text-destructive hover:text-destructive`,onClick:Ke},{default:g(()=>[...a[10]||=[y(` 批量删除 `,-1)]]),_:1})])):f(``,!0)])]),c(v(C),{class:`border-0 shadow-sm`},{default:g(()=>[c(v(le),{class:`pb-4`},{default:g(()=>[_(`div`,z,[_(`div`,he,[c(v(ue),{class:`text-base font-semibold`},{default:g(()=>[...a[11]||=[y(`用户列表`,-1)]]),_:1}),_(`span`,ge,` 共 `+h(v(U))+` 人 `,1)])])]),_:1}),c(v(ce),{class:`pt-0`},{default:g(()=>[c(v(me),{ref_key:`tableRef`,ref:q,data:v(B),"onUpdate:data":a[5]||=e=>p(B)?B.value=e:null,schema:v(Le),loading:v(xe),onSelectChange:Ge,onChange:qe},{user:g(e=>[c(v(pe),null,{default:g(()=>[c(v(de),{style:te({backgroundColor:e.record.status===v(s).ACTIVE?`#87d068`:`#ccc`})},{default:g(()=>[y(h(e.record.name.charAt(0)),1)]),_:2},1032,[`style`]),_(`div`,null,[_(`div`,_e,h(e.record.name),1),_(`div`,ve,h(e.record.email),1)])]),_:2},1024)]),role:g(e=>[c(v(fe),{color:e.text===v(u).ADMIN?`red`:e.text===v(u).EDITOR?`blue`:`default`},{default:g(()=>[y(h(v(i).USER[e.text]?.text||e.text),1)]),_:2},1032,[`color`])]),status:g(e=>[c(v(S),{class:r({"bg-green-500/10 text-green-500 border-green-500/20":e.text===v(s).ACTIVE,"bg-gray-500/10 text-gray-500 border-gray-500/20":e.text===v(s).INACTIVE,"bg-red-500/10 text-red-500 border-red-500/20":e.text===v(s).SUSPENDED}),variant:`outline`},{default:g(()=>[y(h(v(i).USER[e.text]?.text||e.text),1)]),_:2},1032,[`class`])]),emptyText:g(()=>[_(`div`,ye,[_(`div`,be,[c(v(n),{class:`w-8 h-8 text-muted-foreground/50`})]),a[13]||=_(`p`,{class:`text-base font-medium mb-1`},`暂无用户数据`,-1),a[14]||=_(`p`,{class:`text-sm text-muted-foreground mb-4`},`开始添加您的第一个用户吧`,-1),c(v(e),{size:`sm`,onClick:a[4]||=e=>J.value=!0},{default:g(()=>[c(v(o),{class:`h-4 w-4 mr-1`}),a[12]||=y(` 添加用户 `,-1)]),_:1})])]),_:1},8,[`data`,`schema`,`loading`])]),_:1})]),_:1}),c(v(T),{open:v(Y),"onUpdate:open":a[7]||=e=>p(Y)?Y.value=e:null,title:`编辑用户`,width:`480`,footer:null},{default:g(()=>[v(X)?(l(),x(v(w),{key:0,modelValue:v(Q),"onUpdate:modelValue":a[6]||=e=>p(Q)?Q.value=e:null,schema:ze,onSubmit:He},null,8,[`modelValue`])):f(``,!0)]),_:1},8,[`open`])]))}});export{B as default};