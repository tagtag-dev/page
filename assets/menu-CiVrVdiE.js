import"./ScrollArea-DFVXjTz0.js";import"./RovingFocusItem-CVjkq2qt.js";import"./Presence-3Lrzvetv.js";import"./defu-DUbmuhNq.js";import"./TabsTrigger-DqwypIQj.js";import{$n as e,Ai as t,Ca as n,Ct as r,Fi as i,Gi as a,Hi as ee,Ii as o,Ka as s,Li as c,Na as l,Oa as u,Ri as d,St as te,Ui as f,Va as p,ca as m,fa as h,lt as ne,oa as g,tt as _,xt as v,ya as y,yt as b,zi as x}from"./index-D6Cod0pL.js";import"./en_US-LGbIKe0x.js";import"./common-HQCQB71w.js";import"./zh_CN-Cgumeokr.js";import{i as re}from"./useFullscreen-lrjpQVTw.js";import"./_plugin-vue_export-helper-Dey4FfNi.js";import{u as ie}from"./dist-D3XftLPo.js";import"./theme-shared-BpTdpb0d.js";import{t as ae}from"./TTable-B13ZnM5N.js";import"./useTableColumns-qs-cYpaB.js";import{t as S}from"./TForm-Drq7Qn9R.js";import"./TIcon-C-hNhMC1.js";import{t as C}from"./TModal-OyBXzO5K.js";import{n as oe,t as se}from"./CardContent-CMuL0LxG.js";import{n as ce,t as le}from"./CardTitle-D06OZslX.js";import{n as ue,r as w}from"./composables-CTAVZAup.js";import"./business-DYFIcNWr.js";import{t as T}from"./TDataCard-C7I9agpQ.js";import{t as E}from"./TStatusBadge-DZzFEG5C.js";import{t as D}from"./TPageHeader-CTxQMWSB.js";import{t as O}from"./TEmptyState-B9XitPgC.js";import"./TBatchActions-CX-6FAVm.js";var k={class:`space-y-6`},A={class:`flex flex-wrap gap-3`},j={class:`bg-muted/40 border border-border/50 rounded-xl px-3 py-3`},M={class:`flex items-center gap-2`},N={class:`font-medium`},P={key:1,class:`text-muted-foreground`},F={key:1,class:`text-muted-foreground block text-center`},I=a({__name:`index`,setup(a){let{data:I,loading:L,searchQuery:R,fetchData:z}=ue({apiCall:async t=>await e.getMenus(t)||{list:[],total:0,page:1,pageSize:10},apiCallParams:e=>({search:e.searchQuery})});function B(e){let t=new Map,n=[];return e.forEach(e=>{t.set(e.id,{...e})}),e.forEach(e=>{let r=t.get(e.id);if(e.parentId&&t.has(e.parentId)){let n=t.get(e.parentId);n.children||=[],n.children.push(r),n.children.sort((e,t)=>e.sort-t.sort)}else n.push(r)}),n.sort((e,t)=>e.sort-t.sort)}let V=i(()=>B(I.value)),{mutate:H}=w({mutationFn:t=>e.createMenu({name:t.name,title:t.title,path:t.path,component:t.component,icon:t.icon,parentId:t.parentId||null,sort:t.sort||0,status:t.status,hidden:t.hidden||!1,keepAlive:t.keepAlive||!1,external:t.external||!1,permission:t.permission,type:t.type||`menu`}),successMessage:`菜单创建成功`,onSuccess:()=>{K.value=!1,we(),z()}}),{mutate:U}=w({mutationFn:({id:t,values:n})=>e.updateMenu(t,{name:n.name,title:n.title,path:n.path,component:n.component,icon:n.icon,parentId:n.parentId||null,sort:n.sort,status:n.status,hidden:n.hidden,keepAlive:n.keepAlive,external:n.external,permission:n.permission,type:n.type}),successMessage:`菜单更新成功`,onSuccess:()=>{q.value=!1,J.value=null,z()}}),{mutate:de}=w({mutationFn:t=>e.deleteMenu(t),successMessage:`菜单删除成功`,onSuccess:()=>z()}),{mutate:fe}=w({mutationFn:({id:t,status:n})=>e.updateMenuStatus(t,n),successMessage:`状态更新成功`,onSuccess:()=>z()}),W=l({keyword:``}),pe={layout:`inline`,fields:[{name:`keyword`,type:`input`,label:``,placeholder:`搜索菜单名称或路径...`,className:`w-[280px]`}],searchConfig:{enabled:!0,collapsed:!1,showCollapseButton:!1,searchText:`搜索`,resetText:`重置`,showReset:!0,onSearch:e=>{R.value=e.keyword||``},onReset:()=>{R.value=``}}},me=l();function G(e){return re(e)||_}let he=i(()=>({columns:[{title:`菜单名称`,dataIndex:`title`,width:200,slot:`title`},{title:`类型`,dataIndex:`type`,width:80,align:`center`,slot:`type`},{title:`路由路径`,dataIndex:`path`,width:160,ellipsis:!0},{title:`组件`,dataIndex:`component`,width:140,ellipsis:!0},{title:`图标`,dataIndex:`icon`,width:70,align:`center`,slot:`icon`},{title:`排序`,dataIndex:`sort`,width:60,align:`center`},{title:`状态`,dataIndex:`status`,width:80,slot:`status`},{title:`可见`,dataIndex:`hidden`,width:60,align:`center`,slot:`hidden`},{title:`缓存`,dataIndex:`keepAlive`,width:60,align:`center`,slot:`keepAlive`},{title:`外链`,dataIndex:`external`,width:60,align:`center`,slot:`external`}],childrenColumnName:`children`,indentSize:20,expandable:{defaultExpandAllRows:!0},pagination:!1,actions:[{text:`编辑`,type:`primary`,onClick:e=>be(e)},{text:`删除`,type:`danger`,confirm:!0,confirmText:`确定要删除该菜单吗？子菜单也会被删除，此操作不可恢复。`,onClick:e=>Ce(e.id)}],actionWidth:150,actionFixed:`right`})),K=l(!1),q=l(!1),J=l(null);function Y(){return{name:``,title:``,path:``,component:``,icon:``,parentId:null,sort:0,status:`active`,hidden:!1,keepAlive:!1,external:!1,permission:``,type:`menu`}}let X=l(Y()),Z=l({id:``,...Y()});y(()=>X.value.path,e=>{if(e&&!X.value.component){let t=e.startsWith(`/`)?e.slice(1):e;X.value.component=t?`${t}/index`:``}}),i(()=>[{label:`顶级菜单`,value:null},...(I.value||[]).map(e=>({label:e.title,value:e.id}))]);let ge=i(()=>{let e=t=>t.map(t=>({title:t.title,value:t.id,key:t.id,children:t.children?e(t.children):void 0}));return[{title:`顶级菜单`,value:``,key:`root`,children:e(V.value)}]}),_e=[{label:`目录`,value:`directory`,color:`blue`},{label:`菜单`,value:`menu`,color:`green`},{label:`按钮`,value:`button`,color:`orange`}];function Q(e){return[{name:`type`,type:`select`,label:`菜单类型`,placeholder:`请选择菜单类型`,options:_e,disabled:e,rules:[{required:!0,message:`请选择菜单类型`}]},{name:`title`,type:`input`,label:`菜单标题`,placeholder:`请输入菜单标题`,rules:[{required:!0,message:`菜单标题不能为空`},{min:2,message:`菜单标题至少2个字符`}]},{name:`name`,type:`input`,label:`路由名称`,placeholder:`请输入路由名称`,disabled:e,dependencies:{field:`type`,condition:e=>e!==`button`},rules:[{required:!0,message:`路由名称不能为空`},{pattern:/^[A-Za-z0-9_-]+$/,message:`名称只能包含字母、数字、下划线和横线`}]},{name:`path`,type:`input`,label:`路由路径`,placeholder:`请输入路由路径，如 /system/user`,dependencies:{field:`type`,condition:e=>e!==`button`},rules:[{required:!0,message:`路由路径不能为空`},{pattern:/^\/[A-Za-z0-9/_-]*$/,message:`路径格式不正确`}]},{name:`component`,type:`input`,label:`组件路径`,placeholder:`请输入组件路径，如 system/user/index`,dependencies:{field:`type`,condition:e=>e===`menu`},rules:[{required:!0,message:`组件路径不能为空`}]},{name:`parentId`,type:`tree-select`,label:`上级菜单`,placeholder:`请选择上级菜单`,options:ge.value,disabled:e,props:{treeDefaultExpandAll:!0,allowClear:!0,showSearch:!0,treeNodeFilterProp:`title`}},{name:`icon`,type:`icon`,label:`图标`,placeholder:`请选择图标`,dependencies:{field:`type`,condition:e=>e!==`button`},props:{showClear:!0,showCategoryTabs:!0,popupWidth:840,columns:10}},{name:`sort`,type:`number`,label:`排序`,placeholder:`请输入排序号`,min:0},{name:`permission`,type:`input`,label:`权限标识`,placeholder:`请输入权限标识，如 system:user:view`,dependencies:{field:`type`,condition:e=>e===`button`}},{name:`status`,type:`select`,label:`状态`,placeholder:`请选择状态`,options:[{label:`启用`,value:`active`},{label:`禁用`,value:`inactive`}],rules:[{required:!0,message:`请选择状态`}]},{name:`hidden`,type:`switch`,label:`隐藏菜单`,checkedChildren:`是`,unCheckedChildren:`否`,dependencies:{field:`type`,condition:e=>e!==`button`}},{name:`keepAlive`,type:`switch`,label:`缓存页面`,checkedChildren:`是`,unCheckedChildren:`否`,dependencies:{field:`type`,condition:e=>e===`menu`}},{name:`external`,type:`switch`,label:`外部链接`,checkedChildren:`是`,unCheckedChildren:`否`,dependencies:{field:`type`,condition:e=>e===`menu`}}]}let ve=i(()=>({layout:`horizontal`,columns:2,labelCol:{span:8},wrapperCol:{span:16},fields:Q(!1),actions:{showSubmit:!0,showReset:!0,submitText:`添加菜单`,resetText:`取消`,align:`right`,onReset:()=>{K.value=!1}}})),ye=i(()=>({layout:`horizontal`,columns:2,labelCol:{span:8},wrapperCol:{span:16},fields:Q(!0),actions:{showSubmit:!0,showReset:!0,submitText:`保存修改`,resetText:`取消`,align:`right`,onReset:()=>{q.value=!1}}}));function be(e){J.value=e,Z.value={id:e.id,name:e.name,title:e.title,path:e.path,component:e.component,icon:e.icon,parentId:e.parentId,sort:e.sort,status:e.status,hidden:e.hidden,keepAlive:e.keepAlive,external:e.external,permission:e.permission,type:e.type},q.value=!0}function xe(e){H(e)}function Se(e){J.value&&U({id:J.value.id,values:e})}function Ce(e){de(e)}function $(e){let t=e.status===`active`?`inactive`:`active`;fe({id:e.id,status:t})}function we(){X.value=Y()}let Te=i(()=>{let e=I.value||[],t=e.length;e.filter(e=>e.status===`active`).length,e.filter(e=>!e.hidden).length;let n=e.filter(e=>e.type===`directory`).length,r=e.filter(e=>e.type===`menu`).length,i=e.filter(e=>e.type===`button`).length;return[{title:`菜单总数`,value:t,icon:_,color:`text-blue-500`},{title:`目录`,value:n,icon:b,color:`text-cyan-500`},{title:`菜单`,value:r,icon:ne,color:`text-green-500`},{title:`按钮`,value:i,icon:v,color:`text-orange-500`}]});return(e,i)=>(g(),x(`div`,k,[f(p(D),{title:`菜单管理`,subtitle:`管理系统导航菜单和路由配置`,actions:[{text:`添加菜单`,type:`primary`,iconName:`Plus`,onClick:()=>K.value=!0}]},null,8,[`actions`]),o(`div`,A,[(g(!0),x(t,null,m(p(Te),e=>(g(),c(p(T),{key:e.title,title:e.title,value:e.value,icon:e.icon,color:e.color,size:`sm`},null,8,[`title`,`value`,`icon`,`color`]))),128))]),o(`div`,j,[f(p(S),{modelValue:p(W),"onUpdate:modelValue":i[0]||=e=>u(W)?W.value=e:null,schema:pe},null,8,[`modelValue`])]),f(p(oe),{class:`bg-muted/40 border border-border/50 rounded-xl`},{default:n(()=>[f(p(ce),{class:`pb-4`},{default:n(()=>[f(p(le),{class:`text-base font-semibold`},{default:n(()=>[...i[6]||=[ee(`菜单结构`,-1)]]),_:1})]),_:1}),f(p(se),{class:`pt-0`},{default:n(()=>[f(p(ae),{ref_key:`tableRef`,ref:me,data:p(V),"onUpdate:data":i[1]||=e=>u(V)?V.value=e:null,schema:p(he),loading:p(L)},{title:n(({text:e,record:t})=>[o(`div`,M,[t?(g(),c(h(G(t.icon)),{key:0,class:`h-4 w-4 text-muted-foreground`})):d(``,!0),o(`span`,N,s(e),1)])]),icon:n(({text:e})=>[e?(g(),c(h(G(e)),{key:0,class:`h-4 w-4 text-muted-foreground mx-auto`})):(g(),x(`span`,P,`-`))]),type:n(({text:e})=>[e?(g(),c(p(E),{key:0,status:e,"status-map":{directory:{text:`目录`,color:`info`},menu:{text:`菜单`,color:`success`},button:{text:`按钮`,color:`warning`}}},null,8,[`status`])):d(``,!0)]),status:n(({text:e,record:t})=>[t?(g(),c(p(E),{key:0,status:e,"status-map":{active:{text:`启用`,color:`success`},inactive:{text:`禁用`,color:`default`}},clickable:``,onClick:e=>$(t)},null,8,[`status`,`onClick`])):d(``,!0)]),hidden:n(({text:e})=>[e?(g(),c(p(te),{key:1,class:`h-4 w-4 text-gray-400 mx-auto`})):(g(),c(p(v),{key:0,class:`h-4 w-4 text-green-500 mx-auto`}))]),keepAlive:n(({text:e})=>[f(p(ie),{checked:e,size:`small`,disabled:``,class:`mx-auto`},null,8,[`checked`])]),external:n(({text:e})=>[e?(g(),c(p(r),{key:0,class:`h-4 w-4 text-blue-500 mx-auto`})):(g(),x(`span`,F,`-`))]),emptyText:n(()=>[f(p(O),{type:`data`,title:`暂无菜单数据`,description:`开始添加您的第一个菜单吧`,action:{text:`添加菜单`,type:`primary`,iconName:`Plus`,onClick:()=>K.value=!0}},null,8,[`action`])]),_:1},8,[`data`,`schema`,`loading`])]),_:1})]),_:1}),f(p(C),{open:p(K),"onUpdate:open":i[3]||=e=>u(K)?K.value=e:null,title:`添加菜单`,width:`800`,footer:null},{default:n(()=>[f(p(S),{modelValue:p(X),"onUpdate:modelValue":i[2]||=e=>u(X)?X.value=e:null,schema:p(ve),onSubmit:xe},null,8,[`modelValue`,`schema`])]),_:1},8,[`open`]),f(p(C),{open:p(q),"onUpdate:open":i[5]||=e=>u(q)?q.value=e:null,title:`编辑菜单`,width:`800`,footer:null},{default:n(()=>[p(J)?(g(),c(p(S),{key:0,modelValue:p(Z),"onUpdate:modelValue":i[4]||=e=>u(Z)?Z.value=e:null,schema:p(ye),onSubmit:Se},null,8,[`modelValue`,`schema`])):d(``,!0)]),_:1},8,[`open`])]))}});export{I as default};