import"./ScrollArea-DFVXjTz0.js";import"./RovingFocusItem-CVjkq2qt.js";import"./Presence-3Lrzvetv.js";import"./defu-DUbmuhNq.js";import"./TabsTrigger-DqwypIQj.js";import{Ai as e,Ca as t,Fi as n,Gi as r,Hi as i,Ii as a,Ka as o,Li as s,Na as c,Oa as l,Qn as u,Ri as d,Ui as f,Va as p,Xt as m,Y as h,ca as g,l as _,oa as v,zi as y}from"./index-D6Cod0pL.js";import"./en_US-LGbIKe0x.js";import"./common-HQCQB71w.js";import"./zh_CN-Cgumeokr.js";import"./useFullscreen-lrjpQVTw.js";import"./_plugin-vue_export-helper-Dey4FfNi.js";import{N as ee}from"./dist-D3XftLPo.js";import"./theme-shared-BpTdpb0d.js";import{t as b}from"./TTable-B13ZnM5N.js";import"./useTableColumns-qs-cYpaB.js";import{t as x}from"./TForm-Drq7Qn9R.js";import"./TIcon-C-hNhMC1.js";import{t as S}from"./TModal-OyBXzO5K.js";import{n as te,t as ne}from"./CardContent-CMuL0LxG.js";import{n as re,t as ie}from"./CardTitle-D06OZslX.js";import{n as C,r as w}from"./composables-CTAVZAup.js";import"./business-DYFIcNWr.js";import{t as T}from"./TDataCard-C7I9agpQ.js";import{t as E}from"./TStatusBadge-DZzFEG5C.js";import{t as D}from"./TPageHeader-CTxQMWSB.js";import{t as ae}from"./TEmptyState-B9XitPgC.js";import"./TBatchActions-CX-6FAVm.js";var O={class:`space-y-6`},k={class:`flex flex-wrap gap-3`},A={class:`bg-muted/40 border border-border/50 rounded-xl px-3 py-3`},j={class:`flex items-center gap-2`},M={class:`font-medium`},N=r({__name:`index`,setup(r){let{data:N,loading:P,searchQuery:F,fetchData:I}=C({apiCall:async e=>await u.getOrganizations(e)||{list:[],total:0,page:1,pageSize:10},apiCallParams:e=>({search:e.searchQuery})});function L(e){let t=new Map,n=[];return e.forEach(e=>{t.set(e.id,{...e})}),e.forEach(e=>{let r=t.get(e.id);if(e.parentId&&t.has(e.parentId)){let n=t.get(e.parentId);n.children||=[],n.children.push(r),n.children.sort((e,t)=>e.sort-t.sort)}else n.push(r)}),n.sort((e,t)=>e.sort-t.sort)}let R=n(()=>L(N.value)),{mutate:z}=w({mutationFn:e=>u.createOrganization({name:e.name,code:e.code,parentId:e.parentId||null,leader:e.leader,description:e.description,sort:e.sort||0,status:e.status}),successMessage:`部门创建成功`,onSuccess:()=>{q.value=!1,me(),I()}}),{mutate:B}=w({mutationFn:({id:e,values:t})=>u.updateOrganization(e,{name:t.name,code:t.code,parentId:t.parentId||null,leader:t.leader,description:t.description,sort:t.sort,status:t.status}),successMessage:`部门更新成功`,onSuccess:()=>{J.value=!1,Y.value=null,I()}}),{mutate:V}=w({mutationFn:e=>u.deleteOrganization(e),successMessage:`部门删除成功`,onSuccess:()=>I()}),{mutate:H}=w({mutationFn:({id:e,status:t})=>u.updateOrganizationStatus(e,t),successMessage:`状态更新成功`,onSuccess:()=>I()}),U=c({keyword:``}),W={layout:`inline`,fields:[{name:`keyword`,type:`input`,label:``,placeholder:`搜索部门名称或编码...`,className:`w-[280px]`}],searchConfig:{enabled:!0,collapsed:!1,showCollapseButton:!1,searchText:`搜索`,resetText:`重置`,showReset:!0,onSearch:e=>{F.value=e.keyword||``},onReset:()=>{F.value=``}}},G=c(),K=n(()=>({columns:[{title:`部门名称`,dataIndex:`name`,width:220,slot:`name`},{title:`部门编码`,dataIndex:`code`,width:140,ellipsis:!0},{title:`负责人`,dataIndex:`leader`,width:120},{title:`成员数`,dataIndex:`memberCount`,width:80,align:`center`},{title:`排序`,dataIndex:`sort`,width:60,align:`center`},{title:`状态`,dataIndex:`status`,width:80,slot:`status`},{title:`创建时间`,dataIndex:`createdAt`,width:160}],childrenColumnName:`children`,indentSize:20,expandable:{defaultExpandAllRows:!0},pagination:!1,actions:[{text:`编辑`,type:`primary`,onClick:e=>le(e)},{text:`删除`,type:`danger`,confirm:!0,confirmText:`确定要删除该部门吗？子部门也会被删除，此操作不可恢复。`,onClick:e=>fe(e.id)}],actionWidth:150,actionFixed:`right`})),q=c(!1),J=c(!1),Y=c(null);function X(){return{name:``,code:``,parentId:null,leader:``,description:``,sort:0,status:`active`}}let Z=c(X()),Q=c({id:``,...X()});n(()=>[{label:`顶级部门`,value:null},...(N.value||[]).map(e=>({label:e.name,value:e.id}))]);let oe=n(()=>{let e=t=>t.map(t=>({title:t.name,value:t.id,key:t.id,children:t.children?e(t.children):void 0}));return[{title:`顶级部门`,value:``,key:`root`,children:e(R.value)}]});function $(e){return[{name:`name`,type:`input`,label:`部门名称`,placeholder:`请输入部门名称`,rules:[{required:!0,message:`部门名称不能为空`},{min:2,message:`部门名称至少2个字符`}]},{name:`code`,type:`input`,label:`部门编码`,placeholder:`请输入部门编码`,disabled:e,rules:[{required:!0,message:`部门编码不能为空`},{pattern:/^[A-Za-z0-9_-]+$/,message:`编码只能包含字母、数字、下划线和横线`}]},{name:`parentId`,type:`tree-select`,label:`上级部门`,placeholder:`请选择上级部门`,options:oe.value,disabled:e,props:{treeDefaultExpandAll:!0,allowClear:!0,showSearch:!0,treeNodeFilterProp:`title`}},{name:`leader`,type:`input`,label:`负责人`,placeholder:`请输入负责人姓名`},{name:`sort`,type:`number`,label:`排序`,placeholder:`请输入排序号`,min:0},{name:`status`,type:`select`,label:`状态`,placeholder:`请选择状态`,options:[{label:`启用`,value:`active`},{label:`禁用`,value:`inactive`}],rules:[{required:!0,message:`请选择状态`}]},{name:`description`,type:`textarea`,label:`描述`,placeholder:`请输入部门描述`,rows:3}]}let se=n(()=>({layout:`horizontal`,columns:2,labelCol:{span:8},wrapperCol:{span:16},fields:$(!1),actions:{showSubmit:!0,showReset:!0,submitText:`添加部门`,resetText:`取消`,align:`right`,onReset:()=>{q.value=!1}}})),ce=n(()=>({layout:`horizontal`,columns:2,labelCol:{span:8},wrapperCol:{span:16},fields:$(!0),actions:{showSubmit:!0,showReset:!0,submitText:`保存修改`,resetText:`取消`,align:`right`,onReset:()=>{J.value=!1}}}));function le(e){Y.value=e,Q.value={id:e.id,name:e.name,code:e.code,parentId:e.parentId,leader:e.leader,description:e.description,sort:e.sort,status:e.status},J.value=!0}function ue(e){z(e)}function de(e){Y.value&&B({id:Y.value.id,values:e})}function fe(e){V(e)}function pe(e){let t=e.status===`active`?`inactive`:`active`;H({id:e.id,status:t})}function me(){Z.value=X()}let he=n(()=>{let e=N.value||[],t=e.length,n=e.filter(e=>e.status===`active`).length,r=e.filter(e=>e.parentId===null).length,i=e.reduce((e,t)=>e+(t.memberCount||0),0);return[{title:`部门总数`,value:t,icon:m,color:`text-blue-500`},{title:`启用部门`,value:n,icon:h,color:`text-green-500`},{title:`顶级部门`,value:r,icon:m,color:`text-purple-500`},{title:`总成员数`,value:i,icon:_,color:`text-orange-500`}]});return(n,r)=>(v(),y(`div`,O,[f(p(D),{title:`组织架构`,subtitle:`管理部门组织架构和层级关系`,actions:[{text:`添加部门`,type:`primary`,iconName:`Plus`,onClick:()=>q.value=!0}]},null,8,[`actions`]),a(`div`,k,[(v(!0),y(e,null,g(p(he),e=>(v(),s(p(T),{key:e.title,title:e.title,value:e.value,icon:e.icon,color:e.color,size:`sm`},null,8,[`title`,`value`,`icon`,`color`]))),128))]),a(`div`,A,[f(p(x),{modelValue:p(U),"onUpdate:modelValue":r[0]||=e=>l(U)?U.value=e:null,schema:W},null,8,[`modelValue`])]),f(p(te),{class:`bg-muted/40 border border-border/50 rounded-xl`},{default:t(()=>[f(p(re),{class:`pb-4`},{default:t(()=>[f(p(ie),{class:`text-base font-semibold`},{default:t(()=>[...r[6]||=[i(`部门结构`,-1)]]),_:1})]),_:1}),f(p(ne),{class:`pt-0`},{default:t(()=>[f(p(b),{ref_key:`tableRef`,ref:G,data:p(R),"onUpdate:data":r[1]||=e=>l(R)?R.value=e:null,schema:p(K),loading:p(P)},{name:t(({text:e,record:n})=>[a(`div`,j,[f(p(m),{class:`h-4 w-4 text-muted-foreground`}),a(`span`,M,o(e),1),n?.memberCount?(v(),s(p(ee),{key:0,variant:`outline`,class:`text-xs bg-muted/50`},{default:t(()=>[i(o(n.memberCount)+`人 `,1)]),_:2},1024)):d(``,!0)])]),status:t(({text:e,record:t})=>[t?(v(),s(p(E),{key:0,status:e,"status-map":{active:{text:`启用`,color:`success`},inactive:{text:`禁用`,color:`default`}},clickable:``,onClick:e=>pe(t)},null,8,[`status`,`onClick`])):d(``,!0)]),emptyText:t(()=>[f(p(ae),{type:`data`,title:`暂无部门数据`,description:`开始添加您的第一个部门吧`,action:{text:`添加部门`,type:`primary`,iconName:`Plus`,onClick:()=>q.value=!0}},null,8,[`action`])]),_:1},8,[`data`,`schema`,`loading`])]),_:1})]),_:1}),f(p(S),{open:p(q),"onUpdate:open":r[3]||=e=>l(q)?q.value=e:null,title:`添加部门`,width:`700`,footer:null},{default:t(()=>[f(p(x),{modelValue:p(Z),"onUpdate:modelValue":r[2]||=e=>l(Z)?Z.value=e:null,schema:p(se),onSubmit:ue},null,8,[`modelValue`,`schema`])]),_:1},8,[`open`]),f(p(S),{open:p(J),"onUpdate:open":r[5]||=e=>l(J)?J.value=e:null,title:`编辑部门`,width:`700`,footer:null},{default:t(()=>[p(Y)?(v(),s(p(x),{key:0,modelValue:p(Q),"onUpdate:modelValue":r[4]||=e=>l(Q)?Q.value=e:null,schema:p(ce),onSubmit:de},null,8,[`modelValue`,`schema`])):d(``,!0)]),_:1},8,[`open`])]))}});export{N as default};