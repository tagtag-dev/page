import{$r as e,Ar as t,Br as n,Cr as r,Dr as i,Er as a,Fr as o,Gr as s,Hr as c,Ir as l,Jr as u,Kr as d,Lr as f,Mr as p,Nr as m,On as h,Or as g,Pr as _,Qr as v,Rn as y,Rr as b,Sr as x,Tr as S,Ur as C,Vr as w,Wr as T,Xr as E,Yr as D,Zr as O,_i as k,_r as A,ar as j,bn as M,br as N,cr as P,dr as F,ei as I,fr as L,ga as R,gr as z,hr as B,ir as ee,jr as te,kr as ne,lr as V,mr as re,na as H,nr as ie,or as ae,pr as oe,qr as U,rr as se,sr as ce,ur as le,vr as ue,wr as de,xr as W,yr as fe,zr as pe}from"./index-D9LA8apy.js";var me=(e,t)=>{let n=null;return function(...r){let i=e.bind(this,...r),a=te(t)?t:t(...r);n&&re(n),a>0?n=u(i,a):i()}},he=(e,t)=>{let n={};for(let r in e)n[r]=t(e[r],r,e);return n},G;(function(e){e[e.USE_REQUEST=1]=`USE_REQUEST`,e[e.USE_WATCHER=2]=`USE_WATCHER`,e[e.USE_FETCHER=3]=`USE_FETCHER`})(G||={});function ge(e,r={trackedKeys:{},bindError:!1,initialRequest:!1,...i()}){let s=t=>e.ref?e.ref(t):{current:t};r=s(r).current;let c=t=>(e.export||ce)(t,r),u=n=>{if(!t(e.memorize))return n;let r=e.memorize(n);return r.memorized=!0,r},{dehydrate:d}=e,p=(t,n,i)=>t!==d(n,i,r)&&r.trackedKeys[i]&&e.update(t,n,i,r),m=e=>o(e,e=>g(e,V)?e.e:e),h=[],_={};return{create:(t,n)=>(U(h,n),l(le,e.create(t,n,r),n,e=>d(e,n,r),c,(e,t)=>p(t,e,n))),computed:(t,n,i)=>(W(n,e=>{e.k&&(_[e.k]=!0)}),l(V,e.computed(t,m(n),i,r),i,e=>d(e,i,r),c)),effectRequest:t=>e.effectRequest(t,r),ref:s,watch:(t,n)=>e.watch(m(t),n,r),onMounted:t=>e.onMounted(t,r),onUnmounted:t=>e.onUnmounted(t,r),memorize:u,__referingObj:r,exposeProvider:e=>{let i={},o={},s=[];for(let n in e){let c=e[n];if(t(c)&&!r.trackedKeys[n])i[n]=n.startsWith(`on`)?(...e)=>(c(...e),m):c.memorized?c:u(c);else{!a([`uploading`,`downloading`],n)&&!n.startsWith(`__`)&&U(s,n);let e=g(c,V);e&&(o[n]=c.s),F.defineProperty(i,n,{get:()=>(r.trackedKeys[n]=!0,e?c.e:c),set:f,enumerable:!0,configurable:!0})}}let{update:c,__proxyState:l}=i;r.trackedKeys={..._},r.bindError=!1;let{then:d}=i,m=pe(i,{__referingObj:r,update:u(e=>{n(e).forEach(n=>{a(h,n)?p(e[n],o[n],n):n in i&&t(c)&&c({[n]:e[n]})})}),__proxyState:u(t=>a(h,t)&&g(e[t],V)?(r.trackedKeys[t]=!0,e[t]):l(t)),then(e,n){W(s,e=>{r.trackedKeys[e]=!0});let i=()=>{ue(m,`then`),e(m)};t(d)?d(i,n):i()}});return m},objectify:(e,t)=>e.reduce((e,n)=>(e[n.k]=t?n[t]:n,e),{}),transformState2Proxy:(e,t)=>l(le,e,t,e=>d(e,t,r),c,(e,n)=>p(n,e,t))}}B(``);var _e=B(`useRequest`),ve=B(`useWatcher`),ye=B(`useFetcher`),be=e=>({[G.USE_REQUEST]:_e,[G.USE_WATCHER]:ve,[G.USE_FETCHER]:ye})[e],xe=(e,t)=>e(g(t,se),`expected a method instance.`),K=`success`,q=`error`,J=`complete`,Se=(e,t,n,r)=>({m:void 0,rf:{},fs:{},em:n,ht:e,c:t,ro:r,ms:{}}),Y=class e{constructor(e,t){this.method=e,this.args=t}clone(){return{...this}}static spawn(t,n){return l(e,t,n)}},Ce=class extends Y{constructor(e,t,n){super(e.method,e.args),this.data=t,this.fromCache=n}},we=class extends Y{constructor(e,t){super(e.method,e.args),this.error=t}},Te=class extends Y{constructor(e,t,n,r,i){super(e.method,e.args),this.status=t,this.data=n,this.fromCache=t===`error`?!1:r,this.error=i}},Ee=(e,t)=>t(),De={},Oe=(e,t)=>{let n=De[e]||{};return n[t]?Array.from(n[t]):[]},ke=(e,t,n)=>{let r=De[e]=De[e]||{};r[t]||(r[t]=l(Set)),r[t].add(n)},Ae=(e,t,n)=>{let r=De[e],i=r[t];r&&i&&(n?i.delete(n):i.clear(),i.size===0&&ue(r,t))};function je(e,t,n=[]){let i=be(e.ht),a=r(t,i,n),{fs:o,ht:u,c:p}=e,{loading:m,data:h,error:g}=o,_=u===G.USE_FETCHER,{force:v=!1,middleware:y=Ee}=p,{id:b}=x(a),S=de(a),{abortLast:C=!0}=p,w=!e.m;return e.m=a,(async()=>{let r=f,x=!1,T=s(void 0),E=f,O=f,k=await ae(a),A=()=>!!k,j=!1;_||(ke(b,S,e),r=()=>Ae(b,S,e));let M=t=>{x=!0;let{force:i=v,method:s=a}=t||{},c=D(i,[l(Y,a,n)]),u=e=>({loaded:t,total:n})=>{o[e].v={loaded:t,total:n}};a=s,e.rf[S]=r,j||(m.v=!!c||!k);let{downloading:d,uploading:f}=e.ro.trackedKeys;return E=d?a.onDownload(u(`downloading`)):E,O=f?a.onUpload(u(`uploading`)):O,T=a.send(c),A=()=>a.fromCache||!1,T},N={method:a,cachedResponse:k,config:p,abort:()=>a.abort()},P=()=>u!==G.USE_WATCHER||!C||e.m===a,F=(e=!0)=>{e&&w&&(m.v=!1),j=e},I=y(_?{...N,args:n,fetch:(t,...n)=>(xe(i,t),je(e,t,n)),proxyStates:c(o,`data`),controlLoading:F}:{...N,args:n,send:(...n)=>je(e,t,n),proxyStates:o,controlLoading:F},M),L,R=Y.spawn(a,n);try{let t=await I,n=t=>(_?e.c.updateState!==!1&&W(Oe(b,S),e=>{e.fs.data.v=t}):P()&&(h.v=t),P()&&(g.v=void 0,!j&&(m.v=!1),e.em.emit(K,l(Ce,R,t,A())),e.em.emit(J,l(Te,R,K,t,A(),void 0))),t);L=t===void 0?x?await d(T,n,()=>n(void 0)):void 0:n(t),!x&&!j&&(m.v=!1)}catch(t){throw P()&&(g.v=t,!j&&(m.v=!1),e.em.emit(q,l(we,R,t)),e.em.emit(J,l(Te,R,q,void 0,A(),t))),t}return E(),O(),L})()}var X=e=>e.current;function Me(n,i,a,o,s=!1,c,l=0){a={...a};let f=!!s,p;if(s)try{let e=r(i,be(n)),t=x(e),o=t.l1Cache.get(oe(t.id,de(e)));if(o&&!g(o,L)){let[e,t]=o;(!t||t>S())&&(p=e)}f=!!D(a.force??!1)||!p}catch{}let{create:m,effectRequest:h,ref:_,objectify:v,exposeProvider:y,transformState2Proxy:b,__referingObj:C}=ge(j(),a.__referingObj),T={total:0,loaded:0},{managedStates:E={}}=a,O=he(E,(e,t)=>b(e,t)),k=m(p??(t(o)?o():o),`data`),M=m(f,`loading`),N=m(void 0,`error`),P=m({...T},`downloading`),F=m({...T},`uploading`),I=v([k,M,N,P,F]),R=z(),B=X(_(Se(n,a,R,C)));B.fs=I,B.em=R,B.c=a,B.ms={...I,...O};let V=c!==void 0,re=(e=i,t)=>je(B,e,t),H=_(void 0),ie=_(!1),ae=X(_(A())),U=(e=C,t)=>{ae(()=>{(!ee.ssr||X(H))&&(C.initialRequest=ie.current=!0,d(re(t),()=>{var e;(e=X(H))==null||e.resolve()},t=>{var n;if(!e.bindError&&!e.trackedKeys.error&&!X(H))throw t;(n=X(H))==null||n.reject(t)}))})},se=_(me((e,t,n)=>U(t,n),e=>te(e)?ne(l)?l[e]:l:0));h({handler:V?e=>se.current(e,C,i):()=>U(C),removeStates:()=>{W(w(B.rf),e=>e())},frontStates:{...I,...O},watchingStates:c,immediate:s??!0});let ce=y({...v([k,M,N,P,F]),abort:()=>B.m&&B.m.abort(),send:(e,t)=>re(t,e),onSuccess(e){R.on(K,e)},onError(e){C.bindError=!0,R.on(q,e)},onComplete(e){R.on(J,e)},then(t,n){let{promise:r,resolve:i,reject:a}=e();H.current={resolve:i,reject:a},u(()=>{!ie.current&&i()},10),d(r,()=>{t(ce)},n)}});return ce}function Ne(e={}){let t=Me(G.USE_FETCHER,f,e),{send:n}=t;return ue(t,`send`),pe(t,{fetch:(e,...t)=>(xe(ye,e),n(t,e))})}function Pe(e,t={}){let{immediate:n=!0,initialData:r}=t,i=Me(G.USE_REQUEST,e,t,r,!!n),{send:a}=i;return pe(i,{send:(...e)=>a(e)})}B(`usePagination`);var Fe=`valueOf`,Ie;z(),B(`useSQRequest`);var Le=Symbol(`vdid`),Re=e=>{let t=e?.[Le];t&&Ie&&(Ie[t]=void 0)},ze=(e,t=!0)=>{Re(e);let n=e?.[Le];return(n?`[vd:${n}]`:void 0)||(t?e:void 0)};function Be(){return ze(this)}var Ve=function(){};Ve.prototype=F.create(null,{[Fe]:I(Be)});var He=function(){};He.prototype=F.create(null,{[Fe]:I(Be)});var Z=class{constructor(e,t={}){this.cancelBubble=!1,this.currentTarget=null,this.defaultPrevented=!1,this.eventPhase=0,this.isTrusted=!1,this.returnValue=!0,this.srcElement=null,this.target=null,this.NONE=0,this.CAPTURING_PHASE=1,this.AT_TARGET=2,this.BUBBLING_PHASE=3,this.type=e,this.bubbles=t.bubbles??!1,this.cancelable=t.cancelable??!1,this.composed=t.composed??!1,this.timeStamp=Date.now()}preventDefault(){this.cancelable&&(this.defaultPrevented=!0)}stopImmediatePropagation(){}stopPropagation(){this.cancelBubble=!0}composedPath(){return[]}initEvent(e,t,n){}};Z.NONE=0,Z.CAPTURING_PHASE=1,Z.AT_TARGET=2,Z.BUBBLING_PHASE=3;var Ue=typeof Event<`u`?Event:Z,We=class extends Ue{constructor(e,t){super(e,{bubbles:!0,cancelable:!0,composed:!0}),this.data=t.data,this.lastEventId=t.lastEventId,this.origin=t.origin||``,this.error=t.error}},Ge=B(`EventSourceFetch`),Ke=class e{constructor(t,n,r={}){this.CONNECTING=0,this.OPEN=1,this.CLOSED=2,this.onopen=null,this.onmessage=null,this.onerror=null,this._listeners={},this._reconnectTime=null,this._controller=null,this._lastEventId=``,this._origin=``,this.url=t,this.readyState=e.CONNECTING,this._options={...r},this._reconnectTime=n,this._origin=l(URL,t,window.location.href).origin,t&&u(()=>this._connect())}addEventListener(e,t){this._listeners[e]=this._listeners[e]||[],this._listeners[e].find(e=>e===t||p(e)&&p(t)&&e?.handleEvent===t.handleEvent)||this._listeners[e].push(t)}removeEventListener(e,t){!t||!this._listeners[e]||(this._listeners[e]=N(this._listeners[e],e=>e!==t&&!(typeof e==`object`&&typeof t==`object`&&e?.handleEvent===t.handleEvent)))}dispatchEvent(e){if(!(e instanceof We))return!0;let n=this._listeners[e.type]||[];for(let r of n)t(r)?r(e):r&&t(r.handleEvent)&&r.handleEvent(e);let r=`on${e.type}`,i=this[r];return t(i)&&i(e),!e.defaultPrevented}close(){this.readyState!==e.CLOSED&&(this.readyState=e.CLOSED,this._dispatchEvent(`close`,``),this._controller&&=(this._controller.abort(),null))}_connect(){if(this.readyState===e.CLOSED)return;this._controller=l(AbortController);let t=this._options,n=t.headers||{},r=[`Accept`,`text/event-stream`],i=`Last-Event-ID`,a=this._lastEventId;if(ne(n))U(n,r),a&&U(n,[i,a]);else if(g(n,Headers))n.append(r[0],r[1]),a&&n.append(i,a);else if(p(n)){let[e,t]=r;n[e]=t,a&&(n[i]=a)}let o={...t,headers:n,signal:this._controller.signal};fetch(this.url,o).then(t=>{Ge(t.ok,`HTTP error: ${t.status}`),Ge(t.body,`ReadableStream not supported`),this._origin=l(URL,t.url).origin,this.readyState=e.OPEN,this._dispatchEvent(`open`,``);let n=t.body.getReader(),r=new TextDecoder,i=``,a=({done:t,value:o})=>{if(t)return this.readyState!==e.CLOSED&&this._reconnect(),s();i+=r.decode(o,{stream:!0});let c=i.split(/\r\n|\r|\n/);return i=c.pop()||``,this._processEventStream(c),n.read().then(a).catch(t=>(t.name!==`AbortError`&&this.readyState!==e.CLOSED&&this._onError(t),s()))};return n.read().then(a).catch(t=>{t.name!==`AbortError`&&this.readyState!==e.CLOSED&&this._onError(t)})}).catch(t=>{t.name!==`AbortError`&&this.readyState!==e.CLOSED&&this._onError(t)})}_processEventStream(e){let t=`message`,n=``,r=null,i=null,a=()=>{if(n){if(n.endsWith(`
`)&&(n=n.substring(0,n.length-1)),r!==null&&(this._lastEventId=r),i!==null&&this._reconnectTime===null){let e=parseInt(i,10);Number.isNaN(e)||(this._reconnectTime=e)}this._dispatchEvent(t,n)}t=`message`,n=``,r=null,i=null};for(let o of e){if(o===``){a();continue}if(o.startsWith(`:`))continue;let e,s,c=o.indexOf(`:`);switch(c===-1?(e=o,s=``):(e=o.slice(0,c),s=o.slice(c+(o[c+1]===` `?2:1))),e){case`event`:t=s;break;case`data`:n=n?`${n}\n${s}`:s;break;case`id`:if(s.includes(`\0`))continue;r=s;break;case`retry`:i=s;break;default:throw l(P,`EventSource`,`EventSource: Unknown field "${e}", ignoring`)}}}_dispatchEvent(e,t){let n=l(We,e,{type:e,data:t,lastEventId:this._lastEventId,origin:this._origin});this.dispatchEvent(n)}_onError(t){let n=l(We,`error`,{type:`error`,data:``,lastEventId:this._lastEventId,origin:this._origin,error:t});this.dispatchEvent(n),this.readyState!==e.CLOSED&&this._reconnect()}_reconnect(){if(this._reconnectTime!==null&&this._reconnectTime<=0){this.close();return}this.readyState!==e.CLOSED&&(this.readyState=e.CONNECTING,u(()=>this._connect(),this._reconnectTime??1e3))}};Ke.CONNECTING=0,Ke.OPEN=1,Ke.CLOSED=2;var qe;(function(e){e[e.CONNECTING=0]=`CONNECTING`,e[e.OPEN=1]=`OPEN`,e[e.CLOSED=2]=`CLOSED`})(qe||={}),B(`useSSE`);var Je;(function(e){e.Open=`open`,e.Error=`error`,e.Message=`message`,e.Close=`close`})(Je||={});var Q=B(`useUploader`);function Ye(e,{limit:t=0,localLink:n,replaceSrc:r,mode:i}={}){let{create:s,computed:c,exposeProvider:u,ref:d}=ge(j()),f=z(),m=s([],`fileList`),h=c(()=>m.v[0],[m],`file`),g=s(!1,`uploading`),v=s(0,`successCount`),y=s(0,`failCount`),b=c(()=>({...m.v.reduce((e,{progress:t,status:n})=>(n!==0&&(e.total+=t.total,e.uploaded+=t.uploaded),e),{uploaded:0,total:0})}),[m],`progress`),x=c(()=>m.v.find(e=>e.error)?.error,[m],`error`),S=async(e={},r={})=>{let i=e,a=r;!e.file&&!ne(e)&&(a=e,i=[]);let s=ne(i)?i:[i];_(s)<=0&&(s=await Ye.selectFile(a)),Q(t<=0||_(m.v)+_(s)<=t,`The number of files exceeds the limit of ${t}`);let{converters:c}=Ye,l=await L.all(o(s,async e=>{let t=c.find(({is:t})=>t(e));Q(t,`Invalid file type, only ${o(c,({name:e})=>e).join(`, `)} are supported, if other file needs, customize convert function with \`useUploader.convertFile.push({ is: ..., convert: ... })\``);let r=await t.convert(e);return Q(r,`Failed to convert file`),{src:e.src||(n?URL.createObjectURL(r):void 0),file:r,status:0,progress:{uploaded:0,total:r.size}}})),u=a.start??_(m.v),d=N(l,Boolean),f=[...m.v];return E(f,u,0,...d),m.v=f,_(l)},w=(e,t=[1,2],n=`upload`)=>{let r={upload:`uploaded`,abort:`aborted`}[n],i=m.v;return _(e)>0?o(e,(e,n)=>{let o=te(e),s=o?i[e]:e,c=o?`index ${e}`:`position ${n}`;return Q(s,`The file of ${c} does not exist`),_(t)>0&&Q(!a(t,s.status)&&p(s.file),`The file of ${c} cannot be ${r}, which status is ${s.status}`),s}):N(i,e=>!a(t,e.status))},D=(e,t)=>N(e,e=>_(t)>0?a(t,e.status):!0),O=d([]),k=(e,t)=>{m.v.findIndex(t=>t.file===e)>-1&&U(O.current,{f:e,m:t})},A=e=>{O.current=N(O.current,({m:t})=>t!==e)},M=(...e)=>{let t=w(e,[0,2,3],`abort`),n=[];_(t)>0?W(t,({file:e})=>{let t=O.current.find(({f:t})=>t===e);t&&U(n,t.m)}):U(n,...o(O.current,({m:e})=>e));let r=[];return W(n,e=>{r.includes(e)||U(r,e)}),C(o(r,e=>e.abort()))},P=(...e)=>{let t=w(e,[]);_(t)>0?(M(...D(t,[1])),m.v=N(m.v,e=>!a(t,e)),v.v=_(D(m.v,[2])),y.v=_(D(m.v,[3]))):(M(...D(m.v,[1])),m.v=[])},F=(e,t,n)=>{let r=Y.spawn(e,[]);return{successEvent:l(Ce,r,t,!1),errorEvent:l(we,r,n),completeEvent:l(Te,r,n?q:K,t,!1,n)}},I=(e,t,n,i,a=0)=>{if(e.status=t,t===2){if(e.progress.uploaded=e.progress.total,r){let t=r(n,a);t&&(e.src=t)}}else t===3&&(e.error=i);m.v=[...m.v]},R=(t,n)=>{let r=e(n);return r.onUpload(e=>{W(t,t=>{t.progress.uploaded=e.loaded*(t.progress.total/e.total)})}),W(t,({file:e})=>k(e,r)),r.then(e=>{W(t,(t,n)=>I(t,2,e,void 0,n)),v.v=_(D(m.v,[2]));let{successEvent:n,completeEvent:i}=F(r,e);return f.emit(K,n),f.emit(J,i),e},e=>{W(t,t=>I(t,3,void 0,e)),y.v=_(D(m.v,[3]));let{errorEvent:n,completeEvent:i}=F(r,void 0,e);return f.emit(q,n),f.emit(J,i),e}).finally(()=>{g.v=!1,A(r)})},B=t=>{let n=o(t,(n,r)=>{let i=e({file:n.file,name:n.file.name});return i.onUpload(({loaded:e,total:n})=>{W(t,t=>{t.progress.uploaded=e,t.progress.total=n})}),k(n.file,i),i.then(e=>{I(n,2,e,void 0,r),v.v+=1;let{successEvent:t,completeEvent:a}=F(i,e);return f.emit(K,t),f.emit(J,a),e},e=>{I(n,3,void 0,e),y.v+=1;let{errorEvent:t,completeEvent:r}=F(i,void 0,e);return f.emit(q,t),f.emit(J,r),e}).finally(()=>{A(i)})});return T(L.all(n),()=>{g.v=!1})};return u({fileList:m,uploading:g,file:h,progress:b,successCount:v,failCount:y,error:x,appendFiles:S,removeFiles:P,upload:async(...e)=>{let t=w(e);W(t,e=>{e.status=1});let n=o(t,({file:e})=>({file:e,name:e.name}));return g.v=!0,i===`batch`?R(t,n):B(t)},abort:M,onSuccess:e=>{f.on(K,e)},onError:e=>{f.on(q,e)},onComplete:e=>{f.on(J,e)}})}Ye.selectFile=({multiple:e,accept:t}={})=>{let n=document.createElement(`input`);return n.type=`file`,n.multiple=!!e,t&&(n.accept=t),n.click(),l(Promise,e=>{n.addEventListener(`change`,()=>{e(o(Array.from(n.files||[]),e=>({file:e,name:e.name,mimeType:e.type})))})})};var Xe=`text/plain`;Ye.converters=[{name:`HTMLCanvasElement`,is:({file:e})=>g(e,HTMLCanvasElement),async convert({file:e,mimeType:t,name:n}){let r=await l(L,t=>e?.toBlob(t));if(r)return l(File,[r],n||`image.png`,{type:t||r.type})}},{name:`base64`,is:({file:e})=>m(e),convert({file:e=``,mimeType:t,name:n}){Q(/data:.+;base64,/.test(e),`Invalid base64 string`);let r=e.split(`,`),i=r[0].match(/:(.*?);/)?.[1],a=atob(r[1]),o=new Uint8Array(_(a));return W(Array.from(a),(e,t)=>{o[t]=e.charCodeAt(0)}),l(File,[o],n||`file`,{type:t||i||Xe})}},{name:`File`,is:({file:e})=>g(e,File),convert({file:e}){return e}},{name:`Blob`,is:({file:e})=>g(e,Blob),convert({file:e,name:t,mimeType:n}){return l(File,[e],t||`file`,{type:n||e.type||Xe})}},{name:`ArrayBuffer`,is:({file:e})=>g(e,ArrayBuffer),convert({file:e,name:t,mimeType:n}){return l(File,[l(Blob,[e])],t||`file`,{type:n||Xe})}}];var $=(e,t={})=>{let n=!0,{enableFocus:r=!0,enableVisibility:i=!0,enableNetwork:a=!0,pollingTime:o=0,throttle:s=1e3}=t,{onMounted:c,onUnmounted:l,__referingObj:u}=ge(j()),d=Pe(e,{...t,__referingObj:u}),p=()=>{n&&(d.send(),s>0&&(n=!1,setTimeout(()=>{n=!0},s)))},m=f,h=f,g=f,_=f;return c(()=>{ee.ssr||(m=a?$.onNetwork(p,t):m,h=r?$.onFocus(p,t):h,g=i?$.onVisibility(p,t):g,_=o>0?$.onPolling(p,t):_)}),l(()=>{m(),h(),g(),_()}),d},Ze=(e,t)=>(window.addEventListener(e,t),()=>window.removeEventListener(e,t));$.onNetwork=e=>Ze(`online`,e),$.onFocus=e=>Ze(`focus`,e),$.onVisibility=e=>Ze(`visibilitychange`,()=>document.visibilityState===`visible`&&e()),$.onPolling=(e,t)=>{let n=setInterval(e,t.pollingTime);return()=>clearInterval(n)},B(`useCaptcha`),z(),B(`useRetriableRequest`),B(`subscriber`);function Qe(e){let{mutationFn:t,onSuccess:n,onError:r,onComplete:i,successMessage:a=`操作成功`}=e,{loading:o,send:s,abort:c}=Ne();return{mutate:async e=>{try{let i=await s(t(e));if(i===null){let t=y(Error(`操作失败`));return r?.(t,e),null}return a!==!1&&ie.success(a),n?.(i,e),i}catch(t){let n=y(t);return r?.(n,e),null}finally{i?.()}},loading:o,abort:c}}function $e(e){let{apiCall:t,apiCallParams:n,immediate:r=!0,defaultPage:i=1,defaultPageSize:a=10,statisticsFn:o,onSuccess:s,onError:c}=e,l=R([]),u=R(!1),d=R(null),f=R(``),p=R({}),m=R(i),h=R(a),g=R(0),_=async()=>{u.value=!0,d.value=null;let e=n?n({page:m.value,pageSize:h.value,searchQuery:f.value,filters:p.value}):{page:m.value,pageSize:h.value};try{let n=await t(e);if(n===null){d.value=y(Error(`获取数据失败`)),l.value=[],g.value=0;return}l.value=n.list||[],g.value=n.total||0,s?.(n)}catch(e){d.value=y(e),l.value=[],g.value=0,c?.(d.value)}finally{u.value=!1}},v=M(_,300);H([m,h],()=>{_()},{immediate:r}),H([f,p],()=>{v()},{deep:!0});let b=k(()=>Math.ceil(g.value/h.value)),x=k(()=>{let e=l.value;return o?o(e)||{}:{total:g.value}});return{data:l,loading:u,error:d,searchQuery:f,filters:p,filteredData:k(()=>l.value),paginatedData:k(()=>l.value),currentPage:m,pageSize:h,totalPages:b,total:g,statistics:x,fetchData:_,resetFilters:()=>{f.value=``,p.value={},m.value=i},goToPage:e=>{e>=1&&e<=b.value&&(m.value=e)},nextPage:()=>{m.value<b.value&&m.value++},prevPage:()=>{m.value>1&&m.value--},setPageSize:e=>{h.value=e,m.value=1},addData:e=>{l.value=[e,...l.value],g.value+=1},updateData:(e,t)=>{let n=l.value.findIndex(t=>t.id===e);n!==-1&&(l.value[n]={...l.value[n],...t})},removeData:e=>{l.value=l.value.filter(t=>t.id!==e),g.value=Math.max(g.value-1,0)},batchRemoveData:e=>{let t=l.value.filter(t=>e.includes(t.id)).length;l.value=l.value.filter(t=>!e.includes(t.id)),g.value=Math.max(g.value-t,0)}}}var et=R(new Map);k(()=>et.value.size>0),k(()=>et.value.values().next().value?.text||`加载中...`),k(()=>et.value.values().next().value?.type||`default`);function tt(){let e=h(),t=t=>e.hasPermission(t),n=t=>t.length?t.some(t=>e.hasPermission(t)):!0,r=t=>t.length?t.every(t=>e.hasPermission(t)):!0;return{hasPermission:t,hasAnyPermission:n,hasAllPermissions:r,hasRole:t=>e.user?.role===t,hasAnyRole:t=>t.length?t.some(t=>e.user?.role===t):!0,checkPermission:(e,i=`all`)=>Array.isArray(e)?i===`any`?n(e):r(e):t(e),usePermissionRef:e=>k(()=>t(e)),isAdmin:k(()=>e.isAdmin),isAuthenticated:k(()=>e.isAuthenticated)}}export{$e as n,Qe as r,tt as t};