import"./ScrollArea-DFVXjTz0.js";import"./RovingFocusItem-CVjkq2qt.js";import"./Presence-3Lrzvetv.js";import"./defu-DUbmuhNq.js";import"./TabsTrigger-DqwypIQj.js";import{Ai as e,Ca as t,Fi as n,Gi as r,Hi as ee,Ii as i,J as a,Ka as o,Li as s,Lt as te,Na as c,Oa as l,Pt as ne,Ri as u,Ua as re,Ui as d,Va as f,Xn as p,_ as ie,ca as ae,fr as m,oa as h,pr as g,ut as oe,v as _,zi as v}from"./index-D6Cod0pL.js";import"./en_US-LGbIKe0x.js";import"./common-HQCQB71w.js";import"./zh_CN-Cgumeokr.js";import"./useFullscreen-lrjpQVTw.js";import"./_plugin-vue_export-helper-Dey4FfNi.js";import{P as se,w as y}from"./dist-D3XftLPo.js";import"./theme-shared-BpTdpb0d.js";import{t as ce}from"./TTable-B13ZnM5N.js";import"./useTableColumns-qs-cYpaB.js";import{t as b}from"./TForm-Drq7Qn9R.js";import"./TIcon-C-hNhMC1.js";import{t as x}from"./TModal-OyBXzO5K.js";import{n as le,t as ue}from"./CardContent-CMuL0LxG.js";import{n as de,t as fe}from"./CardTitle-D06OZslX.js";import{n as pe,r as S}from"./composables-CTAVZAup.js";import"./constants-OTiF8S51.js";import"./business-DYFIcNWr.js";import{t as me}from"./TDataCard-C7I9agpQ.js";import{t as he}from"./TStatusBadge-DZzFEG5C.js";import{t as ge}from"./TPageHeader-CTxQMWSB.js";import{t as _e}from"./TEmptyState-B9XitPgC.js";import{t as C}from"./TBatchActions-CX-6FAVm.js";var w={class:`space-y-6`},T={class:`flex flex-wrap gap-3`},E={class:`bg-muted/40 border border-border/50 rounded-xl px-3 py-3`},D={class:`flex items-center justify-between`},O={class:`flex items-center gap-3`},k={class:`text-xs text-muted-foreground bg-muted px-2 py-0.5 rounded-full`},A={class:`flex items-center gap-4`},j={class:`flex items-center gap-4 text-sm text-muted-foreground`},M={class:`flex items-center gap-1`},N={class:`flex items-center gap-1`},P={class:`font-medium`},F={class:`text-xs text-muted-foreground font-mono`},I={class:`font-medium text-primary`},L=r({__name:`Products`,setup(r){let{data:L,loading:ve,searchQuery:R,filters:z,currentPage:ye,pageSize:be,total:xe,statistics:B,fetchData:V,goToPage:Se,setPageSize:Ce,addData:we,updateData:Te,removeData:Ee,batchRemoveData:De}=pe({apiCall:async e=>await p.getProducts(e)||{list:[],total:0,page:1,pageSize:10},apiCallParams:e=>({page:e.page,pageSize:e.pageSize,search:e.searchQuery,category:e.filters.category,status:e.filters.status}),statisticsFn:e=>({total:e.length,active:e.filter(e=>e.status===m.ACTIVE).length,lowStock:e.filter(e=>e.status===m.LOW_STOCK).length,outOfStock:e.filter(e=>e.status===m.OUT_OF_STOCK).length,totalSales:e.reduce((e,t)=>e+(t.sales||0),0),totalStock:e.reduce((e,t)=>e+(t.stock||0),0)})}),{mutate:Oe,loading:ke}=S({mutationFn:e=>{let t=Number(e.stock);return p.createProduct({name:e.name,category:e.category,price:Number(e.price),stock:t,status:t===0?m.OUT_OF_STOCK:t<10?m.LOW_STOCK:m.ACTIVE,sales:0,description:e.description})},onSuccess:()=>{G.value=!1,J.value={name:``,category:``,price:0,stock:0,description:``},V()}}),{mutate:Ae,loading:je}=S({mutationFn:({id:e,values:t})=>p.updateProduct(e,{name:t.name,category:t.category,price:Number(t.price),stock:Number(t.stock),description:t.description}),onSuccess:()=>{K.value=!1,q.value=null,V()}}),{mutate:Me}=S({mutationFn:e=>p.deleteProduct(e),onSuccess:()=>V()}),{mutate:Ne}=S({mutationFn:e=>p.batchDeleteProducts(e),onSuccess:()=>{U.value?.clearSelection(),V()}}),Pe=n(()=>{let e=B.value||{};return[{title:`总商品`,value:e.total||0,icon:a,color:`text-blue-500`,bgColor:`bg-blue-50`},{title:`在售`,value:e.active||0,icon:te,color:`text-green-500`,bgColor:`bg-green-50`},{title:`库存不足`,value:e.lowStock||0,icon:ie,color:`text-yellow-500`,bgColor:`bg-yellow-50`},{title:`缺货`,value:e.outOfStock||0,icon:ne,color:`text-red-500`,bgColor:`bg-red-50`}]}),H=c({keyword:``,category:``,status:``}),Fe={layout:`inline`,fields:[{name:`keyword`,type:`input`,label:``,placeholder:`搜索商品名称、SKU...`,className:`w-[200px]`},{name:`category`,type:`select`,label:``,placeholder:`全部分类`,options:[{label:`全部分类`,value:``},{label:`电子产品`,value:`电子产品`},{label:`配件`,value:`配件`},{label:`音频设备`,value:`音频设备`}],className:`w-[140px]`},{name:`status`,type:`select`,label:``,placeholder:`全部状态`,options:[{label:`全部状态`,value:``},{label:g.PRODUCT.ACTIVE.text,value:g.PRODUCT.ACTIVE.value},{label:g.PRODUCT.LOW_STOCK.text,value:g.PRODUCT.LOW_STOCK.value},{label:g.PRODUCT.OUT_OF_STOCK.text,value:g.PRODUCT.OUT_OF_STOCK.value}],className:`w-[140px]`}],searchConfig:{enabled:!0,collapsed:!1,collapseThreshold:3,showCollapseButton:!1,searchText:`搜索`,resetText:`重置`,showReset:!0,onSearch:e=>{R.value=e.keyword||``,z.value={category:e.category,status:e.status}},onReset:()=>{R.value=``,z.value={}}}},U=c(),Ie=n(()=>({columns:[{title:`商品信息`,dataIndex:`name`,width:250,slot:`product`},{title:`分类`,dataIndex:`category`,width:120,filters:[{text:`电子产品`,value:`电子产品`},{text:`配件`,value:`配件`},{text:`音频设备`,value:`音频设备`}]},{title:`价格`,dataIndex:`price`,width:100,slot:`price`,sorter:!0},{title:`库存`,dataIndex:`stock`,width:100,slot:`stock`,sorter:!0},{title:`销量`,dataIndex:`sales`,width:100,sorter:!0},{title:`状态`,dataIndex:`status`,width:120,slot:`status`,filters:[{text:g.PRODUCT.ACTIVE.text,value:g.PRODUCT.ACTIVE.value},{text:g.PRODUCT.LOW_STOCK.text,value:g.PRODUCT.LOW_STOCK.value},{text:g.PRODUCT.OUT_OF_STOCK.text,value:g.PRODUCT.OUT_OF_STOCK.value}]}],pagination:{pageSize:10,show:!0,showSizeChanger:!0,showQuickJumper:!0},rowSelection:{type:`checkbox`,show:!0},actions:[{text:`编辑`,type:`primary`,onClick:e=>ze(e)},{text:`删除`,type:`danger`,confirm:!0,confirmText:`确定要删除该商品吗？此操作不可恢复。`,onClick:e=>Ve(e.id)}],actionWidth:150,actionFixed:`right`})),W=n(()=>L.value.map(e=>({...e,key:e.id}))),G=c(!1),K=c(!1),q=c(null),J=c({name:``,category:``,price:0,stock:0,description:``}),Y=c({id:``,name:``,category:``,price:0,stock:0,description:``}),X={layout:`horizontal`,labelCol:{span:6},wrapperCol:{span:18},fields:[{name:`name`,type:`input`,label:`商品名称`,placeholder:`请输入商品名称`,rules:[{required:!0,message:`商品名称不能为空`},{min:2,message:`商品名称至少2个字符`}]},{name:`category`,type:`select`,label:`分类`,placeholder:`请选择分类`,options:[{label:`电子产品`,value:`电子产品`},{label:`配件`,value:`配件`},{label:`音频设备`,value:`音频设备`}],rules:[{required:!0,message:`请选择分类`}]},{name:`price`,type:`number`,label:`价格`,placeholder:`请输入价格`,rules:[{required:!0,message:`价格不能为空`},{type:`number`,min:0,message:`价格不能为负数`}]},{name:`stock`,type:`number`,label:`库存`,placeholder:`请输入库存数量`,rules:[{required:!0,message:`库存不能为空`},{type:`number`,min:0,message:`库存不能为负数`}]},{name:`description`,type:`textarea`,label:`商品描述`,placeholder:`请输入商品描述（可选）`}]},Le={...X,actions:{showSubmit:!0,showReset:!0,submitText:`添加商品`,resetText:`取消`,align:`right`,onReset:()=>{G.value=!1}}},Re={...X,actions:{showSubmit:!0,showReset:!0,submitText:`保存修改`,resetText:`取消`,align:`right`,onReset:()=>{K.value=!1}}};function ze(e){q.value=e,Y.value={id:e.id,name:e.name,category:e.category,price:e.price,stock:e.stock,description:e.description||``},K.value=!0}function Z(e){Oe(e)}function Be(e){q.value&&Ae({id:q.value.id,values:e})}function Ve(e){Me(e)}let Q=c([]),$=c([]);function He(e,t){Q.value=e,$.value=t}function Ue(){Q.value=[],$.value=[],U.value?.clearSelection()}function We(){if(Q.value.length===0){alert(`请先选择要删除的商品`);return}confirm(`确定要删除选中的 ${Q.value.length} 个商品吗？`)&&Ne(Q.value.map(String))}function Ge(e){e.current!==void 0&&Se(e.current),e.pageSize!==void 0&&Ce(e.pageSize)}return(n,r)=>(h(),v(`div`,w,[d(f(ge),{title:`商品管理`,subtitle:`管理商品库存和价格`,actions:[{text:`添加商品`,type:`primary`,iconName:`Plus`,onClick:()=>G.value=!0}]},null,8,[`actions`]),d(f(x),{open:f(G),"onUpdate:open":r[1]||=e=>l(G)?G.value=e:null,title:`添加新商品`,width:`560`,footer:null},{default:t(()=>[d(f(b),{modelValue:f(J),"onUpdate:modelValue":r[0]||=e=>l(J)?J.value=e:null,schema:Le,onSubmit:Z},null,8,[`modelValue`])]),_:1},8,[`open`]),d(f(x),{open:f(K),"onUpdate:open":r[3]||=e=>l(K)?K.value=e:null,title:`编辑商品`,width:`560`,footer:null},{default:t(()=>[f(q)?(h(),s(f(b),{key:0,modelValue:f(Y),"onUpdate:modelValue":r[2]||=e=>l(Y)?Y.value=e:null,schema:Re,onSubmit:Be},null,8,[`modelValue`])):u(``,!0)]),_:1},8,[`open`]),i(`div`,T,[(h(!0),v(e,null,ae(f(Pe),e=>(h(),s(f(me),{key:e.title,title:e.title,value:e.value,icon:e.icon,color:e.color,size:`sm`},null,8,[`title`,`value`,`icon`,`color`]))),128))]),i(`div`,E,[d(f(b),{modelValue:f(H),"onUpdate:modelValue":r[4]||=e=>l(H)?H.value=e:null,schema:Fe},null,8,[`modelValue`])]),d(f(le),{class:`bg-muted/40 border border-border/50 rounded-xl`},{default:t(()=>[d(f(de),null,{default:t(()=>[i(`div`,D,[i(`div`,O,[d(f(fe),{class:`text-base font-semibold`},{default:t(()=>[...r[6]||=[ee(`商品列表`,-1)]]),_:1}),i(`span`,k,` 共 `+o(f(W).length)+` 件 `,1)]),i(`div`,A,[d(f(C),{count:f(Q).length,"item-name":`商品`,"class-name":`border-0 bg-transparent shadow-none px-0 py-0`,actions:[{text:`批量删除`,type:`danger`,confirm:!0,confirmText:`确定要删除选中的商品吗？此操作不可恢复。`,onClick:We}],onClear:Ue},null,8,[`count`,`actions`]),i(`div`,j,[i(`div`,M,[d(f(_),{class:`h-4 w-4`}),i(`span`,null,`总销量: `+o(f(B).value?.totalSales||0),1)]),i(`div`,N,[d(f(oe),{class:`h-4 w-4`}),i(`span`,null,`总库存: `+o(f(B).value?.totalStock||0),1)])])])])]),_:1}),d(f(ue),{class:`pt-0`},{default:t(()=>[d(f(ce),{ref_key:`tableRef`,ref:U,data:f(W),"onUpdate:data":r[5]||=e=>l(W)?W.value=e:null,schema:f(Ie),onSelectChange:He,onChange:Ge},{product:t(e=>[d(f(y),null,{default:t(()=>[d(f(se),{style:{backgroundColor:`#f0f0f0`,color:`#666`},shape:`square`,size:40},{default:t(()=>[d(f(a),{class:`h-5 w-5`})]),_:1}),d(f(y),{direction:`vertical`,size:`small`},{default:t(()=>[i(`span`,P,o(e.record.name),1),i(`span`,F,o(e.record.sku),1)]),_:2},1024)]),_:2},1024)]),price:t(e=>[i(`span`,I,`¥`+o(Number(e.text).toFixed(2)),1)]),stock:t(e=>[d(f(y),null,{default:t(()=>[i(`span`,{class:re([`font-medium`,e.record.stock===0?`text-red-500`:e.record.stock<10?`text-yellow-500`:`text-green-500`])},o(e.text),3),e.record.stock<10?(h(),s(f(_),{key:0,class:`h-4 w-4 text-red-500`})):u(``,!0)]),_:2},1024)]),status:t(e=>[d(f(he),{status:e.text,"status-map":{[f(m).ACTIVE]:{text:`在售`,color:`success`},[f(m).LOW_STOCK]:{text:`库存不足`,color:`warning`},[f(m).OUT_OF_STOCK]:{text:`缺货`,color:`error`}}},null,8,[`status`,`status-map`])]),emptyText:t(()=>[d(f(_e),{type:`data`,title:`暂无商品数据`,description:`开始添加您的第一个商品吧`,action:{text:`添加商品`,type:`primary`,iconName:`Plus`,onClick:()=>G.value=!0}},null,8,[`action`])]),_:1},8,[`data`,`schema`])]),_:1})]),_:1})]))}});export{L as default};