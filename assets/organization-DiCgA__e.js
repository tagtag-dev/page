import"./ScrollArea-u7vgQcwr.js";import"./RovingFocusItem-tfPyown7.js";import"./Presence-CTcpkTiJ.js";import"./TabsTrigger-BVA-KY5p.js";import{$n as e,Bi as t,Ha as n,Ii as r,Ki as i,Li as a,Pa as o,Ri as s,Ui as c,Wi as l,Xt as u,Y as d,ji as f,ka as p,l as m,la as h,qa as g,sa as _,wa as v,zi as y}from"./index-Bdnse1ke.js";import"./en_US-B-0xvqcl.js";import"./common-B6eu2cAW.js";import"./zh_CN-o6dt8jMH.js";import"./useFullscreen-Cz-fRWjR.js";import"./_plugin-vue_export-helper-CuErARa7.js";import{N as b}from"./dist-CIVP1JAM.js";import"./theme-shared-CKGE9ZaP.js";import{t as ee}from"./TTable-BqF1vWP0.js";import"./useTableColumns-ClPoF4Nv.js";import"./useResponsive-Drj8-vqi.js";import{t as x}from"./TForm-D3MGp7pF.js";import"./TIcon-BqmThimp.js";import{t as S}from"./TModal-C-7FBAha.js";import{n as te,t as ne}from"./CardContent-CE0o8nDP.js";import{n as C,t as w}from"./CardTitle-BRqhnrl0.js";import{n as T,r as E}from"./composables-cmucIgPx.js";import"./business-Ca3ePTT7.js";import{t as D}from"./TDataCard-CaW7oY6O.js";import{t as re}from"./TStatusBadge-ByNmjsZv.js";import{t as ie}from"./TPageHeader-B7msJezu.js";import{t as O}from"./TEmptyState-CimpC4Hh.js";import"./TBatchActions-CBzH8d8g.js";var k={class:`space-y-6`},A={class:`flex flex-wrap gap-3`},j={class:`bg-muted/40 border border-border/50 rounded-xl px-3 py-3`},M={class:`flex items-center gap-2`},N={class:`font-medium`},P=i({__name:`index`,setup(i){let{data:P,loading:F,searchQuery:I,fetchData:L}=T({apiCall:async t=>await e.getOrganizations(t)||{list:[],total:0,page:1,pageSize:10},apiCallParams:e=>({search:e.searchQuery})});function R(e){let t=new Map,n=[];return e.forEach(e=>{t.set(e.id,{...e})}),e.forEach(e=>{let r=t.get(e.id);if(e.parentId&&t.has(e.parentId)){let n=t.get(e.parentId);n.children||=[],n.children.push(r),n.children.sort((e,t)=>e.sort-t.sort)}else n.push(r)}),n.sort((e,t)=>e.sort-t.sort)}let z=r(()=>R(P.value)),{mutate:B}=E({mutationFn:t=>e.createOrganization({name:t.name,code:t.code,parentId:t.parentId||null,leader:t.leader,description:t.description,sort:t.sort||0,status:t.status}),successMessage:`部门创建成功`,onSuccess:()=>{q.value=!1,me(),L()}}),{mutate:V}=E({mutationFn:({id:t,values:n})=>e.updateOrganization(t,{name:n.name,code:n.code,parentId:n.parentId||null,leader:n.leader,description:n.description,sort:n.sort,status:n.status}),successMessage:`部门更新成功`,onSuccess:()=>{J.value=!1,Y.value=null,L()}}),{mutate:H}=E({mutationFn:t=>e.deleteOrganization(t),successMessage:`部门删除成功`,onSuccess:()=>L()}),{mutate:ae}=E({mutationFn:({id:t,status:n})=>e.updateOrganizationStatus(t,n),successMessage:`状态更新成功`,onSuccess:()=>L()}),U=o({keyword:``}),W={layout:`inline`,fields:[{name:`keyword`,type:`input`,label:``,placeholder:`搜索部门名称或编码...`,className:`w-[280px]`}],searchConfig:{enabled:!0,collapsed:!1,showCollapseButton:!1,searchText:`搜索`,resetText:`重置`,showReset:!0,onSearch:e=>{I.value=e.keyword||``},onReset:()=>{I.value=``}}},G=o(),K=r(()=>({columns:[{title:`部门名称`,dataIndex:`name`,width:220,slot:`name`},{title:`部门编码`,dataIndex:`code`,width:140,ellipsis:!0},{title:`负责人`,dataIndex:`leader`,width:120},{title:`成员数`,dataIndex:`memberCount`,width:80,align:`center`},{title:`排序`,dataIndex:`sort`,width:60,align:`center`},{title:`状态`,dataIndex:`status`,width:80,slot:`status`},{title:`创建时间`,dataIndex:`createdAt`,width:160}],childrenColumnName:`children`,indentSize:20,expandable:{defaultExpandAllRows:!0},pagination:!1,actions:[{text:`编辑`,type:`primary`,onClick:e=>le(e)},{text:`删除`,type:`danger`,confirm:!0,confirmText:`确定要删除该部门吗？子部门也会被删除，此操作不可恢复。`,onClick:e=>fe(e.id)}],actionWidth:150,actionFixed:`right`})),q=o(!1),J=o(!1),Y=o(null);function X(){return{name:``,code:``,parentId:null,leader:``,description:``,sort:0,status:`active`}}let Z=o(X()),Q=o({id:``,...X()});r(()=>[{label:`顶级部门`,value:null},...(P.value||[]).map(e=>({label:e.name,value:e.id}))]);let oe=r(()=>{let e=t=>t.map(t=>({title:t.name,value:t.id,key:t.id,children:t.children?e(t.children):void 0}));return[{title:`顶级部门`,value:``,key:`root`,children:e(z.value)}]});function $(e){return[{name:`name`,type:`input`,label:`部门名称`,placeholder:`请输入部门名称`,rules:[{required:!0,message:`部门名称不能为空`},{min:2,message:`部门名称至少2个字符`}]},{name:`code`,type:`input`,label:`部门编码`,placeholder:`请输入部门编码`,disabled:e,rules:[{required:!0,message:`部门编码不能为空`},{pattern:/^[A-Za-z0-9_-]+$/,message:`编码只能包含字母、数字、下划线和横线`}]},{name:`parentId`,type:`tree-select`,label:`上级部门`,placeholder:`请选择上级部门`,options:oe.value,disabled:e,props:{treeDefaultExpandAll:!0,allowClear:!0,showSearch:!0,treeNodeFilterProp:`title`}},{name:`leader`,type:`input`,label:`负责人`,placeholder:`请输入负责人姓名`},{name:`sort`,type:`number`,label:`排序`,placeholder:`请输入排序号`,min:0},{name:`status`,type:`select`,label:`状态`,placeholder:`请选择状态`,options:[{label:`启用`,value:`active`},{label:`禁用`,value:`inactive`}],rules:[{required:!0,message:`请选择状态`}]},{name:`description`,type:`textarea`,label:`描述`,placeholder:`请输入部门描述`,rows:3}]}let se=r(()=>({layout:`horizontal`,columns:2,labelCol:{span:8},wrapperCol:{span:16},fields:$(!1),actions:{showSubmit:!0,showReset:!0,submitText:`添加部门`,resetText:`取消`,align:`right`,onReset:()=>{q.value=!1}}})),ce=r(()=>({layout:`horizontal`,columns:2,labelCol:{span:8},wrapperCol:{span:16},fields:$(!0),actions:{showSubmit:!0,showReset:!0,submitText:`保存修改`,resetText:`取消`,align:`right`,onReset:()=>{J.value=!1}}}));function le(e){Y.value=e,Q.value={id:e.id,name:e.name,code:e.code,parentId:e.parentId,leader:e.leader,description:e.description,sort:e.sort,status:e.status},J.value=!0}function ue(e){B(e)}function de(e){Y.value&&V({id:Y.value.id,values:e})}function fe(e){H(e)}function pe(e){let t=e.status===`active`?`inactive`:`active`;ae({id:e.id,status:t})}function me(){Z.value=X()}let he=r(()=>{let e=P.value||[],t=e.length,n=e.filter(e=>e.status===`active`).length,r=e.filter(e=>e.parentId===null).length,i=e.reduce((e,t)=>e+(t.memberCount||0),0);return[{title:`部门总数`,value:t,icon:u,color:`text-blue-500`},{title:`启用部门`,value:n,icon:d,color:`text-green-500`},{title:`顶级部门`,value:r,icon:u,color:`text-purple-500`},{title:`总成员数`,value:i,icon:m,color:`text-orange-500`}]});return(e,r)=>(_(),t(`div`,k,[l(n(ie),{title:`组织架构`,subtitle:`管理部门组织架构和层级关系`,actions:[{text:`添加部门`,type:`primary`,iconName:`Plus`,onClick:()=>q.value=!0}]},null,8,[`actions`]),a(`div`,A,[(_(!0),t(f,null,h(n(he),e=>(_(),s(n(D),{key:e.title,title:e.title,value:e.value,icon:e.icon,color:e.color,size:`sm`},null,8,[`title`,`value`,`icon`,`color`]))),128))]),a(`div`,j,[l(n(x),{modelValue:n(U),"onUpdate:modelValue":r[0]||=e=>p(U)?U.value=e:null,schema:W},null,8,[`modelValue`])]),l(n(te),{class:`bg-muted/40 border border-border/50 rounded-xl`},{default:v(()=>[l(n(C),{class:`pb-4`},{default:v(()=>[l(n(w),{class:`text-base font-semibold`},{default:v(()=>[...r[6]||=[c(`部门结构`,-1)]]),_:1})]),_:1}),l(n(ne),{class:`pt-0`},{default:v(()=>[l(n(ee),{ref_key:`tableRef`,ref:G,data:n(z),"onUpdate:data":r[1]||=e=>p(z)?z.value=e:null,schema:n(K),loading:n(F)},{name:v(({text:e,record:t})=>[a(`div`,M,[l(n(u),{class:`h-4 w-4 text-muted-foreground`}),a(`span`,N,g(e),1),t?.memberCount?(_(),s(n(b),{key:0,variant:`outline`,class:`text-xs bg-muted/50`},{default:v(()=>[c(g(t.memberCount)+`人 `,1)]),_:2},1024)):y(``,!0)])]),status:v(({text:e,record:t})=>[t?(_(),s(n(re),{key:0,status:e,"status-map":{active:{text:`启用`,color:`success`},inactive:{text:`禁用`,color:`default`}},clickable:``,onClick:e=>pe(t)},null,8,[`status`,`onClick`])):y(``,!0)]),emptyText:v(()=>[l(n(O),{type:`data`,title:`暂无部门数据`,description:`开始添加您的第一个部门吧`,action:{text:`添加部门`,type:`primary`,iconName:`Plus`,onClick:()=>q.value=!0}},null,8,[`action`])]),_:1},8,[`data`,`schema`,`loading`])]),_:1})]),_:1}),l(n(S),{open:n(q),"onUpdate:open":r[3]||=e=>p(q)?q.value=e:null,title:`添加部门`,width:`700`,footer:null},{default:v(()=>[l(n(x),{modelValue:n(Z),"onUpdate:modelValue":r[2]||=e=>p(Z)?Z.value=e:null,schema:n(se),onSubmit:ue},null,8,[`modelValue`,`schema`])]),_:1},8,[`open`]),l(n(S),{open:n(J),"onUpdate:open":r[5]||=e=>p(J)?J.value=e:null,title:`编辑部门`,width:`700`,footer:null},{default:v(()=>[n(Y)?(_(),s(n(x),{key:0,modelValue:n(Q),"onUpdate:modelValue":r[4]||=e=>p(Q)?Q.value=e:null,schema:n(ce),onSubmit:de},null,8,[`modelValue`,`schema`])):y(``,!0)]),_:1},8,[`open`])]))}});export{P as default};