import"./ScrollArea-CW0-18Hy.js";import"./RovingFocusItem-DihGLheP.js";import{t as e}from"./button-Bo4o88Eb.js";import"./Presence-CX2vXdhf.js";import"./defu-BJL4Fjh2.js";import"./usePrimitiveElement-bvCn2QxH.js";import"./TabsTrigger-EHjOJe4X.js";import{Di as t,Ea as n,Gi as r,M as i,Ti as a,Ui as o,Yi as ee,_i as s,bi as c,da as l,fi as u,ga as d,jn as f,ka as p,oa as m,qi as te,vi as h,wa as g,wi as _,xi as v,yi as y}from"./index-D9LA8apy.js";import"./en_US-N9Q-_HQi.js";import"./common-rttX-sZZ.js";import"./zh_CN-RQJLYl9H.js";import"./useTabBar-WvhELTvw.js";import{t as ne}from"./badge-DoBLqkFL.js";import{n as re,t as ie}from"./CardContent-bGWyUVF7.js";import{n as ae,t as oe}from"./CardTitle-9YsRePqj.js";import"./dist-guKItzxh.js";import{t as se}from"./TTable-BJXg8Gts.js";import{t as b}from"./TForm-De-AxzjP.js";import"./Input-DxyLxkUT.js";import"./TIcon-DpsAxes7.js";import{t as x}from"./TModal-l0DmcJma.js";import{n as S}from"./composables-B_2v-ght.js";var C={class:`space-y-6`},w={class:`flex flex-col sm:flex-row sm:items-center justify-between gap-4`},T={class:`flex flex-wrap gap-3`},ce={class:`flex items-baseline gap-2`},le={class:`text-lg font-semibold`},E={class:`text-xs text-muted-foreground`},D={class:`bg-muted/30 rounded-lg p-4`},O={class:`flex flex-col lg:flex-row lg:items-center gap-4`},k={class:`flex-1`},A={key:0,class:`flex items-center gap-2 lg:border-l lg:pl-4`},j={class:`text-sm text-muted-foreground`},M={class:`flex items-center justify-between`},N={class:`flex items-center gap-3`},P={class:`text-xs text-muted-foreground bg-muted px-2 py-0.5 rounded-full`},F={class:`flex items-center gap-2`},I={class:`font-medium`},L={class:`flex flex-col items-center justify-center py-12 text-muted-foreground`},R={class:`w-16 h-16 rounded-full bg-muted flex items-center justify-center mb-4`},z=t({__name:`Level2`,setup(t){let{data:z,loading:ue,searchQuery:B,filters:V,filteredData:de,paginatedData:H,total:fe,statistics:pe,fetchData:U}=S({apiCall:()=>f.getCategories(),filterFn:(e,t,n)=>{let r=e.filter(e=>e.level===2);if(t){let e=t.toLowerCase();r=r.filter(t=>t.name.toLowerCase().includes(e)||t.code.toLowerCase().includes(e))}return n.status&&(r=r.filter(e=>e.status===n.status)),r},statisticsFn:e=>{let t=e.filter(e=>e.level===2);return{total:t.length,active:t.filter(e=>e.status===`active`).length,inactive:t.filter(e=>e.status===`inactive`).length,totalProducts:t.reduce((e,t)=>e+t.productCount,0)}}}),W=s(()=>z.value.filter(e=>e.level===1)),G=d({keyword:``,status:``}),me={layout:`inline`,fields:[{name:`keyword`,type:`input`,label:``,placeholder:`搜索分类名称...`,className:`w-[200px]`},{name:`status`,type:`select`,label:``,placeholder:`全部状态`,options:[{label:`全部状态`,value:``},{label:`启用`,value:`active`},{label:`禁用`,value:`inactive`}],className:`w-[140px]`}],searchConfig:{enabled:!0,collapsed:!1,showCollapseButton:!1,searchText:`搜索`,resetText:`重置`,showReset:!0,onSearch:e=>{B.value=e.keyword||``,V.value={status:e.status}},onReset:()=>{B.value=``,V.value={}}}},he=s(()=>({columns:[{title:`分类名称`,dataIndex:`name`,width:180,slot:`name`},{title:`上级分类`,dataIndex:`parentName`,width:150},{title:`商品数量`,dataIndex:`productCount`,width:100,sorter:!0},{title:`排序`,dataIndex:`sort`,width:80,sorter:!0},{title:`状态`,dataIndex:`status`,width:100,slot:`status`}],pagination:{pageSize:10,show:!0,showSizeChanger:!0},rowSelection:{type:`checkbox`,show:!0},actions:[{text:`编辑`,type:`primary`,onClick:e=>ve(e)},{text:`删除`,type:`danger`,confirm:!0,confirmText:`确定要删除该分类吗？`,onClick:e=>be(e.id)}],actionWidth:150,actionFixed:`right`})),K=s(()=>H.value.map(e=>({...e,key:e.id}))),q=d(!1),J=d(!1),Y=d(null),X=d({name:``,code:``,parentId:``,sort:0,status:`active`,description:``}),Z=d({id:``,name:``,code:``,parentId:``,sort:0,status:`active`,description:``}),ge={layout:`horizontal`,labelCol:{span:6},wrapperCol:{span:18},fields:[{name:`name`,type:`input`,label:`分类名称`,placeholder:`请输入分类名称`,rules:[{required:!0,message:`分类名称不能为空`}]},{name:`code`,type:`input`,label:`分类编码`,placeholder:`请输入分类编码`,rules:[{required:!0,message:`分类编码不能为空`}]},{name:`parentId`,type:`select`,label:`上级分类`,placeholder:`请选择上级分类`,options:()=>W.value.map(e=>({label:e.name,value:e.id})),rules:[{required:!0,message:`请选择上级分类`}]},{name:`sort`,type:`number`,label:`排序`,placeholder:`请输入排序号`},{name:`status`,type:`select`,label:`状态`,placeholder:`请选择状态`,options:[{label:`启用`,value:`active`},{label:`禁用`,value:`inactive`}]},{name:`description`,type:`textarea`,label:`描述`,placeholder:`请输入描述（可选）`}],actions:{showSubmit:!0,showReset:!0,submitText:`添加分类`,resetText:`取消`,align:`right`,onReset:()=>{q.value=!1}}},Q={layout:`horizontal`,labelCol:{span:6},wrapperCol:{span:18},fields:[{name:`name`,type:`input`,label:`分类名称`,placeholder:`请输入分类名称`,rules:[{required:!0,message:`分类名称不能为空`}]},{name:`sort`,type:`number`,label:`排序`,placeholder:`请输入排序号`},{name:`status`,type:`select`,label:`状态`,placeholder:`请选择状态`,options:[{label:`启用`,value:`active`},{label:`禁用`,value:`inactive`}]},{name:`description`,type:`textarea`,label:`描述`,placeholder:`请输入描述（可选）`}],actions:{showSubmit:!0,showReset:!0,submitText:`保存修改`,resetText:`取消`,align:`right`,onReset:()=>{J.value=!1}}};async function _e(e){let t=W.value.find(t=>t.id===e.parentId);await f.createCategory({name:e.name,code:e.code,level:2,parentId:e.parentId,parentName:t?.name,sort:Number(e.sort)||0,status:e.status,productCount:0,description:e.description}),q.value=!1,X.value={name:``,code:``,parentId:``,sort:0,status:`active`,description:``},await U()}function ve(e){Y.value=e,Z.value={id:e.id,name:e.name,code:e.code,parentId:e.parentId||``,sort:e.sort,status:e.status,description:e.description||``},J.value=!0}async function ye(e){Y.value&&(await f.updateCategory(Y.value.id,{name:e.name,sort:Number(e.sort),status:e.status,description:e.description}),J.value=!1,Y.value=null,await U())}async function be(e){await f.deleteCategory(e),await U()}let $=d([]);function xe(e){$.value=e}async function Se(){if($.value.length===0){alert(`请先选择要删除的分类`);return}confirm(`确定要删除选中的 ${$.value.length} 个分类吗？`)&&(await f.batchDeleteCategories($.value.map(String)),await U())}return(t,s)=>{let d=te(`Layers`);return o(),v(`div`,C,[h(`div`,w,[s[9]||=h(`div`,null,[h(`h1`,{class:`text-3xl font-bold tracking-tight`},`二级分类`),h(`p`,{class:`text-muted-foreground mt-1.5 text-sm`},`管理商品二级分类`)],-1),a(g(e),{class:`gap-2`,onClick:s[0]||=e=>q.value=!0},{default:m(()=>[a(g(i),{class:`h-4 w-4`}),s[8]||=_(` 添加二级分类 `,-1)]),_:1})]),a(g(x),{open:g(q),"onUpdate:open":s[2]||=e=>l(q)?q.value=e:null,title:`添加二级分类`,width:`560`,footer:null},{default:m(()=>[a(g(b),{modelValue:g(X),"onUpdate:modelValue":s[1]||=e=>l(X)?X.value=e:null,schema:ge,onSubmit:_e},null,8,[`modelValue`])]),_:1},8,[`open`]),a(g(x),{open:g(J),"onUpdate:open":s[4]||=e=>l(J)?J.value=e:null,title:`编辑二级分类`,width:`560`,footer:null},{default:m(()=>[g(Y)?(o(),y(g(b),{key:0,modelValue:g(Z),"onUpdate:modelValue":s[3]||=e=>l(Z)?Z.value=e:null,schema:Q,onSubmit:ye},null,8,[`modelValue`])):c(``,!0)]),_:1},8,[`open`]),h(`div`,T,[(o(!0),v(u,null,r(t.statisticsCards,e=>(o(),v(`div`,{key:e.title,class:`flex items-center gap-3 px-4 py-2.5 bg-muted/50 rounded-lg hover:bg-muted/70 transition-colors`},[(o(),y(ee(e.icon),{class:n([`h-4 w-4`,e.color])},null,8,[`class`])),h(`div`,ce,[h(`span`,le,p(e.value),1),h(`span`,E,p(e.title),1)])]))),128))]),h(`div`,D,[h(`div`,O,[h(`div`,k,[a(g(b),{modelValue:g(G),"onUpdate:modelValue":s[5]||=e=>l(G)?G.value=e:null,schema:me},null,8,[`modelValue`])]),g($).length>0?(o(),v(`div`,A,[h(`span`,j,`已选 `+p(g($).length)+` 项`,1),a(g(e),{variant:`outline`,size:`sm`,class:`h-8 text-xs text-destructive hover:text-destructive`,onClick:Se},{default:m(()=>[...s[10]||=[_(`批量删除`,-1)]]),_:1})])):c(``,!0)])]),a(g(re),{class:`border-0 shadow-sm`},{default:m(()=>[a(g(ae),{class:`pb-4`},{default:m(()=>[h(`div`,M,[h(`div`,N,[a(g(oe),{class:`text-base font-semibold`},{default:m(()=>[...s[11]||=[_(`二级分类列表`,-1)]]),_:1}),h(`span`,P,`共 `+p(g(K).length)+` 个`,1)])])]),_:1}),a(g(ie),{class:`pt-0`},{default:m(()=>[a(g(se),{ref:`tableRef`,data:g(K),"onUpdate:data":s[7]||=e=>l(K)?K.value=e:null,schema:g(he),onSelectChange:xe},{name:m(e=>[h(`div`,F,[a(d,{class:`h-4 w-4 text-orange-500`}),h(`span`,I,p(e.text),1)])]),status:m(e=>[a(g(ne),{class:n({"bg-green-500/10 text-green-500 border-green-500/20":e.text===`active`,"bg-gray-500/10 text-gray-500 border-gray-500/20":e.text===`inactive`}),variant:`outline`},{default:m(()=>[_(p(e.text===`active`?`启用`:`禁用`),1)]),_:2},1032,[`class`])]),emptyText:m(()=>[h(`div`,L,[h(`div`,R,[a(d,{class:`w-8 h-8 text-muted-foreground/50`})]),s[13]||=h(`p`,{class:`text-base font-medium mb-1`},`暂无二级分类`,-1),s[14]||=h(`p`,{class:`text-sm text-muted-foreground mb-4`},`开始添加您的第一个二级分类吧`,-1),a(g(e),{size:`sm`,onClick:s[6]||=e=>q.value=!0},{default:m(()=>[a(g(i),{class:`h-4 w-4 mr-1`}),s[12]||=_(` 添加分类 `,-1)]),_:1})])]),_:1},8,[`data`,`schema`])]),_:1})]),_:1})])}}});export{z as default};