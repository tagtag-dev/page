import"./ScrollArea-u7vgQcwr.js";import"./RovingFocusItem-tfPyown7.js";import"./Presence-CTcpkTiJ.js";import"./TabsTrigger-BVA-KY5p.js";import{Bi as e,Ha as t,Ii as n,Ka as ee,Ki as r,Li as i,Pa as a,Ri as o,Ui as s,Wi as c,_r as l,f as u,ji as te,ka as d,l as f,la as p,mr as m,p as ne,qa as h,sa as g,tr as _,v,vr as y,wa as b,zi as re}from"./index-Bdnse1ke.js";import"./en_US-B-0xvqcl.js";import"./common-B6eu2cAW.js";import"./zh_CN-o6dt8jMH.js";import"./useFullscreen-Cz-fRWjR.js";import"./_plugin-vue_export-helper-CuErARa7.js";import{P as ie,s as ae,w as oe}from"./dist-CIVP1JAM.js";import"./theme-shared-CKGE9ZaP.js";import{t as se}from"./TTable-BqF1vWP0.js";import"./useTableColumns-ClPoF4Nv.js";import"./useResponsive-Drj8-vqi.js";import{t as x}from"./TForm-D3MGp7pF.js";import"./TIcon-BqmThimp.js";import{t as S}from"./TModal-C-7FBAha.js";import{n as ce,t as le}from"./CardContent-CE0o8nDP.js";import{n as ue,t as de}from"./CardTitle-BRqhnrl0.js";import{n as fe,r as C}from"./composables-cmucIgPx.js";import"./constants-OTiF8S51.js";import"./business-Ca3ePTT7.js";import{t as pe}from"./TDataCard-CaW7oY6O.js";import{t as w}from"./TStatusBadge-ByNmjsZv.js";import{t as T}from"./TPageHeader-B7msJezu.js";import{t as E}from"./TEmptyState-CimpC4Hh.js";import{t as D}from"./TBatchActions-CBzH8d8g.js";var O={class:`space-y-6`},k={class:`flex flex-wrap gap-3`},A={class:`bg-muted/40 border border-border/50 rounded-xl px-3 py-3`},j={class:`flex items-center justify-between`},M={class:`flex items-center gap-3`},N={class:`text-xs text-muted-foreground bg-muted px-2 py-0.5 rounded-full`},P={class:`font-medium`},F={class:`text-sm text-muted-foreground`},I=r({__name:`index`,setup(r){let{data:I,loading:L,searchQuery:R,filters:z,currentPage:me,pageSize:he,total:B,statistics:ge,fetchData:V,goToPage:_e,setPageSize:ve}=fe({apiCall:async e=>await _.getUsers(e)||{list:[],total:0,page:1,pageSize:10},apiCallParams:e=>({page:e.page,pageSize:e.pageSize,search:e.searchQuery,role:e.filters.role,status:e.filters.status}),statisticsFn:e=>({total:e.length,active:e.filter(e=>e.status===y.ACTIVE).length,admins:e.filter(e=>e.role===l.ADMIN).length,today:e.filter(e=>{let t=new Date(e.createdAt),n=new Date;return t.toDateString()===n.toDateString()}).length})}),{mutate:ye}=C({mutationFn:e=>_.createUser({name:e.name,email:e.email,role:e.role,status:e.status}),successMessage:`用户创建成功`,onSuccess:()=>{W.value=!1,q.value={name:``,email:``,role:l.VIEWER,status:y.ACTIVE},V()}}),{mutate:be}=C({mutationFn:({id:e,values:t})=>_.updateUser(e,{name:t.name,email:t.email,role:t.role,status:t.status}),successMessage:`用户更新成功`,onSuccess:()=>{G.value=!1,K.value=null,V()}}),{mutate:xe}=C({mutationFn:e=>_.deleteUser(e),successMessage:`用户删除成功`,onSuccess:()=>V()}),{mutate:Se}=C({mutationFn:e=>_.batchDeleteUsers(e),successMessage:`批量删除成功`,onSuccess:()=>{U.value?.clearSelection(),V()}}),Ce=n(()=>{let e=ge.value||{};return[{title:`总用户`,value:e.total||0,icon:f,color:`text-blue-500`,bgColor:`bg-blue-50`},{title:`活跃用户`,value:e.active||0,icon:ne,color:`text-green-500`,bgColor:`bg-green-50`},{title:`管理员`,value:e.admins||0,icon:u,color:`text-purple-500`,bgColor:`bg-purple-50`},{title:`今日新增`,value:e.today||0,icon:v,color:`text-orange-500`,bgColor:`bg-orange-50`}]}),H=a({keyword:``,role:``,status:``}),we={layout:`inline`,fields:[{name:`keyword`,type:`input`,label:``,placeholder:`搜索用户名或邮箱...`,className:`w-[200px]`},{name:`role`,type:`select`,label:``,placeholder:`全部角色`,options:[{label:`全部角色`,value:``},{label:`管理员`,value:l.ADMIN},{label:`编辑`,value:l.EDITOR},{label:`查看者`,value:l.VIEWER}],className:`w-[140px]`},{name:`status`,type:`select`,label:``,placeholder:`全部状态`,options:[{label:`全部状态`,value:``},{label:m.USER.ACTIVE.text,value:m.USER.ACTIVE.value},{label:m.USER.INACTIVE.text,value:m.USER.INACTIVE.value},{label:m.USER.SUSPENDED.text,value:m.USER.SUSPENDED.value}],className:`w-[140px]`}],searchConfig:{enabled:!0,collapsed:!1,collapseThreshold:3,showCollapseButton:!1,searchText:`搜索`,resetText:`重置`,showReset:!0,onSearch:e=>{R.value=e.keyword||``,z.value={role:e.role,status:e.status}},onReset:()=>{R.value=``,z.value={}}}},U=a(),Te=n(()=>({columns:[{title:`用户`,dataIndex:`name`,width:200,slot:`user`},{title:`角色`,dataIndex:`role`,width:120,slot:`role`,filters:[{text:`管理员`,value:l.ADMIN},{text:`编辑`,value:l.EDITOR},{text:`查看者`,value:l.VIEWER}]},{title:`状态`,dataIndex:`status`,width:100,slot:`status`,filters:[{text:m.USER.ACTIVE.text,value:m.USER.ACTIVE.value},{text:m.USER.INACTIVE.text,value:m.USER.INACTIVE.value},{text:m.USER.SUSPENDED.text,value:m.USER.SUSPENDED.value}]},{title:`创建时间`,dataIndex:`createdAt`,width:120,sorter:!0},{title:`最后登录`,dataIndex:`lastLogin`,width:120,customRender:({text:e})=>e||`-`}],pagination:{pageSize:10,show:!0,showSizeChanger:!0,showQuickJumper:!0,total:B.value},rowSelection:{type:`checkbox`,show:!0},actions:[{text:`编辑`,type:`primary`,onClick:e=>Oe(e)},{text:`删除`,type:`danger`,confirm:!0,confirmText:`确定要删除该用户吗？此操作不可恢复。`,onClick:e=>Ae(e.id)}],actionWidth:150,actionFixed:`right`})),W=a(!1),G=a(!1),K=a(null),q=a({name:``,email:``,role:l.VIEWER,status:y.ACTIVE}),J=a({id:``,name:``,email:``,role:l.VIEWER,status:y.ACTIVE}),Y=[{name:`name`,type:`input`,label:`姓名`,placeholder:`请输入姓名`,rules:[{required:!0,message:`姓名不能为空`},{min:2,message:`姓名至少2个字符`}]},{name:`email`,type:`input`,label:`邮箱`,placeholder:`请输入邮箱`,rules:[{required:!0,message:`邮箱不能为空`},{type:`email`,message:`邮箱格式不正确`}]},{name:`role`,type:`select`,label:`角色`,placeholder:`请选择角色`,options:[{label:`管理员`,value:l.ADMIN},{label:`编辑`,value:l.EDITOR},{label:`查看者`,value:l.VIEWER}],rules:[{required:!0,message:`请选择角色`}]},{name:`status`,type:`select`,label:`状态`,placeholder:`请选择状态`,options:[{label:m.USER.ACTIVE.text,value:m.USER.ACTIVE.value},{label:m.USER.INACTIVE.text,value:m.USER.INACTIVE.value},{label:m.USER.SUSPENDED.text,value:m.USER.SUSPENDED.value}],rules:[{required:!0,message:`请选择状态`}]}],X={layout:`horizontal`,labelCol:{span:6},wrapperCol:{span:18}},Ee={...X,fields:Y,actions:{showSubmit:!0,showReset:!0,submitText:`添加用户`,resetText:`取消`,align:`right`,onReset:()=>{W.value=!1}}},De={...X,fields:Y,actions:{showSubmit:!0,showReset:!0,submitText:`保存修改`,resetText:`取消`,align:`right`,onReset:()=>{G.value=!1}}};function Oe(e){K.value=e,J.value={id:e.id,name:e.name,email:e.email,role:e.role,status:e.status},G.value=!0}function ke(e){ye(e)}function Z(e){K.value&&be({id:K.value.id,values:e})}function Ae(e){xe(e)}let Q=a([]),$=a([]);function je(e,t){Q.value=e,$.value=t}function Me(){Q.value=[],$.value=[],U.value?.clearSelection()}function Ne(){if(Q.value.length===0){alert(`请先选择要删除的用户`);return}confirm(`确定要删除选中的 ${Q.value.length} 个用户吗？`)&&Se(Q.value)}function Pe(e){e.current!==void 0&&_e(e.current),e.pageSize!==void 0&&ve(e.pageSize)}return(n,r)=>(g(),e(`div`,O,[c(t(T),{title:`用户管理`,subtitle:`管理系统用户账号和权限分配`,actions:[{text:`添加用户`,type:`primary`,iconName:`Plus`,onClick:()=>W.value=!0}]},null,8,[`actions`]),c(t(S),{open:t(W),"onUpdate:open":r[1]||=e=>d(W)?W.value=e:null,title:`添加新用户`,width:`480`,footer:null},{default:b(()=>[c(t(x),{modelValue:t(q),"onUpdate:modelValue":r[0]||=e=>d(q)?q.value=e:null,schema:Ee,onSubmit:ke},null,8,[`modelValue`])]),_:1},8,[`open`]),i(`div`,k,[(g(!0),e(te,null,p(t(Ce),e=>(g(),o(t(pe),{key:e.title,title:e.title,value:e.value,icon:e.icon,color:e.color,size:`sm`},null,8,[`title`,`value`,`icon`,`color`]))),128))]),i(`div`,A,[c(t(x),{modelValue:t(H),"onUpdate:modelValue":r[2]||=e=>d(H)?H.value=e:null,schema:we},null,8,[`modelValue`])]),c(t(ce),{class:`bg-muted/40 border border-border/50 rounded-xl`},{default:b(()=>[c(t(ue),null,{default:b(()=>[i(`div`,j,[i(`div`,M,[c(t(de),{class:`text-base font-semibold`},{default:b(()=>[...r[6]||=[s(`用户列表`,-1)]]),_:1}),i(`span`,N,` 共 `+h(t(B))+` 人 `,1)]),c(t(D),{count:t(Q).length,total:t(B),"item-name":`用户`,"class-name":`border-0 bg-transparent shadow-none px-0 py-0`,actions:[{text:`批量删除`,type:`danger`,confirm:!0,confirmText:`确定要删除选中的用户吗？此操作不可恢复。`,onClick:Ne}],onClear:Me},null,8,[`count`,`total`,`actions`])])]),_:1}),c(t(le),{class:`pt-0`},{default:b(()=>[c(t(se),{ref_key:`tableRef`,ref:U,data:t(I),"onUpdate:data":r[3]||=e=>d(I)?I.value=e:null,schema:t(Te),loading:t(L),onSelectChange:je,onChange:Pe},{user:b(e=>[c(t(oe),null,{default:b(()=>[c(t(ie),{style:ee({backgroundColor:e.record.status===t(y).ACTIVE?`#87d068`:`#ccc`})},{default:b(()=>[s(h(e.record.name.charAt(0)),1)]),_:2},1032,[`style`]),i(`div`,null,[i(`div`,P,h(e.record.name),1),i(`div`,F,h(e.record.email),1)])]),_:2},1024)]),role:b(e=>[c(t(ae),{color:e.text===t(l).ADMIN?`red`:e.text===t(l).EDITOR?`blue`:`default`},{default:b(()=>[s(h(e.text===t(l).ADMIN?`管理员`:e.text===t(l).EDITOR?`编辑`:`查看者`),1)]),_:2},1032,[`color`])]),status:b(e=>[c(t(w),{status:e.text,"status-map":{[t(y).ACTIVE]:{text:`启用`,color:`success`},[t(y).INACTIVE]:{text:`禁用`,color:`default`},[t(y).SUSPENDED]:{text:`已暂停`,color:`error`}}},null,8,[`status`,`status-map`])]),emptyText:b(()=>[c(t(E),{type:`data`,title:`暂无用户数据`,description:`开始添加您的第一个用户吧`,action:{text:`添加用户`,type:`primary`,iconName:`Plus`,onClick:()=>W.value=!0}},null,8,[`action`])]),_:1},8,[`data`,`schema`,`loading`])]),_:1})]),_:1}),c(t(S),{open:t(G),"onUpdate:open":r[5]||=e=>d(G)?G.value=e:null,title:`编辑用户`,width:`480`,footer:null},{default:b(()=>[t(K)?(g(),o(t(x),{key:0,modelValue:t(J),"onUpdate:modelValue":r[4]||=e=>d(J)?J.value=e:null,schema:De,onSubmit:Z},null,8,[`modelValue`])):re(``,!0)]),_:1},8,[`open`])]))}});export{I as default};